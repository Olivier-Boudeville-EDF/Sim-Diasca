<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module preferences</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module preferences</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#types">Data Types</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>Service dedicated to the <b>management of user preferences</b>, thanks to 
a corresponding server process.


<h2><a name="description">Description</a></h2><p>Service dedicated to the <b>management of user preferences</b>, thanks to 
a corresponding server process.</p>

 <p>Preferences are generally default, static settings, like user general 
preferences, defined in a file meant to be potentially read by multiple 
applications. This is a way of storing durable information in one's user 
account in a transverse way regarding programs and versions thereof, and of 
sharing these elements (settings, credentials, etc.) conveniently. See also, 
in the file_utils module, the get_configuration_directory/1 and 
get_extra_configuration_directories/1 functions in order to locate first such 
a configuration file.</p>

 <p>Preferences can be application-specific or component-specific, and obtained 
from any source (file included); they may also start blank and be exclusively 
fed by the application or component itself. In any case they are meant to be 
accessed (read/write) in the course of program execution, before possibly 
being stored at application exit or component stop.</p>

 <p>A preferences entry is designated by a key (an atom), associated to a value 
(that can be any term). No difference is made between a non-registered key and 
a key registered to 'undefined'.</p>

 <p>Preferences can be stored in file(s), in the ETF format. This format of
 preferences is a series of Erlang terms as strings, each ended with a dot
 (i.e. it is the basic, standard format understood by <code>file:consult/1</code>).</p>

 Example of content for a preferences file:
 <pre> {my_first_color, red}.
 {myHeight, 1.80}.
 {'My name', "Sylvester the cat"}.</pre>

 <p>Such a file may be used to create a preferences server (ex: with start/0) or 
to update a pre-existing one (with update_from_etf/{1,2}).</p>

 <p>The corresponding server process is locally registered, generally under a 
fixed name, which may be the default Myriad one (see the 
default_preferences_filename define), or a user-defined one (ex: 
foobar_preferences).</p>

 <p>As a consequence, a preferences server can be designated either directly
 through its PID or through its conventional (atom) registration name (ex:
 implicitly with <code>preferences:get(hello)</code> for the default one, or explicitly
 with <code>preferences:get(hello, foobar_preferences)</code>. No specific global 
registration of that server is made here.</p>

 <p>A (single) explicit start (with one of the start* functions) shall be 
preferred to implicit ones (typically directly thanks to the get* functions) 
to avoid any risk of race conditions (should multiple processes attempt 
concurrently to create the same preferences server), and also in order to be 
able to request that it is also linked to the calling process.</p>

 <p>For faster accesses (not involving any inter-process messaging), and if 
considering that their changes are at least rather infrequent (or never 
happening), at least some entries managed by a preferences server may be 
cached directly in client processes.</p>

 <p>In this case the process dictionary of these clients is used, and when 
updating from a client process a cached key, the corresponding preferences 
server is updated in turn. However any other client process caching that key 
will not be aware of this change until it requests an update to this 
preferences server.</p>

 In practice, now preferences are a special case of environment (see our
 environment module for more details). So each preferences server is an
 environment process (not unlike an ETS table) able to read, store, modify,
 save the data that it manages.

<h2><a name="types">Data Types</a></h2>

<h3 class="typedecl"><a name="type-any_file_path">any_file_path()</a></h3>
<p><tt>any_file_path() = <a href="file_utils.html#type-any_file_path">file_utils:any_file_path()</a></tt></p>


<h3 class="typedecl"><a name="type-bin_string">bin_string()</a></h3>
<p><tt>bin_string() = <a href="text_utils.html#type-bin_string">text_utils:bin_string()</a></tt></p>


<h3 class="typedecl"><a name="type-entries">entries()</a></h3>
<p><tt>entries() = <a href="table.html#type-entries">table:entries()</a></tt></p>


<h3 class="typedecl"><a name="type-entry">entry()</a></h3>
<p><tt>entry() = <a href="table.html#type-entry">table:entry()</a></tt></p>


<h3 class="typedecl"><a name="type-file_path">file_path()</a></h3>
<p><tt>file_path() = <a href="file_utils.html#type-file_path">file_utils:file_path()</a></tt></p>


<h3 class="typedecl"><a name="type-key">key()</a></h3>
<p><tt>key() = <a href="environment.html#type-key">environment:key()</a></tt></p>


<h3 class="typedecl"><a name="type-maybe_list">maybe_list()</a></h3>
<p><tt>maybe_list(T) = <a href="list_utils.html#type-maybe_list">list_utils:maybe_list</a>(T)</tt></p>


<h3 class="typedecl"><a name="type-pref_reg_name">pref_reg_name()</a></h3>
<p><tt>pref_reg_name() = <a href="environment.html#type-env_reg_name">environment:env_reg_name()</a></tt></p>
<p> The name under which a preferences server can be (locally) registered.</p>

<h3 class="typedecl"><a name="type-preferences_designator">preferences_designator()</a></h3>
<p><tt>preferences_designator() = <a href="environment.html#type-env_designator">environment:env_designator()</a></tt></p>
<p> The two standard ways according to which a preferences server can be
 designated: either directly thanks to its PID or to the name under which it is
 locally registered.</p>

<h3 class="typedecl"><a name="type-preferences_pid">preferences_pid()</a></h3>
<p><tt>preferences_pid() = <a href="environment.html#type-env_pid">environment:env_pid()</a></tt></p>
<p> The PID of a preferences server.</p>

<h3 class="typedecl"><a name="type-ustring">ustring()</a></h3>
<p><tt>ustring() = <a href="text_utils.html#type-ustring">text_utils:ustring()</a></tt></p>


<h3 class="typedecl"><a name="type-value">value()</a></h3>
<p><tt>value() = <a href="environment.html#type-value">environment:value()</a></tt></p>
<p> Can be 'undefined' (no difference between a non-registered key and a key
 associated to 'undefined').</p>

<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#check_preferences_default_file-0">check_preferences_default_file/0</a></td><td>Checks that the default preferences file exists; throws an exception
 otherwise.</td></tr>
<tr><td valign="top"><a href="#get-1">get/1</a></td><td>Returns the value associated to each of the specified key(s) in the 
preferences (if any), otherwise 'undefined', based on the default preferences 
file, and possibly launching a corresponding (non-linked) preferences server 
if needed.</td></tr>
<tr><td valign="top"><a href="#get-2">get/2</a></td><td>Returns the value associated to each of the specified key(s) in the 
preferences (if any), otherwise 'undefined', based on the specified 
preferences file (and possibly launching a corresponding (non-linked) 
preferences server if needed) or on the specified PID of an already-running 
preferences server.</td></tr>
<tr><td valign="top"><a href="#get_default_preferences_path-0">get_default_preferences_path/0</a></td><td>Returns the full, absolute path to the default preferences filename.</td></tr>
<tr><td valign="top"><a href="#get_default_preferences_registration_name-0">get_default_preferences_registration_name/0</a></td><td>Returns the default registration name for the preferences.</td></tr>
<tr><td valign="top"><a href="#is_preferences_default_file_available-0">is_preferences_default_file_available/0</a></td><td>Returns whether the default preferences file is available and its full
 path.</td></tr>
<tr><td valign="top"><a href="#set-2">set/2</a></td><td>Associates, if the first argument is a key, in default preferences, the 
specified value to the specified key (possibly overwriting any previous 
value); otherwise the first argument is expected to be a list of key/value 
pairs to be set in the specified preferences server.</td></tr>
<tr><td valign="top"><a href="#set-3">set/3</a></td><td>Associates, in the specified preferences, the specified value to the
 specified key (possibly overwriting any previous value), based on the
 specified preferences file (and possibly launching a corresponding preferences
 server if needed) or on the specified PID of an already-running preferences
 server.</td></tr>
<tr><td valign="top"><a href="#start-0">start/0</a></td><td>Ensures explicitly that, if not running already, the preferences service 
is started and initialised immediately, based on the default preferences file 
path and registered with a deriving name, if wanting an explicit start rather 
than one implied by the first operation onto it.</td></tr>
<tr><td valign="top"><a href="#start-1">start/1</a></td><td>Ensures explicitly that, if not running already, the preferences service 
is started.</td></tr>
<tr><td valign="top"><a href="#start-2">start/2</a></td><td>Ensures explicitly that, if not running already, the preferences service 
is started with the specified registration name, and based on the specified 
file.</td></tr>
<tr><td valign="top"><a href="#start_link-0">start_link/0</a></td><td>Ensures explicitly that, if not running already, the preferences service 
is started and linked, and initialised immediately, based on the default 
preferences file path and registered with a deriving name, if wanting an 
explicit start rather than one implied by the first operation onto it.</td></tr>
<tr><td valign="top"><a href="#start_link-1">start_link/1</a></td><td>Ensures explicitly that, if not running already, the preferences service 
is started and linked.</td></tr>
<tr><td valign="top"><a href="#start_link-2">start_link/2</a></td><td>Ensures explicitly that, if not running already, the preferences service 
is started with the specified registration name and based on the specified 
file, and linked.</td></tr>
<tr><td valign="top"><a href="#stop-0">stop/0</a></td><td>Stops (asynchronously) the default preferences server, if it is running.</td></tr>
<tr><td valign="top"><a href="#to_bin_string-0">to_bin_string/0</a></td><td>Returns a textual description of the preferences server (if any), for
 the default preferences file.</td></tr>
<tr><td valign="top"><a href="#to_string-0">to_string/0</a></td><td>Returns a textual description of the preferences server (if any), for
 the default preferences file.</td></tr>
<tr><td valign="top"><a href="#update_from_etf-1">update_from_etf/1</a></td><td>Updates the default preferences with the entries found in the specified 
ETF file.</td></tr>
<tr><td valign="top"><a href="#update_from_etf-2">update_from_etf/2</a></td><td>Updates the specified preferences with the entries found in the specified 
ETF file.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="check_preferences_default_file-0">check_preferences_default_file/0</a></h3>
<div class="spec">
<p><tt>check_preferences_default_file() -&gt; <a href="#type-void">void()</a></tt><br></p>
<p> </p>
</div><p>Checks that the default preferences file exists; throws an exception
 otherwise.
</p>

<h3 class="function"><a name="get-1">get/1</a></h3>
<div class="spec">
<p><tt>get(KeyMaybes::<a href="#type-maybe_list">maybe_list</a>(<a href="#type-key">key()</a>)) -&gt; <a href="#type-maybe_list">maybe_list</a>(<a href="#type-maybe">maybe</a>(<a href="#type-value">value()</a>))</tt><br></p>
<p> </p>
</div><p><p>Returns the value associated to each of the specified key(s) in the 
preferences (if any), otherwise 'undefined', based on the default preferences 
file, and possibly launching a corresponding (non-linked) preferences server 
if needed.</p>

 <p>Any cached key will be read from the local process cache, not from the 
preferences server.</p>

 <p>Examples:</p>

  <p>"Hello!" = preferences:get(hello)</p>

  ["Hello!", 42, undefined] = preferences:get([hello, my_number, some_maybe])
</p>

<h3 class="function"><a name="get-2">get/2</a></h3>
<div class="spec">
<p><tt>get(KeyMaybes::<a href="#type-maybe_list">maybe_list</a>(<a href="#type-key">key()</a>), EnvData::<a href="#type-preferences_designator">preferences_designator()</a> | <a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-maybe_list">maybe_list</a>(<a href="#type-maybe">maybe</a>(<a href="#type-value">value()</a>))</tt><br></p>
<p> </p>
</div><p><p>Returns the value associated to each of the specified key(s) in the 
preferences (if any), otherwise 'undefined', based on the specified 
preferences file (and possibly launching a corresponding (non-linked) 
preferences server if needed) or on the specified PID of an already-running 
preferences server.</p>

 <p>Any cached key will be read from the local process cache, not from the 
preferences server.</p>

 <p>Examples:</p>

  <p>"Hello!" = preferences:get(hello, "/var/foobar.etf")</p>

  <p>["Hello!", 42, undefined] =     
preferences:get([hello, my_number, some_maybe], my_foobar_preferences)</p>

  ["Hello!", 42, undefined] =
     preferences:get([hello, my_number, some_maybe], MyPrefServerPid)
</p>

<h3 class="function"><a name="get_default_preferences_path-0">get_default_preferences_path/0</a></h3>
<div class="spec">
<p><tt>get_default_preferences_path() -&gt; <a href="#type-file_path">file_path()</a></tt><br></p>
<p> </p>
</div><p>Returns the full, absolute path to the default preferences filename.</p>

<h3 class="function"><a name="get_default_preferences_registration_name-0">get_default_preferences_registration_name/0</a></h3>
<div class="spec">
<p><tt>get_default_preferences_registration_name() -&gt; <a href="#type-pref_reg_name">pref_reg_name()</a></tt><br></p>
<p> </p>
</div><p>Returns the default registration name for the preferences.</p>

<h3 class="function"><a name="is_preferences_default_file_available-0">is_preferences_default_file_available/0</a></h3>
<div class="spec">
<p><tt>is_preferences_default_file_available() -&gt; {boolean(), <a href="#type-file_path">file_path()</a>}</tt><br></p>
<p> </p>
</div><p>Returns whether the default preferences file is available and its full
 path.
</p>

<h3 class="function"><a name="set-2">set/2</a></h3>
<div class="spec">
<p><tt>set(Key::<a href="#type-key">key()</a>, Value::<a href="#type-value">value()</a>) -&gt; <a href="#type-void">void()</a></tt><br></p><p><tt>set(Key::[<a href="#type-entry">entry()</a>], Value::<a href="#type-preferences_designator">preferences_designator()</a> | <a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-void">void()</a></tt><br></p>
<p> </p>
<p> </p>
</div><p><p>Associates, if the first argument is a key, in default preferences, the 
specified value to the specified key (possibly overwriting any previous 
value); otherwise the first argument is expected to be a list of key/value 
pairs to be set in the specified preferences server.</p>

 Any cached key will be updated in the local process cache, in addition to the
 preferences server.
</p>

<h3 class="function"><a name="set-3">set/3</a></h3>
<div class="spec">
<p><tt>set(Key::<a href="#type-key">key()</a>, Value::<a href="#type-value">value()</a>, EnvData::<a href="#type-preferences_designator">preferences_designator()</a> | <a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-void">void()</a></tt><br></p>
<p> </p>
</div><p>Associates, in the specified preferences, the specified value to the
 specified key (possibly overwriting any previous value), based on the
 specified preferences file (and possibly launching a corresponding preferences
 server if needed) or on the specified PID of an already-running preferences
 server.
</p>

<h3 class="function"><a name="start-0">start/0</a></h3>
<div class="spec">
<p><tt>start() -&gt; <a href="#type-preferences_pid">preferences_pid()</a></tt><br></p>
<p> </p>
</div><p><p>Ensures explicitly that, if not running already, the preferences service 
is started and initialised immediately, based on the default preferences file 
path and registered with a deriving name, if wanting an explicit start rather 
than one implied by the first operation onto it.</p>

 <p>Does not link the started preferences server to the calling process.</p>

 Returns in any case the PID of the corresponding preferences server, already
 existing or not.
</p>

<h3 class="function"><a name="start-1">start/1</a></h3>
<div class="spec">
<p><tt>start(AnyParam::<a href="#type-pref_reg_name">pref_reg_name()</a> | <a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-preferences_pid">preferences_pid()</a></tt><br></p>
<p> </p>
</div><p><p>Ensures explicitly that, if not running already, the preferences service 
is started.</p>

 <p>If a name is specified: if no server already registered it, starts it with a 
blank state.</p>

 <p>If instead a filename is specified: if a server with a deriving name is not 
already registered, starts a corresponding server and initialises it with the 
corresponding file content.</p>

 <p>Does not link the started preferences server to the calling process.</p>

 Returns in any case the PID of the corresponding preferences server, already
 existing or not, blank or not.
</p>

<h3 class="function"><a name="start-2">start/2</a></h3>
<div class="spec">
<p><tt>start(ServerName::<a href="#type-pref_reg_name">pref_reg_name()</a>, FilePath::<a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-preferences_pid">preferences_pid()</a></tt><br></p>
<p> </p>
</div><p><p>Ensures explicitly that, if not running already, the preferences service 
is started with the specified registration name, and based on the specified 
file.</p>

 <p>If a server with the specified name is not already registered, starts a 
corresponding server and initialises it with the content of the specified 
file.</p>

 <p>Does not link the started preferences server to the calling process.</p>

 Returns in any case the PID of the corresponding preferences server, already
 existing or not.
</p>

<h3 class="function"><a name="start_link-0">start_link/0</a></h3>
<div class="spec">
<p><tt>start_link() -&gt; <a href="#type-preferences_pid">preferences_pid()</a></tt><br></p>
<p> </p>
</div><p><p>Ensures explicitly that, if not running already, the preferences service 
is started and linked, and initialised immediately, based on the default 
preferences file path and registered with a deriving name, if wanting an 
explicit start rather than one implied by the first operation onto it.</p>

 Returns in any case the PID of the corresponding preferences server, already
 existing or not.
</p>

<h3 class="function"><a name="start_link-1">start_link/1</a></h3>
<div class="spec">
<p><tt>start_link(Param::<a href="#type-pref_reg_name">pref_reg_name()</a> | <a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-preferences_pid">preferences_pid()</a></tt><br></p>
<p> </p>
</div><p><p>Ensures explicitly that, if not running already, the preferences service 
is started and linked.</p>

 <p>If a name is specified: if no server already registered it, starts it with a 
blank state, and links that server to the calling process.</p>

 <p>If instead a filename is specified, if a server with a deriving name is not 
already registered, starts a corresponding server, links it to the calling 
process and initialises it with the file content.</p>

 Returns in any case the PID of the corresponding preferences server, already
 existing or not, blank or not.
</p>

<h3 class="function"><a name="start_link-2">start_link/2</a></h3>
<div class="spec">
<p><tt>start_link(ServerName::<a href="#type-pref_reg_name">pref_reg_name()</a>, FilePath::<a href="#type-file_path">file_path()</a>) -&gt; <a href="#type-preferences_pid">preferences_pid()</a></tt><br></p>
<p> </p>
</div><p><p>Ensures explicitly that, if not running already, the preferences service 
is started with the specified registration name and based on the specified 
file, and linked.</p>

 <p>If a server with the specified name is not already registered, starts a 
corresponding server, links it to the calling process and initialises it with 
the content of the specified file.</p>

 Returns in any case the PID of the corresponding preferences server, already
 existing or not.
</p>

<h3 class="function"><a name="stop-0">stop/0</a></h3>
<div class="spec">
<p><tt>stop() -&gt; <a href="#type-void">void()</a></tt><br></p>
<p> </p>
</div><p><p>Stops (asynchronously) the default preferences server, if it is running.</p>

 Never fails.
</p>

<h3 class="function"><a name="to_bin_string-0">to_bin_string/0</a></h3>
<div class="spec">
<p><tt>to_bin_string() -&gt; <a href="#type-bin_string">bin_string()</a></tt><br></p>
<p> </p>
</div><p>Returns a textual description of the preferences server (if any), for
 the default preferences file.
</p>

<h3 class="function"><a name="to_string-0">to_string/0</a></h3>
<div class="spec">
<p><tt>to_string() -&gt; <a href="#type-ustring">ustring()</a></tt><br></p>
<p> </p>
</div><p>Returns a textual description of the preferences server (if any), for
 the default preferences file.
</p>

<h3 class="function"><a name="update_from_etf-1">update_from_etf/1</a></h3>
<div class="spec">
<p><tt>update_from_etf(AnyETFFilePath::<a href="#type-any_file_path">any_file_path()</a>) -&gt; <a href="#type-void">void()</a></tt><br></p>
<p> </p>
</div><p><p>Updates the default preferences with the entries found in the specified 
ETF file.</p>

 Loaded entries supersede any pre-existing ones.
</p>

<h3 class="function"><a name="update_from_etf-2">update_from_etf/2</a></h3>
<div class="spec">
<p><tt>update_from_etf(AnyETFFilePath::<a href="#type-any_file_path">any_file_path()</a>, PrefDesignator::<a href="#type-preferences_designator">preferences_designator()</a>) -&gt; <a href="#type-void">void()</a></tt><br></p>
<p> </p>
</div><p><p>Updates the specified preferences with the entries found in the specified 
ETF file.</p>

 Loaded entries supersede any pre-existing ones.
</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
