<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module shell_utils</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module shell_utils</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#types">Data Types</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>Gathering of various convenient facilities regarding the management of
 the <b>shells and command lines</b> (ex: specified arguments).


<h2><a name="description">Description</a></h2><p>Gathering of various convenient facilities regarding the management of
 the <b>shells and command lines</b> (ex: specified arguments).</p>

 See shell_utils_test.erl for the corresponding test.

<h2><a name="types">Data Types</a></h2>

<h3 class="typedecl"><a name="type-actual_command_line_option">actual_command_line_option()</a></h3>
<p><tt>actual_command_line_option() = atom()</tt></p>
<p> The name of a command-line option; ex: '-color', for an actual option that is
 "--color". For the init standard module, this is named a "flag".</p>

<h3 class="typedecl"><a name="type-actual_value_count">actual_value_count()</a></h3>
<p><tt>actual_value_count() = <a href="#type-count">count()</a></tt></p>
<p> Non-null expected (otherwise meaningless).</p>

<h3 class="typedecl"><a name="type-any_string">any_string()</a></h3>
<p><tt>any_string() = <a href="text_utils.html#type-any_string">text_utils:any_string()</a></tt></p>


<h3 class="typedecl"><a name="type-argument_table">argument_table()</a></h3>
<p><tt>argument_table() = <a href="list_table.html#type-list_table">list_table:list_table</a>(<a href="#type-command_line_option">command_line_option()</a>, [<a href="#type-command_line_values">command_line_values()</a>])</tt></p>
<p><p> A table storing command-line user (plain, i.e arguments specified after either 
"--" or, preferably, "-extra") arguments conveniently (a bit like getopt), in 
a format exactly in the spirit of init:get_arguments/0, allowing to record 
options possibly repeated more than once, possibly each time with a series of 
values.</p>

 <p>Useful to manage arguments more easily, and also to handle uniformly the 
arguments specified for erl-based executions and escript ones alike.</p>

 <p>Note: to account for repeated options (i.e. options specified more than once 
on the command-line), a list of *lists* of values is associated to each option 
in such argument tables.</p>

 For example, for actual command-line options such as:
   some_value --foo --bar a b --width 15 --bar c
 a corresponding argument table would contain following entries:
    '-foo' -&gt; [ [] ]
    '-bar' -&gt; [ [ "a", "b" ], [ "c" ] ]
    '-width -&gt; [ [ "15" ] ]
     ?no_option_key -&gt; [ "some_value" ]</p>

<h3 class="typedecl"><a name="type-command_line_argument">command_line_argument()</a></h3>
<p><tt>command_line_argument() = {<a href="#type-command_line_option">command_line_option()</a>, [<a href="#type-command_line_values">command_line_values()</a>]}</tt></p>
<p><p> The association between a command-line option and the various values 
associated to its various occurrences, in a (non-unique) argument table.</p>

 <p>Ex: if arguments were "--color blue red [...] --color yellow", then the 
corresponding argument entry is {'-color', [["blue", "red"], ["yellow"]]} 
(i.e. with, associated to a command-line option, a list whose elements are 
*lists* of strings; in their order on the command-line).</p>

 Note that keys are atoms (with one leading dash removed), and it is advisable
 to use only the executable_utils module support rather than mixing and
 matching it with the one of the 'init' module (different keys).</p>

<h3 class="typedecl"><a name="type-command_line_option">command_line_option()</a></h3>
<p><tt>command_line_option() = <a href="#type-actual_command_line_option">actual_command_line_option()</a> | '(none)'</tt></p>
<p> Note the special value ?no_option_key that is associated to option-less
 arguments.</p>

<h3 class="typedecl"><a name="type-command_line_value">command_line_value()</a></h3>
<p><tt>command_line_value() = <a href="text_utils.html#type-ustring">text_utils:ustring()</a></tt></p>
<p> A unitary value specified in link to a command-line option.</p>

<h3 class="typedecl"><a name="type-command_line_values">command_line_values()</a></h3>
<p><tt>command_line_values() = [<a href="#type-command_line_value">command_line_value()</a>]</tt></p>
<p> The command-line values specified after an occurrence of a given option (ex:
 ["blue", "red"]).</p>

<h3 class="typedecl"><a name="type-count">count()</a></h3>
<p><tt>count() = <a href="basic_utils.html#type-count">basic_utils:count()</a></tt></p>


<h3 class="typedecl"><a name="type-format_string">format_string()</a></h3>
<p><tt>format_string() = <a href="text_utils.html#type-format_string">text_utils:format_string()</a></tt></p>


<h3 class="typedecl"><a name="type-format_values">format_values()</a></h3>
<p><tt>format_values() = <a href="text_utils.html#type-format_values">text_utils:format_values()</a></tt></p>


<h3 class="typedecl"><a name="type-option_spec">option_spec()</a></h3>
<p><tt>option_spec() = {<a href="#type-actual_command_line_option">actual_command_line_option()</a>, <a href="#type-value_spec">value_spec()</a>}</tt></p>
<p> A specification of how many values are expected after specified option.</p>

<h3 class="typedecl"><a name="type-return_code">return_code()</a></h3>
<p><tt>return_code() = <a href="system_utils.html#type-return_code">system_utils:return_code()</a></tt></p>


<h3 class="typedecl"><a name="type-unique_argument_table">unique_argument_table()</a></h3>
<p><tt>unique_argument_table() = <a href="list_table.html#type-list_table">list_table:list_table</a>(<a href="#type-command_line_option">command_line_option()</a>, <a href="#type-command_line_values">command_line_values()</a>)</tt></p>
<p><p> A table associating to a given option a (single) list of values (thus not 
having repeated options).</p>

 <p>For example, for actual command-line options such as:   
some_value --foo --bar a b --width 15 
a corresponding argument table would contain following entries:    
'-foo' -&gt; []    
'-bar' -&gt; [ "a", "b" ]    
'-width -&gt; [ "15" ]     
?no_option_key -&gt; [ "some_value" ]</p>

 For convenience, "standard" argument tables may be converted into unique ones.</p>

<h3 class="typedecl"><a name="type-ustring">ustring()</a></h3>
<p><tt>ustring() = <a href="text_utils.html#type-ustring">text_utils:ustring()</a></tt></p>


<h3 class="typedecl"><a name="type-value_count">value_count()</a></h3>
<p><tt>value_count() = <a href="#type-actual_value_count">actual_value_count()</a> | any</tt></p>
<p> How many values (possibly any number thereof - possibly none) are expected
 after a given command-line option.</p>

<h3 class="typedecl"><a name="type-value_spec">value_spec()</a></h3>
<p><tt>value_spec() = <a href="#type-value_count">value_count()</a> | {<a href="#type-actual_value_count">actual_value_count()</a>, <a href="#type-value_count">value_count()</a>}</tt></p>


<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#argument_table_to_string-1">argument_table_to_string/1</a></td><td>Returns a textual representation of the specified argument table.</td></tr>
<tr><td valign="top"><a href="#error-2">error/2</a></td><td>Reports a fatal error, typically in an script/escript context, with the 
specified error return code (expected to be non-null).</td></tr>
<tr><td valign="top"><a href="#error_fmt-3">error_fmt/3</a></td><td>Reports a formatted, fatal error, typically in an script/escript context, 
with the specified error return code (expected to be non-null).</td></tr>
<tr><td valign="top"><a href="#extract_command_arguments_for_option-1">extract_command_arguments_for_option/1</a></td><td>Extracts, for specified command-line option (if any was specified; 
otherwise returns 'undefined') its various in-order lists of associated 
values, from the arguments specified to this executable.</td></tr>
<tr><td valign="top"><a href="#extract_command_arguments_for_option-2">extract_command_arguments_for_option/2</a></td><td>Extracts, for the specified command-line option (if any was specified; 
otherwise returns 'undefined') its various in-order lists of associated 
values, from the specified argument table.</td></tr>
<tr><td valign="top"><a href="#extract_optionless_command_arguments-0">extract_optionless_command_arguments/0</a></td><td>Extracts the in-order list of the arguments that were directly (that is 
not in the context of an option) specified on the command-line for this 
executable.</td></tr>
<tr><td valign="top"><a href="#extract_optionless_command_arguments-1">extract_optionless_command_arguments/1</a></td><td>Extracts, for the specified command-line option (if any was specified; 
otherwise returns 'undefined') its various in-order lists of associated 
values, from the specified argument table.</td></tr>
<tr><td valign="top"><a href="#generate_argument_table-1">generate_argument_table/1</a></td><td>Returns a canonical argument table, obtained from the specified single 
string containing all options, verbatim; ex: "--color red --set-foo".</td></tr>
<tr><td valign="top"><a href="#get_argument_table-0">get_argument_table/0</a></td><td>Returns a canonical argument table, obtained from the user command-line 
arguments supplied to the interpreter.</td></tr>
<tr><td valign="top"><a href="#get_argument_table_from_strings-1">get_argument_table_from_strings/1</a></td><td>Returns the specified command-line arguments (simply transmitted as a 
list of the corresponding strings) once transformed into our "canonical", more 
convenient form, which is quite similar to the one used by Erlang for its 
user/system flags (that is for all its non-plain options).</td></tr>
<tr><td valign="top"><a href="#get_command_arguments_for_option-1">get_command_arguments_for_option/1</a></td><td>Returns, if this option was specified on the command-line, the in-order 
list of the various (lists of) values (if any; no value at all being specified 
for an option resulting thus in [ [] ]) associated to the specified option; if 
this option was not specified on the command-line, returns 'undefined'.</td></tr>
<tr><td valign="top"><a href="#get_command_line_arguments-2">get_command_line_arguments/2</a></td><td>Generates a table from the arguments that were specified on the 
command-line for this executable, assigning to each of the specified 
command-line options the corresponding number of values.</td></tr>
<tr><td valign="top"><a href="#get_command_line_arguments-3">get_command_line_arguments/3</a></td><td>Reorganizes specified argument table, assigning to each of its 
command-line options the corresponding number of values.</td></tr>
<tr><td valign="top"><a href="#get_optionless_command_arguments-0">get_optionless_command_arguments/0</a></td><td>Returns the in-order list of the arguments that were directly (that is 
not in the context of an option) specified on the command-line.</td></tr>
<tr><td valign="top"><a href="#protect_from_shell-1">protect_from_shell/1</a></td><td>Protects specified argument from shell parsing, typically if specifying a 
filename including a single quote.</td></tr>
<tr><td valign="top"><a href="#uniquify_argument_table-1">uniquify_argument_table/1</a></td><td>Transforms specified argument table (possibly with repeated options) into 
a unique argument table (thus with just a list of values associated to each 
option).</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="argument_table_to_string-1">argument_table_to_string/1</a></h3>
<div class="spec">
<p><tt>argument_table_to_string(ArgTable::<a href="#type-argument_table">argument_table()</a>) -&gt; <a href="#type-ustring">ustring()</a></tt><br></p>
<p> </p>
</div><p>Returns a textual representation of the specified argument table.</p>

<h3 class="function"><a name="error-2">error/2</a></h3>
<div class="spec">
<p><tt>error(ErrorCode::<a href="#type-return_code">return_code()</a>, Message::<a href="#type-ustring">ustring()</a>) -&gt; no_return()</tt><br></p>
<p> </p>
</div><p><p>Reports a fatal error, typically in an script/escript context, with the 
specified error return code (expected to be non-null).</p>

 <p>The message shall preferably not begin with an uppercase letter.</p>

 Halts on error the current program.
</p>

<h3 class="function"><a name="error_fmt-3">error_fmt/3</a></h3>
<div class="spec">
<p><tt>error_fmt(ErrorCode::<a href="#type-return_code">return_code()</a>, Format::<a href="#type-format_string">format_string()</a>, Values::<a href="#type-format_values">format_values()</a>) -&gt; no_return()</tt><br></p>
<p> </p>
</div><p><p>Reports a formatted, fatal error, typically in an script/escript context, 
with the specified error return code (expected to be non-null).</p>

 <p>The message shall preferably not begin with an uppercase letter.</p>

 Halts on error the current program.
</p>

<h3 class="function"><a name="extract_command_arguments_for_option-1">extract_command_arguments_for_option/1</a></h3>
<div class="spec">
<p><tt>extract_command_arguments_for_option(Option::<a href="#type-command_line_option">command_line_option()</a>) -&gt; {<a href="#type-maybe">maybe</a>([<a href="#type-command_line_values">command_line_values()</a>]), <a href="#type-argument_table">argument_table()</a>}</tt><br></p>
<p> </p>
</div><p><p>Extracts, for specified command-line option (if any was specified; 
otherwise returns 'undefined') its various in-order lists of associated 
values, from the arguments specified to this executable.</p>

 <p>Returns a pair made of these lists of (lists of) values and of the shrunk 
corresponding argument table.</p>

 Note: a value set to 'undefined' means that the specified option is not in the
 specified table, whereas a value set to [ [] ] means that this option is in
 the table, yet that no parameter has been specified for it.
</p>

<h3 class="function"><a name="extract_command_arguments_for_option-2">extract_command_arguments_for_option/2</a></h3>
<div class="spec">
<p><tt>extract_command_arguments_for_option(Option::<a href="#type-command_line_option">command_line_option()</a>, ArgumentTable::<a href="#type-argument_table">argument_table()</a>) -&gt; {<a href="#type-maybe">maybe</a>([<a href="#type-command_line_values">command_line_values()</a>]), <a href="#type-argument_table">argument_table()</a>}</tt><br></p>
<p> </p>
</div><p><p>Extracts, for the specified command-line option (if any was specified; 
otherwise returns 'undefined') its various in-order lists of associated 
values, from the specified argument table.</p>

 <p>Returns a pair made of these lists of (lists of) values and of the shrunk 
corresponding argument table.</p>

 Note: a value set to 'undefined' means that the specified option is not in the
 specified table, whereas a value set to [ [] ] means that this option is in
 the table, yet that no parameter has been specified for it.
</p>

<h3 class="function"><a name="extract_optionless_command_arguments-0">extract_optionless_command_arguments/0</a></h3>
<div class="spec">
<p><tt>extract_optionless_command_arguments() -&gt; {<a href="#type-maybe">maybe</a>([<a href="#type-command_line_values">command_line_values()</a>]), <a href="#type-argument_table">argument_table()</a>}</tt><br></p>
<p> </p>
</div><p><p>Extracts the in-order list of the arguments that were directly (that is 
not in the context of an option) specified on the command-line for this 
executable.</p>

 Returns a pair made of these lists of values and of the shrunk corresponding
 argument table.
</p>

<h3 class="function"><a name="extract_optionless_command_arguments-1">extract_optionless_command_arguments/1</a></h3>
<div class="spec">
<p><tt>extract_optionless_command_arguments(ArgumentTable::<a href="#type-argument_table">argument_table()</a>) -&gt; {<a href="#type-maybe">maybe</a>([<a href="#type-command_line_values">command_line_values()</a>]), <a href="#type-argument_table">argument_table()</a>}</tt><br></p>
<p> </p>
</div><p><p>Extracts, for the specified command-line option (if any was specified; 
otherwise returns 'undefined') its various in-order lists of associated 
values, from the specified argument table.</p>

 <p>Returns a pair made of these lists of (lists of) values and of the shrunk 
corresponding argument table.</p>

 Note: a value set to 'undefined' means that the specified option is not in the
 specified table, whereas a value set to [ [] ] means that this option is in
 the table, yet that no parameter has been specified for it.
</p>

<h3 class="function"><a name="generate_argument_table-1">generate_argument_table/1</a></h3>
<div class="spec">
<p><tt>generate_argument_table(ArgString::<a href="#type-ustring">ustring()</a>) -&gt; <a href="#type-argument_table">argument_table()</a></tt><br></p>
<p> </p>
</div><p><p>Returns a canonical argument table, obtained from the specified single 
string containing all options, verbatim; ex: "--color red --set-foo".</p>

 Note: useful for testing, to introduce specific command lines.
</p>

<h3 class="function"><a name="get_argument_table-0">get_argument_table/0</a></h3>
<div class="spec">
<p><tt>get_argument_table() -&gt; <a href="#type-argument_table">argument_table()</a></tt><br></p>
<p> </p>
</div><p><p>Returns a canonical argument table, obtained from the user command-line 
arguments supplied to the interpreter.</p>

 <p>Note:</p>

 <p>- only the arguments specified on the command-line after the '-extra' marker 
will be taken into account; ex:    
make ui_run CMD_LINE_OPT="-a -extra some_value -b --use-ui-backend text_ui" 
(here "-a" and, of course, "-extra", will be ignored)</p>

 - this function is to be called in the context of a standard erl execution (as
 opposed to an escript one, which shall use script_utils:get_arguments/1)
</p>

<h3 class="function"><a name="get_argument_table_from_strings-1">get_argument_table_from_strings/1</a></h3>
<div class="spec">
<p><tt>get_argument_table_from_strings(ArgStrings::[<a href="#type-ustring">ustring()</a>]) -&gt; <a href="#type-argument_table">argument_table()</a></tt><br></p>
<p> </p>
</div><p><p>Returns the specified command-line arguments (simply transmitted as a 
list of the corresponding strings) once transformed into our "canonical", more 
convenient form, which is quite similar to the one used by Erlang for its 
user/system flags (that is for all its non-plain options).</p>

 <p>In this form, options start with a dash, may have any number of arguments, and 
may be specified more than once in the command-line; non-option arguments are 
collected as well (refer to the no_option_key define).</p>

 Note: switches to the Unicode encoding (ex: use "~tp" then).
</p>

<h3 class="function"><a name="get_command_arguments_for_option-1">get_command_arguments_for_option/1</a></h3>
<div class="spec">
<p><tt>get_command_arguments_for_option(Option::<a href="#type-command_line_option">command_line_option()</a>) -&gt; <a href="#type-maybe">maybe</a>([<a href="#type-command_line_values">command_line_values()</a>])</tt><br></p>
<p> </p>
</div><p><p>Returns, if this option was specified on the command-line, the in-order 
list of the various (lists of) values (if any; no value at all being specified 
for an option resulting thus in [ [] ]) associated to the specified option; if 
this option was not specified on the command-line, returns 'undefined'.</p>

 Note: generally the extract_command_arguments_for_option/{1,2} functions are
 more relevant to use.
</p>

<h3 class="function"><a name="get_command_line_arguments-2">get_command_line_arguments/2</a></h3>
<div class="spec">
<p><tt>get_command_line_arguments(OptionlessSpec::<a href="#type-value_spec">value_spec()</a>, OptionSpecs::[<a href="#type-option_spec">option_spec()</a>]) -&gt; <a href="#type-unique_argument_table">unique_argument_table()</a></tt><br></p>
<p> </p>
</div><p><p>Generates a table from the arguments that were specified on the 
command-line for this executable, assigning to each of the specified 
command-line options the corresponding number of values.</p>

 <p>Should, for a given option, less values be found on the command-line than 
declared, an error will be raised; should more values be found, the extra ones 
will be considered as option-less arguments, and stored as such. Should a 
non-declared option be found, raises an error as well.</p>

 Note: the order of the declared options spec does not matter.
</p>

<h3 class="function"><a name="get_command_line_arguments-3">get_command_line_arguments/3</a></h3>
<div class="spec">
<p><tt>get_command_line_arguments(OptionlessSpec::<a href="#type-value_spec">value_spec()</a>, OptionSpecs::[<a href="#type-option_spec">option_spec()</a>], ArgumentTable::<a href="#type-argument_table">argument_table()</a>) -&gt; <a href="#type-unique_argument_table">unique_argument_table()</a></tt><br></p>
<p> </p>
</div><p><p>Reorganizes specified argument table, assigning to each of its 
command-line options the corresponding number of values.</p>

 <p>Should, for a given option, less values be found than declared, an error will 
be raised; should more values be found, the extra ones will be considered as 
option-less arguments, and stored as such. Should a non-declared option be 
found, an error is raised.</p>

 Note: the order of the declared options spec does not matter.
</p>

<h3 class="function"><a name="get_optionless_command_arguments-0">get_optionless_command_arguments/0</a></h3>
<div class="spec">
<p><tt>get_optionless_command_arguments() -&gt; <a href="#type-command_line_values">command_line_values()</a></tt><br></p>
<p> </p>
</div><p><p>Returns the in-order list of the arguments that were directly (that is 
not in the context of an option) specified on the command-line.</p>

 Note: generally the extract_optionless_command_arguments/{0,1} functions are
 more relevant to use.
</p>

<h3 class="function"><a name="protect_from_shell-1">protect_from_shell/1</a></h3>
<div class="spec">
<p><tt>protect_from_shell(ArgString::<a href="#type-any_string">any_string()</a>) -&gt; <a href="#type-any_string">any_string()</a></tt><br></p>
<p> </p>
</div><p><p>Protects specified argument from shell parsing, typically if specifying a 
filename including a single quote.</p>

 <p>Note: currently does not transform binary arguments (double conversion with 
improperly encoded strings might be tricky).</p>

 When executing third-party programs, in order to avoid any need of protecting
 their arguments, a system_utils:run_executable/n variation ought to be used.
</p>

<h3 class="function"><a name="uniquify_argument_table-1">uniquify_argument_table/1</a></h3>
<div class="spec">
<p><tt>uniquify_argument_table(ArgumentTable::<a href="#type-argument_table">argument_table()</a>) -&gt; <a href="#type-unique_argument_table">unique_argument_table()</a></tt><br></p>
<p> </p>
</div><p><p>Transforms specified argument table (possibly with repeated options) into 
a unique argument table (thus with just a list of values associated to each 
option).</p>

 Should options be repeated in the specified table, their values will be merged
 (concatenated in-order into a single list, rather than the prior list of
 lists).
</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
