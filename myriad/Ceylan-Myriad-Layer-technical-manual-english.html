<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.13.1: http://docutils.sourceforge.net/" />
<title>Welcome to the Ceylan-Myriad documentation</title>
<meta content="Myriad, generic, general-purpose, helper code, library, layer" name="keywords" />
<link rel="stylesheet" href="pygments-default.css" type="text/css" />
<link rel="stylesheet" href="myriad.css" type="text/css" />
<link rel="stylesheet" href="/usr/share/docutils/writers/html5_polyglot/math.css" type="text/css" />
<link href="myriad-icon.png" rel="icon">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="document" id="technical-manual-of-the-ceylan-myriad-layer">
<h1 class="title">Technical Manual of the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> Layer</h1>

<span class="target" id="top"></span><p><span class="raw-html"><a name="myriad_top"></a></span></p>
<p><span class="raw-html"><div class="banner"><p><em>Myriad documentation</em> <a href="http://myriad.esperide.org">browse latest</a> <a href="https://olivier-boudeville.github.io/Ceylan-Myriad/index.html">browse mirror</a> <a href="Ceylan-Myriad-Layer-technical-manual-english.pdf">get PDF</a> <a href="#myriad_top">go to top</a> <a href="#myriad_toc">go to toc</a> <a href="#myriad_bottom">go to bottom</a> <a href="api-doc/index.html">browse API</a> <a href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">go to project</a> <a href="mailto:about(dash)myriad(at)esperide(dot)com?subject=[Ceylan-Myriad]%20Remark">email us</a></p></div></span></p>
<p><span class="raw-html"><center><img src="myriad-title.png" id="responsive-image-small"></img></span>
</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Organisation:</th><td class="field-body"><p class="first">Copyright (C) 2008-2022 Olivier Boudeville</p>
</td>
</tr>
<tr class="field"><th class="field-name">Contact:</th><td class="field-body"><p class="first">about (dash) myriad (at) esperide (dot) com</p>
</td>
</tr>
<tr class="field"><th class="field-name">Creation date:</th><td class="field-body"><p class="first">Sunday, August 17, 2008</p>
</td>
</tr>
<tr class="field"><th class="field-name">Lastly updated:</th><td class="field-body"><p class="first">Tuesday, January 11, 2022</p>
</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body"><p class="first">1.0.22</p>
</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body"><p class="first">Stable</p>
</td>
</tr>
<tr class="field"><th class="field-name">Dedication:</th><td class="field-body"><p class="first">Users and maintainers of the <tt class="docutils literal">Myriad</tt> layer.</p>
</td>
</tr>
<tr class="field"><th class="field-name">Abstract:</th><td class="field-body"><p class="first">The role of the <a class="reference external" href="http://myriad.esperide.org/">Myriad</a> layer (part of the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan">Ceylan</a> project) is to gather all <a class="reference external" href="http://erlang.org">Erlang</a> general-purpose base constructs that we found useful for (Erlang-based) developments.</p>
<p class="last">We present here a short overview of these services, to introduce them to newcomers.
The next level of information is either to browse the <a class="reference external" href="api-doc/index.html">Myriad API documentation</a> or simply to read the corresponding <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">source files</a>, which are intensely commented and generally straightforward.</p>
</td>
</tr>
</tbody>
</table>
<p><span class="raw-html"></center></span></p>
<p>The latest version of this documentation is to be found at the <a class="reference external" href="http://myriad.esperide.org">official Ceylan-Myriad website</a> (<tt class="docutils literal"><span class="pre">http://myriad.esperide.org</span></tt>).</p>
<p><span class="raw-html">This Myriad documentation is also available in the PDF format (see <a href="Ceylan-Myriad-Layer-technical-manual-english.pdf">Ceylan-Myriad-Layer-technical-manual-english.pdf</a>), and mirrored <a href="http://olivier-boudeville.github.io/Ceylan-Myriad/">here</a>.</span></p>
<p></p>
<p></p>
<p><span class="raw-html"><a name="myriad_toc"></a></span></p>
<div class="contents topic" id="id1">
<span id="table-of-contents"></span><p class="topic-title first"><strong>Table of Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#overview-context" id="id103">Overview &amp; Context</a></li>
<li><a class="reference internal" href="#usage-guidelines" id="id104">Usage Guidelines</a><ul>
<li><a class="reference internal" href="#license" id="id105">License</a></li>
<li><a class="reference internal" href="#about-layers" id="id106">About Layers</a></li>
<li><a class="reference internal" href="#recommended-usage-contribution" id="id107">Recommended Usage &amp; Contribution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-myriad" id="id108">Getting Myriad</a><ul>
<li><a class="reference internal" href="#id6" id="id109">Prerequisites</a><ul>
<li><a class="reference internal" href="#supported-platforms" id="id110">Supported Platforms</a></li>
<li><a class="reference internal" href="#software-prerequisites" id="id111">Software Prerequisites</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-myriad-s-sources" id="id112">Getting Myriad's Sources</a></li>
<li><a class="reference internal" href="#building-myriad" id="id113">Building Myriad</a></li>
<li><a class="reference internal" href="#testing-myriad" id="id114">Testing Myriad</a></li>
<li><a class="reference internal" href="#type-checking-myriad" id="id115">Type-checking Myriad</a></li>
<li><a class="reference internal" href="#maintaining-myriad-and-deriving-projects-with-regard-to-rebar3" id="id116">Maintaining Myriad and Deriving Projects with regard to rebar3</a></li>
<li><a class="reference internal" href="#id19" id="id117">OTP Build</a><ul>
<li><a class="reference internal" href="#why-providing-two-different-build-deploy-run-systems" id="id118">Why Providing Two Different Build/Deploy/Run Systems</a></li>
<li><a class="reference internal" href="#relying-on-rebar3" id="id119">Relying on Rebar3</a></li>
<li><a class="reference internal" href="#otp-application" id="id120">OTP Application</a></li>
<li><a class="reference internal" href="#otp-release" id="id121">OTP Release</a></li>
<li><a class="reference internal" href="#hex-package" id="id122">Hex Package</a></li>
<li><a class="reference internal" href="#other-otp-related-make-targets-of-interest" id="id123">Other OTP-related Make Targets of Interest</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#services-offered-by-the-myriad-layer" id="id124">Services offered by the <tt class="docutils literal">Myriad</tt> Layer</a><ul>
<li><a class="reference internal" href="#general-build-structure" id="id125">General Build Structure</a></li>
<li><a class="reference internal" href="#general-settings" id="id126">General Settings</a></li>
<li><a class="reference internal" href="#maths-services" id="id127">Maths Services</a></li>
<li><a class="reference internal" href="#data-management-services" id="id128">Data-Management Services</a><ul>
<li><a class="reference internal" href="#datatypes" id="id129">Datatypes</a></li>
<li><a class="reference internal" href="#file-formats" id="id130">File Formats</a></li>
<li><a class="reference internal" href="#regarding-data-exchange" id="id131">Regarding Data Exchange</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support-for-code-injection" id="id132">Support for Code Injection</a><ul>
<li><a class="reference internal" href="#defining-a-token" id="id133">Defining a token</a></li>
<li><a class="reference internal" href="#defining-the-code-to-inject" id="id134">Defining the code to inject</a></li>
<li><a class="reference internal" href="#using-tokens-to-enable-code-injection" id="id135">Using tokens to enable code injection</a></li>
<li><a class="reference internal" href="#controlling-assertions" id="id136">Controlling assertions</a></li>
<li><a class="reference internal" href="#usage-hints" id="id137">Usage Hints</a></li>
<li><a class="reference internal" href="#for-more-information" id="id138">For more information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#myriadgui-helpers-for-user-interface-programming" id="id139">MyriadGUI: Helpers For User Interface Programming</a><ul>
<li><a class="reference internal" href="#various-flavours-of-user-interfaces" id="id140">Various Flavours of User Interfaces</a></li>
<li><a class="reference internal" href="#raw-text-user-interface-text-ui" id="id141">Raw Text User Interface: <tt class="docutils literal">text_ui</tt></a></li>
<li><a class="reference internal" href="#terminal-text-user-interface-term-ui" id="id142">Terminal Text User Interface: <tt class="docutils literal">term_ui</tt></a></li>
<li><a class="reference internal" href="#graphical-user-interface-gui" id="id143">Graphical User Interface: <tt class="docutils literal">gui</tt></a></li>
<li><a class="reference internal" href="#audio-user-interface" id="id144">Audio User Interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#myriad-s-helper-shell-scripts" id="id145">Myriad's Helper Shell Scripts</a><ul>
<li><a class="reference internal" href="#erlang-dedicated-scripts" id="id146">Erlang-Dedicated Scripts</a></li>
<li><a class="reference internal" href="#more-general-scripts" id="id147">More General Scripts</a></li>
<li><a class="reference internal" href="#script-based-apps" id="id148">Script-based Apps</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utility-toolbox" id="id149">Utility Toolbox</a></li>
<li><a class="reference internal" href="#support-for-metaprogramming" id="id150">Support for Metaprogramming</a></li>
<li><a class="reference internal" href="#spatial-support" id="id151">Spatial Support</a><ul>
<li><a class="reference internal" href="#motivation" id="id152">Motivation</a></li>
<li><a class="reference internal" href="#conventions" id="id153">Conventions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#management-of-units" id="id154">Management of Units</a><ul>
<li><a class="reference internal" href="#id81" id="id155">Motivation</a></li>
<li><a class="reference internal" href="#available-support" id="id156">Available Support</a></li>
<li><a class="reference internal" href="#specifying-units" id="id157">Specifying Units</a></li>
<li><a class="reference internal" href="#possible-improvements-regarding-dimensional-analysis" id="id158">Possible Improvements Regarding Dimensional Analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-support" id="id159">SQL support</a><ul>
<li><a class="reference internal" href="#about-sql" id="id160">About SQL</a></li>
<li><a class="reference internal" href="#database-backends" id="id161">Database Backends</a></li>
<li><a class="reference internal" href="#myriad-sql-support" id="id162">Myriad SQL Support</a></li>
<li><a class="reference internal" href="#sql-related-troubleshooting" id="id163">SQL-related Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#myriad-main-conventions" id="id164"><tt class="docutils literal">Myriad</tt> Main Conventions</a><ul>
<li><a class="reference internal" href="#text-conventions" id="id165">Text Conventions</a></li>
<li><a class="reference internal" href="#coding-practices" id="id166">Coding Practices</a></li>
<li><a class="reference internal" href="#execution-targets" id="id167">Execution Targets</a></li>
<li><a class="reference internal" href="#tooling-conventions" id="id168">Tooling Conventions</a><ul>
<li><a class="reference internal" href="#erlang-ls" id="id169">Erlang LS</a></li>
<li><a class="reference internal" href="#for-documentation-generation" id="id170">For Documentation Generation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-conventions" id="id171">Other Conventions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#myriad-related-troubleshooting" id="id172"><tt class="docutils literal">Myriad</tt>-related Troubleshooting</a><ul>
<li><a class="reference internal" href="#header-module-dependencies" id="id173">Header/Module Dependencies</a></li>
<li><a class="reference internal" href="#third-party-dependencies" id="id174">Third-Party Dependencies</a><ul>
<li><a class="reference internal" href="#runtime-only-third-party-dependencies" id="id175">Runtime-only Third-Party Dependencies</a></li>
<li><a class="reference internal" href="#build-time-third-party-dependencies" id="id176">Build-time Third-Party Dependencies</a></li>
<li><a class="reference internal" href="#myriad-level-third-party-dependencies" id="id177">Myriad-level Third-Party Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#about-the-table-module" id="id178">About the <tt class="docutils literal">table</tt> module</a></li>
<li><a class="reference internal" href="#enabling-the-interconnection-of-erlang-nodes" id="id179">Enabling the Interconnection of Erlang nodes</a><ul>
<li><a class="reference internal" href="#safety-measures" id="id180">Safety Measures</a></li>
<li><a class="reference internal" href="#testing-troubleshooting" id="id181">Testing &amp; Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-erlang-shell-for-debugging" id="id182">Using the Erlang Shell for Debugging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support-for-myriad" id="id183">Support for <tt class="docutils literal">Myriad</tt></a></li>
<li><a class="reference internal" href="#please-react" id="id184">Please React!</a></li>
<li><a class="reference internal" href="#contributions-ending-word" id="id185">Contributions &amp; Ending Word</a></li>
</ul>
</div>
<p></p>
<div class="section" id="overview-context">
<h1><a class="toc-backref" href="#id103">Overview &amp; Context</a></h1>
<p>When using any programming language, there are always <strong>recurring patterns</strong> that prove useful.</p>
<p>Instead of writing them again and again, we preferred gathering them all in a <strong>low-level layer</strong> (mostly a modest yet organised, uniform, consistent <strong>code library</strong>), in their most convenient, reliable, efficient version, together with their specification, documentation and testing.</p>
<p>This <strong>toolbox layer</strong> provides its (generally lightweight, simple) services just on top of the <a class="reference external" href="http://erlang.org">Erlang</a> <a class="footnote-reference" href="#id4" id="id3">[3]</a> language, as a relatively small (comprising currently about 115k lines of code, including blank ones and comments), thin layer. Supported platforms are most Unices (including of course GNU/linux) and also - but to a lesser extent, i.e. not tested on a daily basis - <a class="reference internal" href="#windows">Windows</a>.</p>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><p class="first">If needing to discover/learn Erlang, we recommend browsing <a class="reference external" href="https://learnyousomeerlang.com">Learn You Some Erlang for great good!</a> or, even better, buying their book!</p>
<p class="last">See also our <a class="reference external" href="http://howtos.esperide.org/Erlang.html">Erlang HOW-TO</a>.</p>
</td></tr>
</tbody>
</table>
<p>These services tend to stay away from introducing any new <strong>dependency</strong>; however many supports (of OpenGL, JSON, Protobuf, SQL, HDF5, etc.; also in terms of GUI or integration with other languages) may be useful, and are to rely on well-chosen and well-integrated backends.</p>
<p>So, should a key, generic service need a third-party prerequisite (ex: library to manage a complex data format, or to process specific data), that dependency should be made <strong>fully optional</strong> (see the <a class="reference internal" href="#third-party-dependencies">Third-Party Dependencies</a> section for more details), in a logic of containment: if, for any reason, a dependency has to be replaced, the goal is that the user code can remain, as much as realistically possible, happily unaware of it - only the Myriad integration layer being impacted.</p>
<p>The purpose of Myriad is not to fully integrate the many backends it <em>may</em> rely on (it would be an unachievable task) but, once a proper integration base has been defined for a given backend, to pragmatically increase its coverage based on the actual needs.</p>
<p>As a consequence, for the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan">Ceylan</a> project, the first level of the Erlang-based software stack that we use relies on this <tt class="docutils literal">Myriad</tt> layer - whose official, more specific name is the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> layer.</p>
<p>The project repository is located <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">here</a>. We gathered also some more general Erlang-information in <a class="reference external" href="http://howtos.esperide.org/Erlang.html">our corresponding HOWTO</a>.</p>
</div>
<div class="section" id="usage-guidelines">
<h1><a class="toc-backref" href="#id104">Usage Guidelines</a></h1>
<div class="section" id="license">
<h2><a class="toc-backref" href="#id105">License</a></h2>
<p>The <tt class="docutils literal">Myriad</tt> layer is licensed by its author (Olivier Boudeville) under a disjunctive tri-license, giving you the choice of one of the three following sets of free software/open source licensing terms:</p>
<ul class="simple">
<li>the <a class="reference external" href="http://www.mozilla.org/MPL/MPL-1.1.html">Mozilla Public License</a> (MPL), version 1.1 or later (very close to the former <a class="reference external" href="http://www.erlang.org/EPLICENSE">Erlang Public License</a>, except aspects regarding Ericsson and/or the Swedish law)</li>
<li>the <a class="reference external" href="http://www.gnu.org/licenses/gpl-3.0.html">GNU General Public License</a> (GPL), version 3.0 or later</li>
<li>the <a class="reference external" href="http://www.gnu.org/licenses/lgpl.html">GNU Lesser General Public License</a> (LGPL), version 3.0 or later</li>
</ul>
<p>This allows the use of the <tt class="docutils literal">Myriad</tt> code in as wide a variety of software projects as possible, while still maintaining copyleft on this code.</p>
<p>Being triple-licensed means that someone (the licensee) who modifies and/or distributes it can choose which of the available sets of licence terms he/she is operating under.</p>
<p>Enhancements are expected to be back-contributed (hopefully), so that everyone can benefit from them.</p>
</div>
<div class="section" id="about-layers">
<h2><a class="toc-backref" href="#id106">About Layers</a></h2>
<p>The <tt class="docutils literal">Myriad</tt> services are to be used by this layer itself (for its inner workings), and, more importantly, are to be re-used, specialised and enriched by layers built on top of it.</p>
<p>The general rule is that a layer may depend on (i.e. make use of) all layers <em>below</em> it (not only the one just preceding it), but cannot refer to any layer <em>above</em> it (it should be literally unaware of their existence).</p>
<p>So, in a bottom-up view, generally a software stack mentioned here begins with the operating system (typically GNU/Linux), then <a class="reference external" href="http://erlang.org">Erlang/OTP</a>, then <tt class="docutils literal">Myriad</tt>, then any layer(s) built on top of them (ex: <a class="reference external" href="http://wooper.esperide.org">WOOPER</a>).</p>
<p>Of course a given layer does not mask the layers below; for example programs using the <tt class="docutils literal">Myriad</tt> layer typically use also a lot the services brought by the <a class="reference external" href="http://erlang.org/erldoc">Erlang base libraries</a>.</p>
</div>
<div class="section" id="recommended-usage-contribution">
<h2><a class="toc-backref" href="#id107">Recommended Usage &amp; Contribution</a></h2>
<p>When developing Ceylan-based code, if needing a service already provided by this <tt class="docutils literal">Myriad</tt> layer, it is strongly advised to use that service and, possibly (if useful), expand or enrich it, with backward compatibility in mind.</p>
<p>If such a service is not provided by the current version of the layer, yet is deemed generic enough, then it should preferably be added directly to the relevant part of the library and called from the code that was needing it.</p>
<p>Of course, contributions of all sorts are welcome.</p>
<p>We do our best to test, at least lightly, each element provided. All services offered in a <tt class="docutils literal">foo.erl</tt> file are thus expected to be tested in the companion <tt class="docutils literal">foo_test.erl</tt> file, in the <tt class="docutils literal">test</tt> tree (whose structure tends to mirror the one of the <tt class="docutils literal">src</tt> tree). Once there, running this test is as simple as executing:</p>
<pre class="code bash literal-block">
$ make foo_run
</pre>
<p>Note that however we have not reached the discipline level of an exhaustive <tt class="docutils literal">eunit</tt> test suite for each service (most of them being almost trivial).</p>
<p>The <a class="reference external" href="http://erlang.org/doc/apps/dialyzer/dialyzer_chapter.html">Dialyzer</a> static analysis tool is regularly run on the code base (see the <tt class="docutils literal"><span class="pre">generate-local-plt</span></tt> and <tt class="docutils literal"><span class="pre">self-check-against-plt</span></tt> generic Make targets for that).</p>
</div>
</div>
<div class="section" id="getting-myriad">
<h1><a class="toc-backref" href="#id108">Getting Myriad</a></h1>
<div class="section" id="id6">
<span id="prerequisites"></span><h2><a class="toc-backref" href="#id109">Prerequisites</a></h2>
<div class="section" id="supported-platforms">
<h3><a class="toc-backref" href="#id110">Supported Platforms</a></h3>
<p>The <strong>operating system</strong> is supposed to be most Unices, in particular any not-so-old <tt class="docutils literal">GNU/Linux</tt> distribution <a class="footnote-reference" href="#id8" id="id7">[4]</a>.</p>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[4]</a></td><td>For what it is worth, we prefer <a class="reference external" href="https://www.archlinux.org/">Arch Linux</a>, but this does not really matter here.</td></tr>
</tbody>
</table>
<p id="windows">Myriad can be built and tested successfully on the <tt class="docutils literal">Windows</tt> platform; for that we rely on <a class="reference external" href="https://www.msys2.org/">MSYS2</a>. Refer to <a class="reference external" href="http://hull.esperide.org#windows-support">this section</a> of Ceylan-Hull for information regarding our recommended Windows developer settings in terms of shells and general environment.</p>
<p>People reported uses of Myriad on <tt class="docutils literal">macOS</tt>, yet no extensive testing has been done there.</p>
</div>
<div class="section" id="software-prerequisites">
<span id="id9"></span><span id="getting-erlang"></span><h3><a class="toc-backref" href="#id111">Software Prerequisites</a></h3>
<p>The main tool prerequisite is of course having the <a class="reference external" href="http://erlang.org">Erlang</a> environment available, in its <tt class="docutils literal">24.0</tt> version <a class="footnote-reference" href="#id12" id="id11">[5]</a> or more recent.</p>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[5]</a></td><td><p class="first">Most probably that older versions of Erlang would be more than sufficient in order to build Myriad (possibly at the expense of minor changes in a few calls to standard modules having been deprecated since then). It is just that in general we prefer to stick to the latest stable versions of software such as Erlang, and advise you to do so.</p>
<p class="last">To determine the recommended version of Myriad-based code, just execute our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/install-erlang.sh">install-erlang.sh</a> script with its <tt class="docutils literal"><span class="pre">--version</span></tt> option.</p>
</td></tr>
</tbody>
</table>
<p>There are various ways of obtaining it (from your distribution, from prebuilt packages, directly from the sources), one of which being the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/install-erlang.sh">install-erlang.sh</a> script that we devised.</p>
<p>A simple use of it is:</p>
<pre class="code bash literal-block">
$ ./install-erlang.sh --doc-install --generate-plt
</pre>
<p>One may execute <tt class="docutils literal"><span class="pre">./install-erlang.sh</span> <span class="pre">--help</span></tt> for more guidance about how to configure it, notably in order to enable all modules of interest (<tt class="docutils literal">crypto</tt>, <tt class="docutils literal">wx</tt>, etc.). See also the <a class="reference internal" href="#gui-backend">GUI Backend</a> section to secure any related prerequisite.</p>
</div>
</div>
<div class="section" id="getting-myriad-s-sources">
<h2><a class="toc-backref" href="#id112">Getting Myriad's Sources</a></h2>
<p>This is pretty straightforward, based on the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">project repository</a> hosted by Github:</p>
<pre class="code bash literal-block">
$ git clone https://github.com/Olivier-Boudeville/Ceylan-Myriad.git myriad
</pre>
<p>This should download in your current directory the full Myriad repository. For OTP compliance, using for such a clone its short name (<tt class="docutils literal">myriad</tt>) rather than its long one (<tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt>) is recommended.</p>
<p>The Myriad <tt class="docutils literal">master</tt> branch is meant to stick to the latest stable version: we try to ensure that this main line always stays functional (sorry for the pun). Evolutions are to take place in feature branches and to be merged only when ready.</p>
</div>
<div class="section" id="building-myriad">
<span id="build"></span><h2><a class="toc-backref" href="#id113">Building Myriad</a></h2>
<p>If a relevant Erlang installation is available, this is as simple as:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> myriad
$ make all
</pre>
<p>The parallel build of the whole layer (services and tests alike) shall complete successfully (if it is not the case, see our <a class="reference internal" href="#support">support</a> section).</p>
<p>One may just run <tt class="docutils literal">make</tt> by itself in order to list the main available options.</p>
<p>Note that by default our native, make-based, build system is used (see the <a class="reference external" href="http://howtos.esperide.org/Build.html">build section</a> of Ceylan-HOWTOs for further details). Alternatively, a rebar3-based build can be done (refer to the <a class="reference internal" href="#id19">OTP Build</a> section).</p>
<p>In this case one may run <tt class="docutils literal">make <span class="pre">create-myriad-checkout</span></tt> in order to create, based on our conventions, a suitable <tt class="docutils literal">_checkouts</tt> directory so that rebar3 can directly take into account local, directly available (in-development) dependencies (although Myriad does not have any, beside Erlang itself - this make target is useful for the layers built on top of Myriad).</p>
<p>So, alternatively to using <tt class="docutils literal">make</tt> directly, one may execute <tt class="docutils literal">rebar3 compile</tt> instead.</p>
</div>
<div class="section" id="testing-myriad">
<span id="testing"></span><h2><a class="toc-backref" href="#id114">Testing Myriad</a></h2>
<p>As Myriad has no prerequisite (besides Erlang itself of course), just run (possibly simply thanks to <tt class="docutils literal">rebar3 compile</tt> after a <tt class="docutils literal">git clone <span class="pre">https://github.com/Olivier-Boudeville/Ceylan-Myriad.git</span></tt>), still from the root directory of Myriad:</p>
<pre class="code bash literal-block">
$ make <span class="nb">test</span>
</pre>
<p>The testing shall complete successfully (if it is not the case, see our <a class="reference internal" href="#support">support</a> section).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Myriad is built and tested at each commit through <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/actions?query=workflow%3A%22Erlang+CI%22">continuous integration</a>. The same holds for the projects based on it, directly (ex: <a class="reference external" href="https://wooper.esperide.org">WOOPER</a>, <a class="reference external" href="https://seaplus.esperide.org">Seaplus</a>) or not (ex: <a class="reference external" href="https://traces.esperide.org/">Traces</a>, <a class="reference external" href="https://mobile.esperide.org/">Mobile</a>, <a class="reference external" href="https://us-web.esperide.org/">US-Web</a>), so in terms of usability, confidence should be high.</p>
</div>
</div>
<div class="section" id="type-checking-myriad">
<span id="type-checking"></span><h2><a class="toc-backref" href="#id115">Type-checking Myriad</a></h2>
<p>As Myriad is (by default) to enable debug information with a key-based protection of the resulting BEAM files, one should first have such key defined.</p>
<p>One way of doing so is, if wanted, to update the default key (see <tt class="docutils literal">DEBUG_INFO_KEY</tt> in <tt class="docutils literal">GNUmakevars.inc</tt>) and to write in on disk (ex: <tt class="docutils literal">make <span class="pre">write-debug-key-file</span></tt>), and to rebuild Myriad accordingly afterwards (ex: <tt class="docutils literal">make rebuild</tt>).</p>
<p>Then, still from the <tt class="docutils literal">myriad</tt> root directory:</p>
<pre class="code bash literal-block">
$ make generate-local-plt self-check-against-plt
</pre>
<p>It will trigger a full type-checking of Myriad, done thanks to <a class="reference external" href="http://erlang.org/doc/man/dialyzer.html">Dialyzer</a>.</p>
<p>This time-consuming phase will complete with a rather long list of notifications. Help us reducing it! These messages are numerous, but we do not think that most of them are so worrying.</p>
<p>Finally, to trigger in one go a full rebuild, testing and type-checking, one may run:</p>
<pre class="code bash literal-block">
$ make check
</pre>
</div>
<div class="section" id="maintaining-myriad-and-deriving-projects-with-regard-to-rebar3">
<h2><a class="toc-backref" href="#id116">Maintaining Myriad and Deriving Projects with regard to rebar3</a></h2>
<p>For Myriad as for all developments built on top of it (ex: specialisation layers or applications), any dependency may be specified in their <tt class="docutils literal">rebar.config</tt> <a class="footnote-reference" href="#id17" id="id16">[6]</a> through a branch of a GIT repository corresponding to that dependency.</p>
<table class="docutils footnote" frame="void" id="id17" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[6]</a></td><td>For example, with the conventions we rely on, <tt class="docutils literal">rebar.config</tt> is generated from the <tt class="docutils literal">conf/rebar.config.template</tt> file of the project of interest.</td></tr>
</tbody>
</table>
<p>For example, Myriad itself does not require any specific dependency, but projects making use of Myriad (ex: <a class="reference external" href="https://wooper.esperide.org">WOOPER</a>) may specify in their <tt class="docutils literal">rebar.config</tt>:</p>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="n">deps</span><span class="p">,</span> <span class="p">[{</span><span class="n">myriad</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;git://github.com/Olivier-Boudeville/Ceylan-Myriad&quot;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="n">branch</span><span class="p">,</span> <span class="s">&quot;master&quot;</span><span class="p">}}}]}.</span>
</pre>
<p>However, when having to build a dependency, rebar3 will not refer to the tip of the branch specified for it, but to any commit it may read from any pre-existing <tt class="docutils literal">rebar.lock</tt> file at the root of the current project (the underlying goal being to allow for more reproducible builds).</p>
<p>As the <a class="reference external" href="https://www.rebar3.org/docs/workflow/#setting-up-dependencies">rebar3 recommandation</a> is to store a version of that lock file in source version control, <strong>it shall be regularly updated</strong> otherwise the dependencies of a given project will stick, for the worst, to an older version of their branch, designated by an obsolete reference (this can be detected for example when continuous integration breaks after a nevertheless legit commit of the project).</p>
<p>The solution is thus, for a project of interest, to regularly force an update of its dependencies referenced in its own lock file, and to commit the resulting version.</p>
<p>For example, one would issue from the root of the project of interest:</p>
<pre class="code bash literal-block">
$ rebar3 upgrade
</pre>
<p>This may update the <tt class="docutils literal">ref</tt> entry of its dependencies (including Myriad) in its <tt class="docutils literal">rebar.lock</tt> file, which shall then be committed for posterity.</p>
<p><span class="raw-html"><a name="otp"></a></span></p>
</div>
<div class="section" id="id19">
<span id="otp-build"></span><h2><a class="toc-backref" href="#id117">OTP Build</a></h2>
<p>These build considerations apply to Myriad but also, more generally, to most if not all our Erlang developments.</p>
<div class="section" id="why-providing-two-different-build-deploy-run-systems">
<h3><a class="toc-backref" href="#id118">Why Providing Two Different Build/Deploy/Run Systems</a></h3>
<p>We felt that OTP build tools and Emakefiles were not expressive enough for our needs: as mentioned in <a class="reference internal" href="#building-myriad">Building Myriad</a>, a full, rather complete/complex/powerful build system based on <a class="reference external" href="https://www.gnu.org/software/make/manual/make.html">GNU make</a> is used by Ceylan-Myriad natively instead, and has been fully satisfactory for years (simple, lightweight, reliable, controllable, flexible, fast, etc.).</p>
<p>It allows to introduce all the generic rules we wanted, to define many conditional settings, to walk through an arbitrarily nested source tree, to integrate within a layered stack (notably alongside some other <tt class="docutils literal"><span class="pre">Ceylan-*</span></tt> libraries that depend on Ceylan-Myriad) and to perform a multi-stage build to accommodate the compilation and use of parse-transforms, with their own set of prerequisites.</p>
<p>More precisely we routinely (see <a class="reference external" href="https://wooper.esperide.org">WOOPER</a> or <a class="reference external" href="https://seaplus.esperide.org">Seaplus</a>) rely on layers built on top of Myriad, which define their own parse transforms that are themselves parse-transformed by Myriad's one - and it works great.</p>
<p>However, to better integrate with other Erlang developments (which are mostly OTP-compliant), we added the (optional) possibility of generating a Myriad <em>OTP library application</em> out of the build tree, ready to be integrated into an (OTP) <em>release</em> and to be available as an Hex <em>package</em>. For that we rely on <a class="reference external" href="https://www.rebar3.org/">rebar3</a>, <a class="reference external" href="https://github.com/erlware/relx">relx</a> and <a class="reference external" href="https://hex.pm/">hex</a>.</p>
<p>So currently all our Erlang-based developments can also be built and tested through rebar3, and this support is checked at each commit thanks to continuous integration.</p>
<p>We use less frequently releases (we rely on a basic deployment procedure of our own) and even less hex, yet they were supported once, so we believe that their integration should be at least fairly close to be operational (if not, patches welcome!).</p>
</div>
<div class="section" id="relying-on-rebar3">
<h3><a class="toc-backref" href="#id119">Relying on Rebar3</a></h3>
<p>Despite the kind support of the rebar3 authors and much time spent on its integration, sometimes our build based on it (for Myriad and the projects built on top of it) has encountered issues or has been lagging behind our native one.</p>
<p>Now we believe that all pending issues have been solved (rebar3 is a neat tool), yet being able to switch back to another lighter, ad-hoc, more controlled build system is sometimes a relief - at least a welcome security. Anyway the user can choose between these two (native vs rebar3) build machineries. As for us, we still prefer our native build system, even if it leaves to the developer the task of installing the needed prerequisites by him/herself.</p>
</div>
<div class="section" id="otp-application">
<h3><a class="toc-backref" href="#id120">OTP Application</a></h3>
<p>Myriad is not an <em>active</em> OTP application, and as such does not rely on, or provides, services running in the background; so no supervision tree or <tt class="docutils literal">gen_server</tt> is involved here, just a <em>library</em> application ready for OTP integration <a class="footnote-reference" href="#id23" id="id22">[7]</a>.</p>
<table class="docutils footnote" frame="void" id="id23" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id22">[7]</a></td><td>Speaking of OTP, in development mode, <tt class="docutils literal">proc_lib</tt>-based spawns used to be enabled, yet this led to longer error messages that were not that useful; see <tt class="docutils literal">spawn_utils.hrl</tt> if wanting to re-enable them.</td></tr>
</tbody>
</table>
<div class="section" id="id24">
<span id="getting-rebar3"></span><h4>Getting rebar3</h4>
<p>There are <a class="reference external" href="https://www.rebar3.org/docs/getting-started">various ways</a>  for obtaining <tt class="docutils literal">rebar3</tt>; we prefer:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> ~/Software <span class="o">&amp;&amp;</span> git clone https://github.com/erlang/rebar3.git
   <span class="o">&amp;&amp;</span> <span class="nb">cd</span> rebar3 <span class="o">&amp;&amp;</span> ./bootstrap
</pre>
<p>Alternatively, should you just want to update a (pre-existing) rebar3 install, first get the current version (<tt class="docutils literal">rebar3 <span class="pre">-v</span></tt>) to check it afterwards, then issue <tt class="docutils literal">rebar3 local upgrade</tt>; however this would involve running rebar from <tt class="docutils literal">.cache/rebar3/bin</tt>, so instead we prefer using (typically from <tt class="docutils literal">~/Software/rebar3</tt>):</p>
<pre class="code bash literal-block">
$ git pull <span class="o">&amp;&amp;</span> ./bootstrap
</pre>
<p>Another option is to download a prebuilt version of rebar3.</p>
<p>Finally, one may prefer using the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Hull/blob/master/install-rebar3.sh">install-rebar3.sh</a> script that we devised, which automates and enforces our conventions while letting the choice between an installation from sources or from a prebuilt version thereof (just un <tt class="docutils literal"><span class="pre">install-rebar3.sh</span> <span class="pre">--help</span></tt> for guidance).</p>
</div>
<div class="section" id="generating-ceylan-myriad">
<h4>Generating Ceylan-Myriad</h4>
<p>Then, from the root of a Myriad clone, to obtain the Ceylan-Myriad library <em>application</em>, one just has to enter:</p>
<pre class="literal-block">
$ make rebar3-application
</pre>
<p>It will trigger <tt class="docutils literal">rebar3</tt>, resulting in a full, OTP-compliant build tree created in <tt class="docutils literal">_build</tt> (including a properly-generated <tt class="docutils literal">_build/default/lib/myriad/ebin/myriad.app</tt> file), and more generally in a proper OTP application <a class="footnote-reference" href="#id27" id="id25">[8]</a>.</p>
<p>A full, autonomous, functional by design build procedure can be also found in Myriad's <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/.github/workflows/erlang-ci.yml">continuous integration</a> script.</p>
<table class="docutils footnote" frame="void" id="id27" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id25">[8]</a></td><td>The rebar-based build relies, thanks to {pre,post}-compile hooks, on our native build system. Because of extraneous, failing recompilations being nevertheless triggered by rebar, we had to introduce bullet-proof hooks (refer to <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/fix-rebar-compile-pre-hook.sh">1</a>, <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/fix-rebar-compile-post-hook.sh">2</a>).</td></tr>
</tbody>
</table>
</div>
<div class="section" id="testing-ceylan-myriad">
<h4>Testing Ceylan-Myriad</h4>
<p>As a result, the OTP application support can be tested from the root of an (already-built, with <tt class="docutils literal">make <span class="pre">rebar3-application</span></tt>) Myriad source tree:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> src/utils
$ make myriad_otp_application_run
       Running unitary <span class="nb">test</span> myriad_otp_application_run <span class="o">(</span>third form<span class="o">)</span> from
          myriad_otp_application_test

--&gt; Testing module myriad_otp_application_test.

Starting the Myriad application.
Myriad version: <span class="o">{</span><span class="m">1</span>,0,11<span class="o">}</span>.
Current user name: <span class="s1">'stallone'</span>.
Stopping the Myriad application.
Successful end of <span class="nb">test</span> of the Myriad application.
<span class="o">=</span>INFO <span class="nv">REPORT</span><span class="o">====</span> <span class="m">18</span>-Jul-2019::22:37:24.779037 <span class="o">===</span>
   application: myriad
   exited: stopped
   type: temporary

--&gt; Successful end of test.

<span class="o">(</span><span class="nb">test</span> finished, interpreter halted<span class="o">)</span>
</pre>
<p>This support can be also tested manually, directly through the build tree used by rebar3; from the root of Myriad, after having run <tt class="docutils literal">make <span class="pre">rebar3-application</span></tt>:</p>
<pre class="code bash literal-block">
$ erl -pz _build/default/lib/myriad/ebin/
Erlang/OTP <span class="m">22</span> <span class="o">[</span>erts-10.4<span class="o">]</span> <span class="o">[</span>source<span class="o">]</span> <span class="o">[</span><span class="m">64</span>-bit<span class="o">]</span> <span class="o">[</span>smp:8:8<span class="o">]</span> <span class="o">[</span>...<span class="o">]</span>

Eshell V10.4  <span class="o">(</span>abort with ^G<span class="o">)</span>
<span class="m">1</span>&gt; application:start<span class="o">(</span>myriad<span class="o">)</span>.
ok
<span class="m">2</span>&gt; text_utils:format<span class="o">(</span> <span class="s2">&quot;Hello ~s&quot;</span>, <span class="o">[</span> world <span class="o">]</span> <span class="o">)</span>.
<span class="s2">&quot;Hello world&quot;</span>
<span class="m">3</span>&gt; application:stop<span class="o">(</span>myriad<span class="o">)</span>.
<span class="o">=</span>INFO <span class="nv">REPORT</span><span class="o">====</span> <span class="m">18</span>-Jul-2019::22:47:36.429804 <span class="o">===</span>
   application: myriad
   exited: stopped
   type: temporary
</pre>
<p>When needing to include a Myriad header file (taking <tt class="docutils literal">spawn_utils.hrl</tt> as an example) in one's code, OTP conventions mandate using:</p>
<pre class="literal-block">
-include_lib(&quot;myriad/include/spawn_utils.hrl&quot;).
</pre>
<p>rather than:</p>
<pre class="literal-block">
-include(&quot;spawn_utils.hrl&quot;).
</pre>
</div>
</div>
<div class="section" id="otp-release">
<h3><a class="toc-backref" href="#id121">OTP Release</a></h3>
<p>Quite similarly, to obtain a Ceylan-Myriad OTP <em>release</em> (<a class="reference external" href="https://github.com/erlware/relx">relx</a> being used in the background), possibly for a given profile like <tt class="docutils literal">default</tt> (development mode) or <tt class="docutils literal">prod</tt> (production mode) - refer to <tt class="docutils literal">REBAR_PROFILE</tt> in <tt class="docutils literal">GNUmakevars.inc</tt>, one just has to run, from the root of Myriad:</p>
<pre class="literal-block">
$ make rebar3-release
</pre>
</div>
<div class="section" id="hex-package">
<h3><a class="toc-backref" href="#id122">Hex Package</a></h3>
<p>The <a class="reference external" href="https://hex.pm/">hex</a> package manager relies on mix, which is commonly installed with <a class="reference external" href="https://elixir-lang.org/">Elixir</a> (another language built on top of the Erlang VM).</p>
<p>Thanks to the rebar3 integration with the <tt class="docutils literal">rebar3_hex</tt> plugin specified in Myriad's (generated) <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/rebar.config">rebar.config</a>, <tt class="docutils literal">hex</tt> will be automatically installed and set up.</p>
<p>By following the publishing guidelines (<a class="reference external" href="https://hex.pm/docs/rebar3_publish">[1]</a>, <a class="reference external" href="https://www.rebar3.org/docs/package_management/publishing-packages/">[2]</a>), we were able to publish <a class="reference external" href="https://hex.pm/packages/myriad">Hex packages for Myriad</a> that can be freely used. And there was much rejoicing!</p>
<p>One just has to specify for example <tt class="docutils literal"><span class="pre">{deps,[myriad]}.</span></tt> in one's <tt class="docutils literal">rebar.config</tt>, and that's it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Finally our workflow does not rely on Hex, so we do not update the Hex packages anymore. Just drop us an email if needing an updated one.</p>
</div>
<p>For more details, one may have a look at:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/rebar.config.template">rebar.config.template</a>, the general rebar configuration file used when generating the Myriad OTP application and release</li>
<li><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/rebar-for-hex.config.template">rebar-for-hex.config.template</a>, to generate a corresponding Hex package for Myriad (whose structure and conventions is quite different from the previous OTP elements)</li>
<li><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/rebar-for-testing.config.template">rebar-for-testing.config.template</a>, the simplest test of the previous Hex package: an empty rebar project having for sole dependency that Hex package</li>
</ul>
</div>
<div class="section" id="other-otp-related-make-targets-of-interest">
<h3><a class="toc-backref" href="#id123">Other OTP-related Make Targets of Interest</a></h3>
<p>To populate/update the OTP build tree (by default, from the GIT root, for example <tt class="docutils literal">_build/default/lib/myriad/</tt> for Myriad) of the current Ceylan layer, one may use:</p>
<pre class="literal-block">
$ make rebar3-compile
</pre>
<p>(this is especially useful in order to be able to use directly, from an OTP application, changes just performed in a Ceylan-based layer)</p>
<p>To update both the OTP build tree and the local ebin directory of each Ceylan layer on which the current layer depends, use:</p>
<pre class="literal-block">
$ make rebar3-local-update
</pre>
<p>(note this will be a no-op from Myriad, as it does not depend on any Ceylan layer)</p>
<p>To publish an Hex package (once the proper version number has been set in <tt class="docutils literal">GNUmakevars.inc</tt>, see <tt class="docutils literal">MYRIAD_VERSION</tt>):</p>
<pre class="literal-block">
$ make rebar3-hex-publish
</pre>
<p>To test such a package:</p>
<pre class="literal-block">
$ make test-hex-package
</pre>
<p>To populate directly the OTP local build tree with the Ceylan dependencies located alongside the current install (not useful for Myriad - which depends on none, but useful for upper layers) rather than fetching them through Hex (otherwise may more Hex packages would have to be published for testing during development):</p>
<pre class="literal-block">
$ make rebar3-local-update
</pre>
<p>Many more targets are defined in <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/GNUmakerules-explicit.inc">GNUmakerules-explicit.inc</a>.</p>
<p></p>
</div>
</div>
</div>
<div class="section" id="services-offered-by-the-myriad-layer">
<span id="services"></span><h1><a class="toc-backref" href="#id124">Services offered by the <tt class="docutils literal">Myriad</tt> Layer</a></h1>
<p>The <tt class="docutils literal">Myriad</tt> services are gathered into following themes:</p>
<ol class="arabic simple">
<li>General <a class="reference internal" href="#build-structure">build structure</a></li>
<li>General <a class="reference internal" href="#settings">settings</a></li>
<li><a class="reference internal" href="#maths">Maths</a> services</li>
<li><a class="reference internal" href="#data-management">Data-management</a> services</li>
<li>Support for <a class="reference internal" href="#code-injection">code injection</a></li>
<li>Helpers for <a class="reference internal" href="#graphical-user-interface">graphical user interface</a> (GUI) programming</li>
<li>All-purpose <a class="reference internal" href="#helper-scripts">helper scripts</a></li>
<li><a class="reference internal" href="#spatial">Spatial</a> support</li>
<li>Utility <a class="reference internal" href="#toolbox">toolbox</a></li>
<li>Management of <a class="reference internal" href="#units">units</a></li>
<li><a class="reference internal" href="#metaprogramming">Metaprogramming</a>, based on heavy use of parse transforms</li>
<li><a class="reference internal" href="#sql-support">SQL support</a></li>
</ol>
<p>In future versions of this document, following topics will be discussed:</p>
<ul class="simple">
<li>HDF5 support</li>
<li>REST support</li>
<li>third-party language bindings (ex: Python, Java, maybe in the future Haskell; C/C++ is to be tackled by our <a class="reference external" href="http://seaplus.esperide.org">Seaplus</a> project)</li>
<li>RDF support</li>
</ul>
<p>Even if this document does not constitute an exhaustive walk-through, each of them is detailed in turn below.</p>
<p>The next level of detail is either to browse the <a class="reference external" href="api-doc/index.html">Myriad API documentation</a> or simply to peer at the referenced <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">source files</a>, as they include many implementation notes, comments and typing information.</p>
<p></p>
<div class="section" id="general-build-structure">
<span id="build-structure"></span><h2><a class="toc-backref" href="#id125">General Build Structure</a></h2>
<p>Various elements are defined at the <tt class="docutils literal">myriad</tt> level to set-up an appropriate build system, based on <a class="reference external" href="http://www.gnu.org/software/make/manual/make.html">GNU Make</a>.</p>
<p>This includes:</p>
<ul class="simple">
<li>a set of pre-defined Make <strong>variables</strong>, describing various settings that will be reused by generic rules (ex: to compile modules with relevant flags, to create source archives, to install an application, to manage the various paths, to perform test checking, to generate archives, installs and releases, etc.); these variables are defined in <tt class="docutils literal">myriad/GNUmakevars.inc</tt></li>
<li>a set of generic <strong>rules</strong>, to compile and run various modules and tests, to generate various elements of documentation, etc.; these rules are defined (still from the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad">myriad</a> root directory), in:<ul>
<li><tt class="docutils literal"><span class="pre">GNUmakerules-automatic.inc</span></tt>, for all rules that apply generically to some kinds of targets (ex: all source files)</li>
<li><tt class="docutils literal"><span class="pre">GNUmakerules-explicit.inc</span></tt>, for all &quot;direct&quot; (explicitly designated) rules, that are not pattern-based</li>
<li><tt class="docutils literal"><span class="pre">doc/GNUmakerules-docutils.inc</span></tt>, for all documentation-related rules</li>
</ul>
</li>
<li>finally, the whole is gathered in a unique file to include, <tt class="docutils literal">GNUmakesettings.inc</tt>, whose structure allows for a safe and sound combination of all these build element across a series of layers (the first of which being Myriad)</li>
<li><strong>examples</strong> of Make files that remain rather minimal, as they mostly specify the relative base path and only refer to the generic variables and rules; see <tt class="docutils literal">myriad/src/GNUmakefile</tt> as an example thereof</li>
</ul>
<p>An example of this stacked build structure is the <tt class="docutils literal"><span class="pre">Ceylan-WOOPER</span></tt> layer (see <a class="reference external" href="http://wooper.esperide.org">official site</a>), which is directly built on top of <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> (and itself a base layer for other layers and applications).</p>
<p>These build facilities are designed to be enriched in turn by all layers above, which may add or override variables and rules.</p>
<p>As an example, the <tt class="docutils literal">shell</tt> make target allows to spawn an Erlang shell that is readily able to use the current layer and all the ones below (including thus Myriad); this way, direct, hassle-free interactive testing can be performed - which may prove quite convenient.</p>
<p></p>
</div>
<div class="section" id="general-settings">
<span id="settings"></span><h2><a class="toc-backref" href="#id126">General Settings</a></h2>
<p id="emacs-settings">These general-purpose settings and helpers, gathered in Myriad's <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/tree/master/conf">conf</a> directory, deal with:</p>
<ul class="simple">
<li>default CSS files (<tt class="docutils literal"><span class="pre">Default-docutils.css</span></tt>)</li>
<li>our recommended versions of (commented) configuration files for various tools, notably <tt class="docutils literal">Emacs</tt>:  see our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/tree/master/conf/init.el">init.el</a>, to be placed in the <tt class="docutils literal"><span class="pre">~/.emacs.d/</span></tt> directory; now our configuration is standalone (no need for extra files/packages) and cross-platform (at least Unices and Windows)</li>
<li>our standard script to properly install Erlang (<a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/tree/master/conf/install-erlang.sh">install-erlang.sh</a>) with detailed comments and command-line options (use <tt class="docutils literal"><span class="pre">install-erlang.sh</span> <span class="pre">--help</span></tt> for more information)</li>
</ul>
<p></p>
</div>
<div class="section" id="maths-services">
<span id="maths"></span><h2><a class="toc-backref" href="#id127">Maths Services</a></h2>
<p>Some simple maths-related operations are defined in the <tt class="docutils literal">myriad/src/maths</tt> directory:</p>
<ul class="simple">
<li>the most basic services are centralised in <tt class="docutils literal">math_utils.erl</tt> and provide:<ul>
<li><strong>general operations</strong> apparently lacking to Erlang (for example for conversions or rounding (<tt class="docutils literal">floor/1</tt>, <tt class="docutils literal">ceiling/1</tt>), or not exactly implemented as we would have liked (ex: <tt class="docutils literal">modulo/2</tt>)</li>
<li>operations tailored to operate on <strong>floating-point values</strong> (ex: <tt class="docutils literal"><span class="pre">are_close/{2,3}</span></tt>, <tt class="docutils literal"><span class="pre">are_relatively_close/{2,3}</span></tt>, <tt class="docutils literal">get_relative_difference/2</tt>, <tt class="docutils literal">is_null/1</tt>)</li>
<li>operations on <strong>angles</strong> (ex: <tt class="docutils literal">radian_to_degree/1</tt>, <tt class="docutils literal">canonify/1</tt>)</li>
<li>the associated <strong>typing</strong> information</li>
</ul>
</li>
<li>linear-related operations are defined (refer to the <a class="reference internal" href="#spatial-support">Spatial Support</a> section for more details); for example the <strong>2D</strong> operations are defined in <tt class="docutils literal">linear_2D.erl</tt> (their <strong>3D</strong> counterparts being defined in <tt class="docutils literal">linear_3D.erl</tt>, their <strong>4D</strong> counterparts in <tt class="docutils literal">linear_4D.erl</tt>; base ones in <tt class="docutils literal">linear.erl</tt>) and include:<ul>
<li>operations on <strong>points</strong>: <tt class="docutils literal">are_close/2</tt>, <tt class="docutils literal">is_within/3</tt>, <tt class="docutils literal">square_distance/2</tt>, <tt class="docutils literal">distance/2</tt>, <tt class="docutils literal">cross_product/2</tt>, <tt class="docutils literal">roundify/1</tt>, <tt class="docutils literal">get_integer_center/2</tt>, <tt class="docutils literal">get_center/2</tt>, <tt class="docutils literal">translate/2</tt>, etc.</li>
<li>operations on <strong>vectors</strong>: <tt class="docutils literal">vectorize/2</tt>, <tt class="docutils literal">square_magnitude/1</tt>, <tt class="docutils literal">magnitude/1</tt>, <tt class="docutils literal">scale/2</tt>, <tt class="docutils literal">make_unit/1</tt>, <tt class="docutils literal">normal_left/1</tt>, <tt class="docutils literal">normal_right/1</tt>, <tt class="docutils literal">dot_product/2</tt>, etc.</li>
<li>operations on <strong>lines</strong>: <tt class="docutils literal">get_line/2</tt>, <tt class="docutils literal">intersect/2</tt>, <tt class="docutils literal">get_abscissa_for_ordinate/2</tt>, etc.</li>
<li>operations related to <strong>angles</strong>: <tt class="docutils literal">is_strictly_on_the_right/3</tt>, <tt class="docutils literal">is_obtuse/1</tt>, <tt class="docutils literal">abs_angle_rad/3</tt>, <tt class="docutils literal">angle_rad/3</tt>, <tt class="docutils literal">abs_angle_deg/3</tt>, <tt class="docutils literal">angle_deg/3</tt>, etc.</li>
<li>operations on <strong>sets of points</strong>: <tt class="docutils literal">compute_smallest_enclosing_rectangle/1</tt>, <tt class="docutils literal">compute_max_overall_distance/1</tt>, <tt class="docutils literal">compute_convex_hull/1</tt>, etc.</li>
</ul>
</li>
<li><strong>polygon</strong>-related operations are available in <tt class="docutils literal">polygon.erl</tt>:<ul>
<li><strong>generation</strong> of polygons: <tt class="docutils literal">get_triangle/3</tt>, <tt class="docutils literal">get_upright_square/2</tt>, <tt class="docutils literal">get_polygon/1</tt>, etc.</li>
<li><strong>operations</strong> on them: <tt class="docutils literal">get_diameter/1</tt>, <tt class="docutils literal">get_smallest_enclosing_rectangle/1</tt>, <tt class="docutils literal">get_area/1</tt>, <tt class="docutils literal">is_in_clockwise_order/1</tt>, <tt class="docutils literal">is_convex/1</tt>, <tt class="docutils literal">to_string/1</tt>, etc.</li>
<li><strong>rendering</strong> them: <tt class="docutils literal">render/2</tt>, <tt class="docutils literal">set_edge_color/2</tt>, <tt class="docutils literal">get_edge_color/1</tt>, <tt class="docutils literal">set_fill_color/2</tt>, <tt class="docutils literal">get_fill_color/1</tt>, etc.</li>
<li>managing their <strong>bounding boxes</strong>: <tt class="docutils literal">update_bounding_box/2</tt>, etc.</li>
</ul>
</li>
<li><strong>bounding-boxes in general</strong> are supported in <tt class="docutils literal"><span class="pre">bounding_box{2,3}.erl</span></tt>, including <tt class="docutils literal">get_lazy_circle_box/1</tt>, <tt class="docutils literal">get_minimal_enclosing_circle_box/1</tt>, etc.</li>
<li>a minimalist <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#The_Runge.E2.80.93Kutta_method">Runge-Kutta solver</a> is defined in <tt class="docutils literal">rk4_solver.erl</tt> (see also the corresponding <a class="reference internal" href="#lorenz-test">Lorenz test</a>)</li>
</ul>
<p></p>
</div>
<div class="section" id="data-management-services">
<span id="data-management"></span><h2><a class="toc-backref" href="#id128">Data-Management Services</a></h2>
<div class="section" id="datatypes">
<h3><a class="toc-backref" href="#id129">Datatypes</a></h3>
<p>Some generic <strong>data-structures</strong>, in addition to the ones provided built-in with Erlang, are defined in <tt class="docutils literal"><span class="pre">myriad/src/data-management</span></tt>, and described below.</p>
<div class="section" id="table-types">
<span id="table-type"></span><h4>Table Types</h4>
<p>A set of types for <strong>associative tables</strong> is available, each offering a rather complete interface (to create, update, enrich, search, query, list, map, fold, merge, display, etc. a table - or entries thereof) and a different trade-off.</p>
<p>Various implementations are defined (with tests and benchmarks), in:</p>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="nb">hash</span><span class="p">,</span><span class="n">lazy_hash</span><span class="p">,</span><span class="n">list_</span><span class="p">,</span><span class="n">tracked_hash</span><span class="p">,</span><span class="n">map_hash</span><span class="p">}</span><span class="n">table</span><span class="p">.</span><span class="n">erl</span>
</pre>
<p>A <tt class="docutils literal">table</tt> <strong>pseudo-module</strong> is additionally provided, in order to abstract out these various options: the user may then rely exclusively on <tt class="docutils literal">table</tt>, regardless of the actual table type this pseudo-module will be translated at compilation-time.</p>
<p>Indeed the <tt class="docutils literal">table</tt> module is a fully virtual one, in the sense that neither <tt class="docutils literal">table.erl</tt> nor <tt class="docutils literal">table.beam</tt> exists, and that the <tt class="docutils literal">Myriad</tt> parse transform is to automatically replace a call to this <tt class="docutils literal">table</tt> pseudo-module by a call to one of the aforementioned table types (and it will do the same replacement in type specifications as well).</p>
<p>By default, such <tt class="docutils literal">table</tt> calls will be translated to corresponding calls to our <tt class="docutils literal">map_hashtable</tt> module, which is generally the most efficient one (it relies on the more recently-introduced Erlang <tt class="docutils literal">maps</tt> built-in datatype, which <tt class="docutils literal">table</tt> now favors).</p>
<p>As a result, in order to consult the <tt class="docutils literal">table</tt> API, please refer to <tt class="docutils literal">map_hashtable.erl</tt>.</p>
<p>Such a default implementation may be overridden on a per-module basis, thanks to a <tt class="docutils literal">table_type</tt> define.</p>
<p>For example, specifying <tt class="docutils literal"><span class="pre">-table_type(list_table).</span></tt> will result in the current module to translate <tt class="docutils literal">table</tt> to <tt class="docutils literal">list_table</tt>, instead of the default <tt class="docutils literal">map_hashtable</tt>.</p>
<p id="const-table">Finally, a way of <strong>generating read-only associative tables</strong> whose key/value pairs can be read very efficiently from any number (potentially extremely large) of readers (processes) is provided with <tt class="docutils literal">const_table.erl</tt>.</p>
<p>No ETS table, replication (ex: per-process table copy) or message sending is involved: thanks to meta-programming, a module is generated on-the-fly, exporting as many functions as there are different keys in the table of interest. Calling a function corresponding to a key returns its associated value.</p>
<p>More precisely, a module name (ex: <tt class="docutils literal">foobar</tt>) and a <tt class="docutils literal"><span class="pre">table:table(atom(),</span> <span class="pre">any())</span></tt> instance shall be provided to <tt class="docutils literal">const_table:generate/2</tt>; then, for each key/value pair in the specified table (ex: <tt class="docutils literal">{baz, 42.0}</tt>), a 0-arity function is generated and exported in that module, as if we had:</p>
<pre class="code erlang literal-block">
<span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">foobar</span><span class="p">).</span>

<span class="p">[...]</span>

<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">baz</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>

<span class="p">-</span><span class="ni">spec</span> <span class="n">baz</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">term</span><span class="p">().</span>
<span class="nf">baz</span><span class="p">()</span> <span class="o">-&gt;</span>
  <span class="mi">42</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span>
</pre>
<p>Then third-party code can call for example <tt class="docutils literal">foobar:foo()</tt> and have <tt class="docutils literal">42.0</tt> returned. This is presumably the most efficient way of sharing constants in Erlang.</p>
<p>Note that no actual module file is generated (ex: no <tt class="docutils literal">foobar.beam</tt> file is ever written in the filesystem): the operation remains fully in-memory (RAM).</p>
<p>Keys must be atoms, and the table of interest shall be immutable (const), even if, thanks to hot code upgrade, one may imagine updating the table at will, having any number of successive versions of it.</p>
<p>Generating a table of the same name more than once should be done with care, as if a given table is generated thrice, the initial table would first switch from &quot;current&quot; to &quot;old&quot;, and then would be removed. Any process that would linger in a function of this module would then be terminated (see <a class="reference external" href="http://www.erlang.org/doc/reference_manual/code_loading.html">code replacement</a>). However, due to the nature of these tables (just one-shot fully-qualified calls, no recursion or message-waiting construct), this is not expected to happen.</p>
</div>
<div class="section" id="other-datatypes">
<h4>Other Datatypes</h4>
<p>They include <tt class="docutils literal">pair.erl</tt>, <tt class="docutils literal">option_list.erl</tt>, <tt class="docutils literal">preferences.erl</tt>, <tt class="docutils literal">tree.erl</tt>.</p>
<p>One may also refer for operations on:</p>
<ul class="simple">
<li>sets: <tt class="docutils literal">set_utils.erl</tt></li>
<li>lists: <tt class="docutils literal">list_utils.erl</tt></li>
<li>rings (i.e. <a class="reference external" href="https://en.wikipedia.org/wiki/Circular_buffer">circular buffers</a>): <tt class="docutils literal">ring_utils.erl</tt></li>
<li>binaries (i.e. raw binary information): <tt class="docutils literal">bin_utils.erl</tt></li>
</ul>
</div>
<div class="section" id="pseudo-builtin-types">
<h4>Pseudo-Builtin Types</h4>
<p>Such types, as <tt class="docutils literal">void/0</tt> (for functions only useful for their side-effects - this happens!), <tt class="docutils literal">maybe/1</tt> (<tt class="docutils literal">maybe(T)</tt> is either <tt class="docutils literal">T</tt> or <tt class="docutils literal">undefined</tt>), and <tt class="docutils literal"><span class="pre">fallible/{1,2}</span></tt> (an operation either is successful and returns a result, or returns an error) are supported, thanks to the Myriad parse-transform.</p>
</div>
</div>
<div class="section" id="file-formats">
<h3><a class="toc-backref" href="#id130">File Formats</a></h3>
<div class="section" id="basic-file-formats">
<h4>Basic File Formats</h4>
<p>A built-in very basic support for the <a class="reference external" href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a>, for <em>Comma-Separated Values</em> (see <tt class="docutils literal">csv_utils</tt>) and <a class="reference external" href="https://en.wikipedia.org/wiki/Resource_Description_Framework">RDF</a> (see <tt class="docutils literal">rdf_utils</tt>) conventions is provided.</p>
</div>
<div class="section" id="most-usual-standard-file-formats">
<h4>Most Usual, Standard File Formats</h4>
<p>Besides the support for XML, an optional support (as it depends on third-party prerequisites) is proposed for:</p>
<ul class="simple">
<li>JSON</li>
<li>HDF5</li>
<li>SQLite</li>
</ul>
<p id="xml-use">Some useful information for <strong>XML use</strong>:</p>
<ul class="simple">
<li>Myriad's XML support is implemented by the <tt class="docutils literal">xml_utils</tt> module (so one shall refer to <tt class="docutils literal"><span class="pre">xml_utils.{e,h}rl</span></tt> and <tt class="docutils literal">xml_utils_test.erl</tt>), which relies on the built-in <tt class="docutils literal">xmerl</tt> modules</li>
<li>XML documents can be parsed from strings (see <tt class="docutils literal">string_to_xml/1</tt>) or files (see <tt class="docutils literal">parse_xml_file/1</tt>), and conversely can be serialised to strings (see <tt class="docutils literal"><span class="pre">xml_to_string/{1,2}</span></tt>)</li>
<li>an XML document is made from a list of XML elements, that can exist as three different forms that can be freely mixed: as &quot;simple-form&quot;, as IOLists and/or as XML (xmerl) records</li>
<li>we recommend the use of the &quot;simple-form&quot;, which should be sufficient for at least most cases</li>
</ul>
<p>This last form is based on simple tags, used in order to easily have (Erlang) terms that are direct counterparts of XML tags.</p>
<p>For example the following two elements (respectively in simple-form and as an XML document) are equivalent (if using the default XML prolog):</p>
<pre class="code erlang literal-block">
<span class="nv">XMLSimpleContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">myFirstTag</span><span class="p">,</span>
  <span class="p">{</span><span class="n">mySecondTag</span><span class="p">,</span> <span class="p">[</span><span class="n">myNestedTag</span><span class="p">]},</span>
  <span class="p">{</span><span class="n">myThirdTag</span><span class="p">,</span> <span class="p">[{</span><span class="n">color</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">},</span> <span class="p">{</span><span class="n">age</span><span class="p">,</span> <span class="mi">71</span><span class="p">}],</span> <span class="p">[</span><span class="s">&quot;This is a text!&quot;</span><span class="p">]}].</span>
</pre>
<p>and:</p>
<pre class="code xml literal-block">
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;myFirstTag/&gt;</span>
<span class="nt">&lt;mySecondTag&gt;&lt;myNestedTag/&gt;&lt;/mySecondTag&gt;</span>
<span class="nt">&lt;myThirdTag</span> <span class="na">color=</span><span class="s">&quot;red&quot;</span> <span class="na">age=</span><span class="s">&quot;71&quot;</span><span class="nt">&gt;</span>This is a text!<span class="nt">&lt;/myThirdTag&gt;</span>
</pre>
<p>Refer to the <tt class="docutils literal">xml_utils</tt> module for further details.</p>
<p id="json-use">Some useful information for <strong>JSON use</strong>:</p>
<ul class="simple">
<li>the nesting of elements shall be done thanks to (Erlang) maps, whose keys are binary strings (<tt class="docutils literal">text_utils:bin_string/0</tt>); their order should not matter</li>
<li>it may thus be convenient to add <tt class="docutils literal"><span class="pre">-define(table_type,</span> map_hashtable).</tt> in a user module, so that the <tt class="docutils literal">table</tt> pseudo-module can be relied upon when building a <tt class="docutils literal">json_term</tt>, while being sure that the JSON parser at hand will be fed afterwards with the relevant datastructure</li>
<li>no comments shall be specified (even though some parsers may be configured to support them)</li>
<li>strings shall be specified as binary ones</li>
<li>the actual JSON backend used are either <a class="reference external" href="https://github.com/talentdeficit/jsx/">jsx</a> or <a class="reference external" href="https://github.com/davisp/jiffy">jiffy</a>; to better understand their (mostly common) mapping between Erlang and JSON, one may refer to the <a class="reference external" href="https://github.com/talentdeficit/jsx/#json---erlang-mapping">this section</a> of the jsx documentation  and to <a class="reference external" href="https://github.com/davisp/jiffy#data-format">this one</a> regarding jiffy</li>
</ul>
<p>Example:</p>
<pre class="code erlang literal-block">
<span class="nv">MyJSONTerm</span> <span class="o">=</span> <span class="nn">table</span><span class="p">:</span><span class="nf">add_entries</span><span class="p">([</span>
  <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;asset&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="p">#{</span><span class="o">&lt;&lt;</span><span class="s">&quot;generator&quot;</span><span class="o">&gt;&gt;</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;</span><span class="s">&quot;My Generator&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                  <span class="o">&lt;&lt;</span><span class="s">&quot;version&quot;</span><span class="o">&gt;&gt;</span> <span class="o">=&gt;</span> <span class="o">&lt;&lt;</span><span class="s">&quot;2.0&quot;</span><span class="o">&gt;&gt;</span><span class="p">}},</span>
  <span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;other&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="mi">42</span><span class="p">}</span>
                               <span class="p">],</span> <span class="nn">table</span><span class="p">:</span><span class="nf">new</span><span class="p">()),</span>

<span class="nv">JSONString</span> <span class="o">=</span> <span class="nn">json_utils</span><span class="p">:</span><span class="nf">to_json</span><span class="p">(</span><span class="nv">MyJSONTerm</span><span class="p">)</span>
</pre>
<p>shall result in a JSON document like:</p>
<pre class="code json literal-block">
<span class="p">{</span>
  <span class="nt">&quot;asset&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;generator&quot;</span><span class="p">:</span> <span class="s2">&quot;My Generator&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;other&quot;</span><span class="p">:</span> <span class="mi">42</span>
<span class="p">}</span>
</pre>
<p>Hint: the <a class="reference external" href="https://stedolan.github.io/jq/">jq</a> command-line tool may be very convenient in JSON contexts.</p>
<p>Refer to the <a class="reference internal" href="#myriad-level-third-party-dependencies">Myriad-level Third-Party Dependencies</a> section for further information.</p>
</div>
<div class="section" id="for-pure-erlang-uses-the-etf-file-format">
<span id="etf"></span><h4>For Pure Erlang uses: the ETF File Format</h4>
<p>For many needs in terms of Erlang internal data storage (ex: regarding configuration settings), we recommend the use of the file format that <a class="reference external" href="https://erlang.org/doc/man/file.html#consult-1">file:consult/1</a>  can directly read, that we named, for reference purpose, <tt class="docutils literal">ETF</tt> (for <em>Erlang Term Format</em> <a class="footnote-reference" href="#id42" id="id41">[9]</a>). We recommend that ETF files have for extension <tt class="docutils literal">.etf</tt>, like in: <tt class="docutils literal"><span class="pre">~/.ceylan-settings.etf</span></tt> (see also our support for <a class="reference internal" href="#user-preferences">user preferences</a>).</p>
<table class="docutils footnote" frame="void" id="id42" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id41">[9]</a></td><td>Not to be mixed up with the <a class="reference external" href="https://www.erlang.org/doc/apps/erts/erl_ext_dist.html">Erlang External Term Format</a>, which is used for <a class="reference internal" href="#serialisation">serialisation</a>.</td></tr>
</tbody>
</table>
<p>ETF is just a text format for which:</p>
<ul class="simple">
<li>a line starting with a <tt class="docutils literal">%</tt> character is considered to be a comment, and is thus ignored</li>
<li>other lines are terminated by a dot, and correspond each to an Erlang term (ex: <tt class="docutils literal">{base_log_dir, <span class="pre">&quot;/var/log&quot;}.</span></tt>)</li>
</ul>
<p>See <a class="reference external" href="https://github.com/Olivier-Boudeville/us-common/blob/master/priv/for-testing/us.config">this example</a> of a full ETF file.</p>
<p>A basic support for these ETF files is available in <tt class="docutils literal"><span class="pre">file_utils:{read,write}_etf_file/*</span></tt>.</p>
<p>If expecting to read UTF-8 content from such a file, it should:</p>
<ul class="simple">
<li>have been then opened for writing typically while including the <tt class="docutils literal">{encoding,utf8}</tt> option, or have been written with content already properly encoded (maybe more reliable that way)</li>
<li>start with a <tt class="docutils literal">%% <span class="pre">-*-</span> coding: <span class="pre">utf-8</span> <span class="pre">-*-</span></tt> header</li>
</ul>
<p>ETF files are notably used as <strong>configuration files</strong>. In this case following extra conventions apply:</p>
<ul class="simple">
<li>their extension is preferably changed from <tt class="docutils literal">.etf</tt> to <tt class="docutils literal">.config</tt></li>
<li>before each entry, a comment describing it in general terms shall be available, with typing information</li>
<li>entries are pairs:<ul>
<li>whose first element is an atom</li>
<li>their second element can be any value, typically of algebraic types; if a string value is included, for readability purpose it shall preferably be specified as a plain one (ex: <tt class="docutils literal">&quot;James Bond&quot;</tt>) rather than a binary one (ex: <tt class="docutils literal"><span class="pre">&lt;&lt;&quot;James</span> <span class="pre">Bond&quot;&gt;&gt;</span></tt>); it is up to the reading logic to accommodate both forms; it is tolerated to reference, in the comments of these configuration files, types that actually include <em>binary</em> strings (not plain ones, even though plain ones are used in the configuration files)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="to-export-3d-scenes">
<span id="gltf-file-format"></span><h4>To Export 3D Scenes</h4>
<p>A basic support of <a class="reference external" href="https://en.wikipedia.org/wiki/GlTF">glTF</a> (<em>Graphics Language Transmission Format</em>) version 2.0 has been implemented in <tt class="docutils literal"><span class="pre">gltf_support.{hrl,erl}</span></tt>.</p>
<p>The various elements associated to that model (scenes, nodes, meshes, primitives, materials, lights, cameras, buffers, buffer-views, accessors) can be handled from Erlang, in an already integrated way to Myriad's <a class="reference internal" href="#spatial-services-and-conventions">spatial services and conventions</a>.</p>
<p>See the <a class="reference external" href="https://www.khronos.org/files/gltf20-reference-guide.pdf">glTF 2.0 Reference Guide</a> and the <a class="reference external" href="https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html">glTF 2.0 Specification</a> for more information. See also our <a class="reference external" href="http://howtos.esperide.org/ThreeDimensional.html">HOW-TO about 3D</a> for both more general and practical considerations.</p>
</div>
</div>
<div class="section" id="regarding-data-exchange">
<h3><a class="toc-backref" href="#id131">Regarding Data Exchange</a></h3>
<div class="section" id="serialisation-marshalling-demarshalling">
<span id="serialisation"></span><h4>Serialisation: Marshalling / Demarshalling</h4>
<div class="section" id="purpose">
<h5>Purpose</h5>
<p>When trusted Erlang nodes and Erlang applications are to communicate, they are likely to rely on the (Erlang) <a class="reference external" href="https://www.erlang.org/doc/apps/erts/erl_ext_dist.html">External Term Format</a> for that.</p>
<p>To communicate with other systems (non-Erlang and/or non-trusted) over a network stream (over a transport protocol such as TCP/IP), a common <a class="reference external" href="https://en.wikipedia.org/wiki/Comparison_of_data-serialization_formats">data-serialisation format</a> must be chosen in order to marshall and demarshall the applicative data to be exchanged.</p>
<p>This format can be ad hoc (defined with one's conventions) or standard. We prefer here the latter solution, as a standard format favors interoperability and reduces tedious, error-prone transformations.</p>
<p>Moreover various well-supported standard options exist, like <a class="reference external" href="https://en.wikipedia.org/wiki/External_Data_Representation">XDR</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/ASN.1">ASN.1</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Protocol_Buffers">Protobuf</a> (a.k.a. <em>Protocol Buffer</em>), <a class="reference external" href="http://piqi.org/">Piqi</a> and many others.</p>
</div>
<div class="section" id="choice-of-format">
<h5>Choice of format</h5>
<p>The two formats that we thought were the most suitable and standard were <strong>ASN.1</strong> (with a proper, efficient encoding selected), or <strong>Protobuff</strong>.</p>
<p>As ASN.1 has been defined for long and is properly supported by Erlang (natively), and that there are <a class="reference external" href="https://reasonablypolymorphic.com/blog/protos-are-wrong/index.html">apparently valid claims</a> that Protobuf has some flaws, ASN.1 seemed to us the more relevant technical choice.</p>
</div>
<div class="section" id="about-asn-1">
<h5>About ASN.1</h5>
<p>Erlang supports, out of the box, <a class="reference external" href="https://www.erlang.org/doc/man/asn1ct.html#compile-2">three main ASN.1 encodings</a>:</p>
<ul class="simple">
<li>BER (<a class="reference external" href="https://en.wikipedia.org/wiki/X.690#BER_encoding">Basic Encoding Rules</a>): a type-length-value encoding, too basic to be compact; its DER (for <em>Distinguished Encoding Rules</em>) variation is also available</li>
<li>PER (<em>Packed Encoding Rules</em>): a bit-level serialisation stream, either aligned to byte boundaries (PER) or not (UPER, for <em>Unaligned PER</em>); if both are very compact and complex to marshall/demarshall, it is especially true for the size/processing trade-off of UPER</li>
<li>JER (<em>JSON Encoding Rules</em>), hence based on <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a></li>
</ul>
<p>Our preference goes towards first UPER, then PER. A strength of ASN.1 is the expected ability to switch encodings easily; so, should the OER encoding (<em>Octet Encoding Rules</em>; faster to decode/encode than BER and PER, and almost as compact as PER) be supported in the future, it could be adopted &quot;transparently&quot;.</p>
<p>An issue of this approach is that, beyond Erlang, the (U)PER encoding does not seem so widely available as free software: besides commercial offers (like <a class="reference external" href="https://www.obj-sys.com/products/asn1c/index.php">this one</a>), some languages could be covered to some extent (ex: <a class="reference external" href="https://github.com/eerimoq/asn1tools">Python</a>, Java with <a class="reference external" href="https://github.com/alexvoronov/gcdc-asn1/tree/master/asn1-uper">[1]</a> or <a class="reference external" href="https://github.com/ericsson-mts/mts-asn1">[2]</a>), but for example no such solution could be found for the .NET language family (ex: for C#); also the complexity of the encoding may lead to solutions supporting only a subset of the standard.</p>
<p>So, at least for the moment, we chose Protobuf.</p>
</div>
<div class="section" id="about-protobuf">
<h5>About Protobuf</h5>
<p>Compared to ASN.1 UPER, Protobuf is probably simpler/more limited, and less compact - yet also less demanding in terms of processing regarding (de)marshalling.</p>
<p>Albeit Protobuf is considerably more recent, implementations of it in free software are rather widely available in terms of languages, with <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/reference/overview">reference implementations</a> and third-party ones (example for <a class="reference external" href="https://github.com/protobuf-net/protobuf-net">.NET</a>).</p>
<p>In the case of Erlang, Protobuf is not natively supported, yet various libraries offer such a support.</p>
<p><a class="reference external" href="https://github.com/tomas-abrahamsson/gpb">gpb</a> seems to be the recommended option, this is therefore the backend that we retained. For increased performance, <a class="reference external" href="https://github.com/jg513/enif_protobuf">enif_protobuf</a> could be considered as a possible drop-in replacement.</p>
<p>Our procedure to install <tt class="docutils literal">gpb</tt>:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> ~/Software/gpb
$ git clone git&#64;github.com:tomas-abrahamsson/gpb.git
$ ln -s gpb gpb-current-install
$ <span class="nb">cd</span> gpb <span class="o">&amp;&amp;</span> make all
</pre>
<p>Then, so that <tt class="docutils literal"><span class="pre">protoc-erl</span></tt> is available on the shell, one may add in one's <tt class="docutils literal"><span class="pre">~/.bashrc</span></tt>:</p>
<pre class="code bash literal-block">
<span class="c1"># Erlang protobuf gpb support:
</span><span class="nb">export</span> <span class="nv">GPB_ROOT</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/Software/gpb/gpb-current-install&quot;</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GPB_ROOT</span><span class="si">}</span><span class="s2">/bin:</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}</span><span class="s2">&quot;</span>
</pre>
<p>Our preferred settings (configurable, yet by default enforced natively by Myriad's build system) are: (between parentheses, the gbp API counterpart to the <tt class="docutils literal"><span class="pre">protoc-erl</span></tt> command-line options)</p>
<ul class="simple">
<li><tt class="docutils literal">proto3</tt> version rather than <tt class="docutils literal">proto2</tt> (so <tt class="docutils literal">{proto_defs_version,3}</tt>)</li>
<li>messages shall be decoded as tuples/records rather than maps (so not specifying the <tt class="docutils literal"><span class="pre">-maps</span></tt> / <tt class="docutils literal">maps</tt> option, not even <tt class="docutils literal"><span class="pre">-mapfields-as-maps</span></tt>) for a better compactness and a clearer, more statically-defined structure - even if it implies including the generated <tt class="docutils literal">*.hrl</tt> files in the user code and complexifying the build (ex: tests having to compile with or without a Protobuff backend available, with or without generated headers; refer to <tt class="docutils literal">protobuf_support_test.erl</tt> for a full, integrated example)</li>
<li>decoded strings should be returned as binaries rather than plain ones (so specifying the <tt class="docutils literal"><span class="pre">-strbin</span></tt> / <tt class="docutils literal">strings_as_binaries</tt> option)</li>
<li><tt class="docutils literal"><span class="pre">-pkgs</span></tt> /  <tt class="docutils literal">use_packages</tt> (and <tt class="docutils literal">{pkg_name, {prefix, &quot;MyPackage&quot;}</tt>) to prefix a message name by its package (regardless of the <tt class="docutils literal">.proto</tt> filename in which it is defined)</li>
<li><tt class="docutils literal"><span class="pre">-rename</span> msg_fqname:snake_case</tt> then <tt class="docutils literal"><span class="pre">-rename</span> msg_fqname:dots_to_underscores</tt> (in that order), so that a message type named <tt class="docutils literal">Person</tt> defined in package <tt class="docutils literal">myriad.protobuf.test</tt> results in the definition of a <tt class="docutils literal">myriad_protobuf_test_person()</tt> type and in a <tt class="docutils literal">#myriad_protobuf_test_person{}</tt> record</li>
<li><tt class="docutils literal"><span class="pre">-preserve-unknown-fields</span></tt> (thus <tt class="docutils literal">preserve_unknown_fields</tt>) will be set iff <tt class="docutils literal">EXECUTION_TARGET</tt> has been set to <tt class="docutils literal">development</tt> (<tt class="docutils literal">myriad_check_protobuf</tt> is enabled), and in this case will be checked so that a warning trace is sent if decoding unknown fields</li>
<li><tt class="docutils literal"><span class="pre">-MMD</span></tt> / <tt class="docutils literal">list_deps_and_generate</tt> to generate a <tt class="docutils literal">GNUmakedeps.protobuf</tt> makefile tracing dependencies between message types</li>
<li><tt class="docutils literal"><span class="pre">-v</span></tt> / <tt class="docutils literal">verify</tt> set to  <tt class="docutils literal">never</tt>, unless <tt class="docutils literal">EXECUTION_TARGET</tt> has been set to <tt class="docutils literal">development</tt> (<tt class="docutils literal">myriad_check_protobuf</tt> is enabled), in which case it is set to  <tt class="docutils literal">always</tt></li>
<li><tt class="docutils literal"><span class="pre">-vdrp</span></tt> / <tt class="docutils literal">verify_decode_required_present</tt> set iff <tt class="docutils literal">EXECUTION_TARGET</tt> has been set to <tt class="docutils literal">development</tt> (<tt class="docutils literal">myriad_check_protobuf</tt> is enabled)</li>
<li><tt class="docutils literal"><span class="pre">-Werror</span></tt> / <tt class="docutils literal">warnings_as_errors</tt>, <tt class="docutils literal"><span class="pre">-W1</span></tt> / <tt class="docutils literal">return_warnings</tt>, <tt class="docutils literal">return_errors</tt> (preferably to their <tt class="docutils literal">report*</tt> counterparts)</li>
</ul>
<p>We prefer generating Protobuff (Erlang) accessors thanks to the command-line rather than driving the generating through a specific Erlang program relying on the gpb API.</p>
<p>See our <tt class="docutils literal">protobuf_support</tt> module for further information.</p>
<p>This support may be enabled from Myriad's <tt class="docutils literal">GNUmakevars.inc</tt>, thanks to the <tt class="docutils literal">USE_PROTOBUF</tt> boolean variable that implies in turn the <tt class="docutils literal">USE_GPB</tt> one.</p>
<p>One may also rely on our:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">GNUmakerules-protobuf.inc</span></tt>, in <tt class="docutils literal"><span class="pre">src/data-management</span></tt>, to include in turn any relevant dependency information; dependencies are by default automatically generated in a <tt class="docutils literal">GNUmakedeps.protobuf</tt> file</li>
<li>general explicit rules, for example <tt class="docutils literal"><span class="pre">generate-protobuf</span></tt> (to generate accessors), <tt class="docutils literal"><span class="pre">info-protobuf</span></tt> and <tt class="docutils literal"><span class="pre">clean-protobuf</span></tt> (to remove generated accessors)</li>
<li>automatic rules, for example <tt class="docutils literal">make X.beam</tt> when a <tt class="docutils literal">X.proto</tt> exists in the current directory; applies our recommended settings)</li>
</ul>
<p>One may note that:</p>
<ul class="simple">
<li>a Protobuff message, i.e. the (binary) serialised form of a term (here being a record), is generally smaller than this term (for example, <tt class="docutils literal">protobuf_support_test</tt> reports a binary of 39 bytes, to be compared to the 112 bytes reported for the corresponding record/tuple)</li>
<li>the encoding of the serialised form does not imply any specific obfuscation; for example binary strings comprised in the term to serialise may be directly readable from its binary serialisation, as clear text</li>
</ul>
<p>References:</p>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Protocol_Buffers">general Protobuf Wikipedia presentation</a></li>
<li><a class="reference external" href="https://developers.google.com/protocol-buffers">official page of Protobuf</a></li>
<li><a class="reference external" href="https://developers.google.com/protocol-buffers/docs/proto3">proto3 Language Guide</a></li>
<li>gpb-related information:<ul>
<li>command-line options: <tt class="docutils literal"><span class="pre">protoc-erl</span> <span class="pre">-h</span></tt></li>
<li><a class="reference external" href="https://hexdocs.pm/gpb/">gpb API documentation</a>, notably the many options of <a class="reference external" href="https://hexdocs.pm/gpb/gpb_compile.html#option-use_packages">gpb_compile documentation</a> and the <a class="reference external" href="https://hexdocs.pm/gpb/gpb_compile.html#description">Erlang-Protobuff mapping</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="for-basic-old-school-ciphering">
<h4>For Basic, Old-School Ciphering</h4>
<p>The spirit here is to go another route than modern public-key cryptography: the classic, basic, chained, symmetric cryptography techniques used in this section apply to contexts where a preliminary, safe exchange <em>can</em> happen between peers (ex: based on a real-life communication).</p>
<p>Then any number of passes of low-key, unfashioned algorithms (including one based on a Mealy machine) are applied to the data that is to cypher or decypher.</p>
<p>We believe that, should the corresponding shared &quot;key&quot; (the combination of parameterised transformations to apply on the data) remain uncompromised, the encrypted data is at least as safe as if cyphered with the current, modern algorithms (which may be, intentionally or not, flawed, or may be specifically threatened by potential progresses for example in terms of quantum computing).</p>
<p>So this is surely an instance of &quot;security by obscurity&quot;, a pragmatic strategy (which may be used in conjunction with the &quot;security by design&quot; and &quot;open security&quot; ones) discouraged by standards bodies, yet in our opinion likely - for data of lesser importance - to resist well (as we do not expect then attackers to specifically target our very own set of measures, since the specific efforts incurred would not be outweighed by the expected gains).</p>
<p>We thus see such old-school ciphering as a complementary measure to the standard, ubiquitous measures whose effectiveness is difficult to assess for individuals and thus require some level of trust.</p>
<p>Refer to <tt class="docutils literal">cipher_utils</tt> and its associated test for more details, and also to our <a class="reference external" href="http://howtos.esperide.org/Cybersecurity.html">mini-HOWTO regarding cybersecurity</a>.</p>
<p></p>
</div>
</div>
</div>
<div class="section" id="support-for-code-injection">
<span id="code-injection"></span><h2><a class="toc-backref" href="#id132">Support for Code Injection</a></h2>
<p>It may be useful to decide, at compile-time, whether some code should be added / removed / transformed / generated based on <strong>tokens</strong> defined by the user.</p>
<p>This is done here thanks to the use of <strong>conditional primitives</strong> and associated <strong>compilation defines</strong> (sometimes <a class="reference external" href="https://erlang.org/doc/man/erlc.html#generally-useful-flags">designated as &quot;macros&quot;</a>, and typically specified in makefiles, with the <tt class="docutils literal"><span class="pre">-D</span></tt> flag).</p>
<p>These conditional primitives are gathered in the <tt class="docutils literal">cond_utils</tt> module.</p>
<p>As an early example, so that a piece of code prints <tt class="docutils literal">Hello!</tt> on the console when executed iff (<em>if and only if</em>) the <tt class="docutils literal">my_token</tt> compilation token has been defined (through the <tt class="docutils literal"><span class="pre">-Dmy_token</span></tt> command-line flag), one may use:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="n">my_token</span><span class="p">,</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">))</span>
</pre>
<p>Of course, as such a code injection is done at compilation-time, should compilation defines be modified the modules making use of the corresponding primitives shall be recompiled so that these changes are taken into account.</p>
<p>Let's enter a bit more in the details now.</p>
<div class="section" id="defining-a-token">
<h3><a class="toc-backref" href="#id133">Defining a token</a></h3>
<p>A <em>token</em> (a compilation-time symbol) may or may not defined.</p>
<p>To define <tt class="docutils literal">my_token</tt>, simply ensure that a <tt class="docutils literal"><span class="pre">-Dmy_token</span></tt> command-line option is specified to the compiler (ex: refer to <tt class="docutils literal">ERLANG_COMPILER_TOKEN_OPT</tt>, in <tt class="docutils literal">GNUmakevars.inc</tt>, for an example of definition for these flags).</p>
<p>To define <tt class="docutils literal">my_token</tt> <em>and</em> set it to the integer value <tt class="docutils literal">127</tt>, use the <tt class="docutils literal"><span class="pre">-Dmy_token=127</span></tt> command-line option. Values can also be floats (ex: <tt class="docutils literal"><span class="pre">-Dmy_token=3.14</span></tt>) or atoms (ex: <tt class="docutils literal"><span class="pre">-Dmy_token=some_atom</span></tt>).</p>
<p>A special token is <tt class="docutils literal">myriad_debug_mode</tt>; if it is defined at all (and possibly associated to any value), the debug mode of Myriad is enabled.</p>
<p>We recommend that layers built on top of Myriad define their own token for debug mode (ex: <tt class="docutils literal">foobar_debug_mode</tt>), to be able to finely select appropriate debug modes (of course all kinds of modes and configuration settings can be considered as well).</p>
</div>
<div class="section" id="defining-the-code-to-inject">
<h3><a class="toc-backref" href="#id134">Defining the code to inject</a></h3>
<p>Based on the defined tokens, code may be injected; this code can be any Erlang expression, and the value to which it will evaluate (at runtime) can be used as any other value in the program.</p>
<p>Injecting a <em>single</em> expression (i.e. not multiple ones) is not a limitation: not only this single expression can be a function call (thus corresponding to arbitrarily many expressions), but more significantly a sequence of expressions (a.k.a. a <em>body</em>) can be nested in a <tt class="docutils literal">begin</tt> / <tt class="docutils literal">end</tt> block, making them a single expression <a class="footnote-reference" href="#id47" id="id46">[10]</a>.</p>
<table class="docutils footnote" frame="void" id="id47" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id46">[10]</a></td><td><p class="first">A previous implementation of <tt class="docutils literal">cond_utils</tt> allowed to specify the code to inject either as an expression or as a <em>list</em> of expressions.</p>
<p>It was actually a mistake, as a single expression to return can be itself a list (ex: <tt class="docutils literal">[&quot;red&quot;, &quot;blue&quot;]</tt>), which bears a different semantics and should not be interpreted as a list of expressions to evaluate. For example, the result from the code to inject may be bound to a variable, in which case we expect <tt class="docutils literal"><span class="pre">A=[&quot;red&quot;,</span> &quot;blue&quot;]</tt> rather than <tt class="docutils literal"><span class="pre">A=&quot;red&quot;,</span> &quot;blue&quot;</tt> (this latter term being constructed but not used).</p>
<p>So the following code injection <em>is</em> faulty (a <tt class="docutils literal">begin/end</tt> block was meant, not a list):</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="n">my_token</span><span class="p">,</span> <span class="p">[</span>
    <span class="nv">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Hello </span><span class="si">~p</span><span class="s">!</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">A</span><span class="p">])]),</span>
</pre>
<p class="last">(and moreover such code will trigger a compilation error, the <tt class="docutils literal">A</tt> in <tt class="docutils literal">io:format/2</tt> being reported as unbounded then)</p>
</td></tr>
</tbody>
</table>
</div>
<div class="section" id="using-tokens-to-enable-code-injection">
<h3><a class="toc-backref" href="#id135">Using tokens to enable code injection</a></h3>
<p>Various primitives for <em>code injection</em> are available in the <tt class="docutils literal">cond_utils</tt> (mostly pseudo-) module <a class="footnote-reference" href="#id49" id="id48">[11]</a>.</p>
<table class="docutils footnote" frame="void" id="id49" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id48">[11]</a></td><td>Their actual implementation lies in <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/meta/myriad_parse_transform.erl">Myriad's parse transform</a>.</td></tr>
</tbody>
</table>
<p>There is first <tt class="docutils literal">if_debug/1</tt>, to be used as:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_debug</span><span class="p">(</span><span class="nv">EXPR_IF_IN_DEBUG_MODE</span><span class="p">)</span>
</pre>
<p>Like in:</p>
<pre class="code erlang literal-block">
<span class="nv">A</span> <span class="o">=</span> <span class="s">&quot;Joe&quot;</span><span class="p">,</span>
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_debug</span><span class="p">(</span><span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Hello </span><span class="si">~s</span><span class="s">!&quot;</span><span class="p">,[</span><span class="nv">A</span><span class="p">]))</span>
</pre>
<p>or, to illustrate expression blocks:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_debug</span><span class="p">(</span><span class="k">begin</span>
                        <span class="nv">C</span><span class="o">=</span><span class="nv">B</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                        <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Goodbye </span><span class="si">~p</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">C</span><span class="p">])</span>
                    <span class="k">end</span><span class="p">)</span>
</pre>
<p>These constructs will be replaced by the expression they specify for injection, at their location in the program, iff the <tt class="docutils literal">myriad_debug_mode</tt> token has been defined, otherwise they will be replaced by nothing at all (hence with exactly <em>no</em> runtime penalty; and the result of the evaluation of <tt class="docutils literal">if_debug/1</tt> is then not an expression).</p>
<p>Similarly, <tt class="docutils literal">if_defined/2</tt>, used as:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="nv">TOKEN</span><span class="p">,</span> <span class="nv">EXPR_IF_DEFINED</span><span class="p">)</span>
</pre>
<p>will inject <tt class="docutils literal">EXPR_IF_DEFINED</tt> if <tt class="docutils literal">TOKEN</tt> has been defined (regardless of any value associated to this token), otherwise the <tt class="docutils literal">if_defined/2</tt> call will be removed as a whole <a class="footnote-reference" href="#id51" id="id50">[12]</a>.</p>
<table class="docutils footnote" frame="void" id="id51" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id50">[12]</a></td><td>So <tt class="docutils literal">if_debug(EXPR)</tt> behaves exactly as: <tt class="docutils literal">if_defined(myriad_debug_mode,EXPR)</tt>.</td></tr>
</tbody>
</table>
<p>As for <tt class="docutils literal">if_defined/3</tt>, it supports two expressions:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="nv">TOKEN</span><span class="p">,</span> <span class="nv">EXPR_IF_DEFINED</span><span class="p">,</span> <span class="nv">EXPR_OTHERWISE</span><span class="p">)</span>
</pre>
<p>For example:</p>
<pre class="code erlang literal-block">
<span class="c">% Older versions being less secure:
</span><span class="nv">TLSSupportedVersions</span> <span class="o">=</span> <span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="n">us_web_relaxed_security</span><span class="p">,</span>
  <span class="p">[</span><span class="n">'tlsv1.3'</span><span class="p">,</span> <span class="n">'tlsv1.2'</span><span class="p">,</span> <span class="n">'tlsv1.1'</span><span class="p">,</span> <span class="n">'tlsv1'</span><span class="p">],</span>
  <span class="p">[</span><span class="n">'tlsv1.3'</span><span class="p">])</span>
</pre>
<p>If <tt class="docutils literal">us_web_relaxed_security</tt> has been defined, the first list will be injected, otherwise the second will.</p>
<p>Note that a call to <tt class="docutils literal">if_defined/3</tt> results thus in an expression.</p>
<p>Finally, with <tt class="docutils literal"><span class="pre">if_set_to/{3,4}</span></tt>, the injection will depend not only of a token being defined or not, but also onto the value (if any) to which it is set.</p>
<p>For <tt class="docutils literal">if_set_to/3</tt>:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="nv">TOKEN</span><span class="p">,</span> <span class="nv">VALUE</span><span class="p">,</span> <span class="nv">EXPR_IF_SET_TO_THIS_VALUE</span><span class="p">)</span>
</pre>
<p>will inject <tt class="docutils literal">EXPR_IF_SET_TO_THIS_VALUE</tt> iff <tt class="docutils literal">TOKEN</tt> has been defined and set to <tt class="docutils literal">VALUE</tt>. As a result, the specified expression will not be injected if <tt class="docutils literal">some_token</tt> has been set to another value, or not been defined at all.</p>
<p>Usage example, <tt class="docutils literal"><span class="pre">-Dsome_token=42</span></tt> having possibly been defined beforehand:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_set_to</span><span class="p">(</span><span class="n">some_token</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span> <span class="nv">SomePid</span> <span class="o">!</span> <span class="n">hello</span><span class="p">)])</span>
</pre>
<p>As for <tt class="docutils literal">if_set_to/4</tt>, in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_set_to</span><span class="p">(</span><span class="nv">TOKEN</span><span class="p">,</span> <span class="nv">VALUE</span><span class="p">,</span> <span class="nv">EXPR_IF_SET_TO_THIS_VALUE</span><span class="p">,</span> <span class="nv">EXPR_OTHERWISE</span><span class="p">)</span>
</pre>
<p><tt class="docutils literal">EXPR_IF_SET_TO_THIS_VALUE</tt> will be injected iff <tt class="docutils literal">TOKEN</tt> has been defined and set to <tt class="docutils literal">VALUE</tt>, otherwise (not set or set to a different value) <tt class="docutils literal">EXPR_OTHERWISE</tt> will be.</p>
<p>Example:</p>
<pre class="code erlang literal-block">
<span class="nv">Level</span> <span class="o">=</span> <span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_set_to</span><span class="p">(</span><span class="n">my_token</span><span class="p">,</span> <span class="n">foobar_enabled</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">.</span><span class="mi">5</span>
</pre>
<p>A similar construct in spirit  is <tt class="docutils literal">switch_execution_target/2</tt>, which will, depending on the current build-time <a class="reference internal" href="#execution-target">execution target</a>, inject a corresponding expression:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">switch_execution_target</span><span class="p">(</span><span class="nv">EXPR_IF_IN_DEVELOPMENT_MODE</span><span class="p">,</span> <span class="nv">EXPR_IF_IN_PRODUCTION_MODE</span><span class="p">)</span>
</pre>
<p>So if the current execution target is development, the compilation will inject <tt class="docutils literal">EXPR_IF_IN_DEVELOPMENT_MODE</tt>, otherwise <tt class="docutils literal">EXPR_IF_IN_PRODUCTION_MODE</tt> will be.</p>
<p>Example:</p>
<pre class="code erlang literal-block">
<span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span> <span class="s">&quot;We are in ~ts mode.&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="nn">cond_utils</span><span class="p">:</span><span class="nf">switch_execution_target</span><span class="p">(</span><span class="s">&quot;development&quot;</span><span class="p">,</span> <span class="s">&quot;production&quot;</span><span class="p">)])</span>
</pre>
<p>Finally, the <tt class="docutils literal"><span class="pre">switch_set_to/{2,3}</span></tt> primitives allow to generalise these <tt class="docutils literal">if</tt>-like constructs, with one among any number of code branches selected based on the build-time value of a token, possibly with defaults (should the token not be defined at all, or defined to a value that is not among the ones associated to a code branch).</p>
<p>For that we specify a list of pairs, each made of a value and of the corresponding expression to be injected if the actual token matches that value, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">switch_set_to</span><span class="p">(</span><span class="nv">TOKEN</span><span class="p">,</span> <span class="p">[</span>
       <span class="p">{</span><span class="nv">VALUE_1</span><span class="p">,</span> <span class="nv">EXPR_1</span><span class="p">},</span>
       <span class="p">{</span><span class="nv">VALUE_2</span><span class="p">,</span> <span class="nv">EXPR_2</span><span class="p">},</span>
       <span class="c">% [...]
</span>       <span class="p">{</span><span class="nv">VALUE_N</span><span class="p">,</span> <span class="nv">EXPR_N</span><span class="p">}])</span>
</pre>
<p>For example:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">switch_set_to</span><span class="p">(</span><span class="n">my_token</span><span class="p">,</span> <span class="p">[</span>
     <span class="p">{</span><span class="n">my_first_value</span><span class="p">,</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)},</span>
     <span class="p">{</span><span class="n">my_second_value</span><span class="p">,</span> <span class="k">begin</span> <span class="n">f</span><span class="p">(),</span> <span class="n">g</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="n">debug</span><span class="p">),</span> <span class="n">h</span><span class="p">()</span> <span class="k">end</span><span class="p">},</span>
     <span class="p">{</span><span class="n">some_third_value</span><span class="p">,</span> <span class="n">a</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">Y</span><span class="p">)}])</span>
</pre>
<p>A compilation-time error will be raised if <tt class="docutils literal">my_token</tt> is not set, or if it is set to none of the declared values (i.e. not in <tt class="docutils literal">[my_first_value, my_second_value, some_third_value]</tt>).</p>
<p>A variation of this primitive exists that applies a default token value if none was, or if the token was set to a value that is not listed among any of the ones designating a code branch, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">switch_set_to</span><span class="p">(</span><span class="nv">TOKEN</span><span class="p">,</span>
                         <span class="p">[</span> <span class="p">{</span><span class="nv">VALUE_1</span><span class="p">,</span> <span class="nv">EXPR_1</span><span class="p">},</span>
                           <span class="p">{</span><span class="nv">VALUE_2</span><span class="p">,</span> <span class="nv">EXPR_2</span><span class="p">},</span>
                           <span class="c">% [...]
</span>                           <span class="p">{</span><span class="nv">VALUE_N</span><span class="p">,</span> <span class="nv">EXPR_N</span><span class="p">}],</span>
                         <span class="nv">DEFAULT_VALUE</span><span class="p">)</span>
</pre>
<p>As always with primitives that define a default, alternate branch, they always inject an expression and thus can be considered as such.</p>
<p>For example:</p>
<pre class="code erlang literal-block">
<span class="nv">ModuleFilename</span> <span class="o">=</span> <span class="nb">atom_to_list</span><span class="p">(</span> <span class="nn">cond_utils</span><span class="p">:</span><span class="nf">switch_set_to</span><span class="p">(</span><span class="n">some_token</span><span class="p">,</span>
              <span class="p">[{</span><span class="mi">1</span><span class="p">,</span> <span class="n">foo</span><span class="p">},</span> <span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="n">bar</span><span class="p">},</span> <span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="n">hello</span><span class="p">}],</span> <span class="mi">14</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;.erl&quot;</span>
</pre>
<p>Here, if <tt class="docutils literal">some_token</tt> is not defined, or defined to a value that is neither <tt class="docutils literal">1</tt>, <tt class="docutils literal">14</tt> or <tt class="docutils literal">20</tt>, then the <tt class="docutils literal">14</tt> default value applies, and thus <tt class="docutils literal">ModuleFilename</tt> is set to <tt class="docutils literal">&quot;bar.erl&quot;</tt>.</p>
<p>Refer to <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/test/meta/cond_utils_test.erl">cond_utils_test.erl</a> for further usage examples.</p>
</div>
<div class="section" id="controlling-assertions">
<h3><a class="toc-backref" href="#id136">Controlling assertions</a></h3>
<p>It may be convenient that, depending on a compile-time token (ex: in debug mode, typically triggered thanks to the <tt class="docutils literal"><span class="pre">-Dmyriad_debug_mode</span></tt> compilation flag), <em>assertions</em> (expressions expected to evaluate to the atom <tt class="docutils literal">true</tt>) are enabled, whereas they shall be dismissed as a whole should that token not be defined.</p>
<p>To define an assertion enabled in debug mode, use <tt class="docutils literal">assert/1</tt>, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="nv">B</span><span class="p">)</span><span class="o">=:=</span><span class="mi">10</span><span class="p">)</span>
</pre>
<p>Should at runtime the expression specified to <tt class="docutils literal">assert/1</tt> be evaluated to a value <tt class="docutils literal">V</tt> that is different from the atom <tt class="docutils literal">true</tt>, a <tt class="docutils literal">{assertion_failed,V}</tt> exception will be thrown.</p>
<p>More generally, an assertion may be enabled by any token (not only <tt class="docutils literal">myriad_debug_mode</tt>) being defined, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">my_token</span><span class="p">,</span><span class="n">bar</span><span class="p">(</span><span class="nv">C</span><span class="p">))</span>
</pre>
<p>Finally, an assertion may be enabled iff a token (here, <tt class="docutils literal">some_token</tt>) has been defined and set to a given value (here, <tt class="docutils literal">42</tt>), like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">some_token</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="ow">not</span> <span class="n">baz</span><span class="p">()</span> <span class="ow">andalso</span> <span class="nv">A</span><span class="p">)</span>
</pre>
<p>This may be useful for example to control, on a per-theme basis, the level of checking performed, like in:</p>
<pre class="code erlang literal-block">
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">debug_gui</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">basic_testing</span><span class="p">()),</span>
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">debug_gui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">more_involved_testing</span><span class="p">()),</span>
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">assert</span><span class="p">(</span><span class="n">debug_gui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">paranoid_testing</span><span class="p">()),</span>
</pre>
<p>Note that, in this case, a given level of checking should include the one just below it (ex: <tt class="docutils literal">more_involved_testing()</tt> should call <tt class="docutils literal">basic_testing()</tt>).</p>
<p>Finally, if assertions are too limited (ex: because they lead to unused variables depending on a token being defined or not), using one of the <tt class="docutils literal">cond_utils:if*</tt> primitives relying on two branches (one expression if a condition is true, another if not) should sufficient to overcome such issue.</p>
</div>
<div class="section" id="usage-hints">
<h3><a class="toc-backref" href="#id137">Usage Hints</a></h3>
<p>For tokens, at least currently they must be defined as immediate values (atoms); even using a mute variable, like for the <tt class="docutils literal">_Default=my_token</tt> expression, or a variable, is not supported (at least yet).</p>
<p>Note that, for primitives that may not inject code at all (ex: <tt class="docutils literal">if_debug/1</tt>), if their conditions are not fulfilled, the specified conditional code is dismissed as a whole, it is not even replaced for example by an <tt class="docutils literal">ok</tt> atom; this may matter if this conditional is the only expression in a case clause for example, in which case a compilation failure like &quot;<em>internal error in core; crash reason: function_clause in function v3_core:cexprs/3 called as v3_core:cexprs[...]</em>&quot; will be reported (the compiler sees unexpectedly a clause not having even a single expression).</p>
<p>A related issue may happen when switching conditional flags: it will select/deselect in-code expressions at compile time, and may lead functions and/or variables to become unused, and thus may trigger at least warnings <a class="footnote-reference" href="#id53" id="id52">[13]</a>.</p>
<table class="docutils footnote" frame="void" id="id53" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id52">[13]</a></td><td>Warnings that we prefer promoting to errors, as they constitute a <em>very</em> convenient safety net.</td></tr>
</tbody>
</table>
<p>For <strong>functions</strong> that could become unused due to the conditional setting of a token, the compiler could certainly be silenced by exporting them; yet a better approach is surely to use:</p>
<pre class="code erlang literal-block">
<span class="p">-</span><span class="ni">compile</span><span class="p">({</span><span class="n">nowarn_unused_function</span><span class="p">,</span><span class="n">my_func</span><span class="o">/</span><span class="mi">3</span><span class="p">}).</span>
</pre>
<p>or:</p>
<pre class="code erlang literal-block">
<span class="p">-</span><span class="ni">compile</span><span class="p">({</span><span class="n">nowarn_unused_function</span><span class="p">,[</span><span class="n">my_func</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">my_other_func</span><span class="o">/</span><span class="mi">0</span><span class="p">]}).</span>
</pre>
<p>As for <strong>variables</strong>, should A, B or C be reported as unused if <tt class="docutils literal">some_token</tt> was not set, then the <tt class="docutils literal">basic_utils:ignore_unused/1</tt> function (mostly a no-op) could be of use:</p>
<pre class="code erlang literal-block">
<span class="p">[...]</span>
<span class="nn">cond_utils</span><span class="p">:</span><span class="nf">if_defined</span><span class="p">(</span><span class="n">some_token</span><span class="p">,</span>
                      <span class="n">f</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span> <span class="nv">B</span><span class="p">,</span> <span class="nv">C</span><span class="p">),</span>
                      <span class="nn">basic_utils</span><span class="p">:</span><span class="nf">ignore_unused</span><span class="p">([</span><span class="nv">A</span><span class="p">,</span> <span class="nv">B</span><span class="p">,</span> <span class="nv">C</span><span class="p">])),</span>
<span class="p">[...]</span>
</pre>
<p>Alternatively, <tt class="docutils literal">nowarn_unused_vars</tt> could be used instead, at least in some modules.</p>
</div>
<div class="section" id="for-more-information">
<h3><a class="toc-backref" href="#id138">For more information</a></h3>
<p>Refer for usage and stubs to the <tt class="docutils literal">cond_utils</tt> module (defined in <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/tree/master/src/meta">myriad/src/meta</a>), knowing that it is actually implemented thanks to the Myriad parse transform.</p>
<p>For examples and testing, see the <tt class="docutils literal">cond_utils_test</tt> module.</p>
<p></p>
</div>
</div>
<div class="section" id="myriadgui-helpers-for-user-interface-programming">
<span id="myriadgui"></span><span id="graphical-user-interface"></span><span id="user-interface"></span><h2><a class="toc-backref" href="#id139">MyriadGUI: Helpers For User Interface Programming</a></h2>
<p>Some services have been defined, in <tt class="docutils literal"><span class="pre">myriad/src/user-interface</span></tt>, in order to handle more easily interactions with the user, i.e. to provide a user interface.</p>
<p>The spirit of <strong>MyriadGUI</strong> is to offer, as much as possible, a high-level API (refer to the <tt class="docutils literal">ui</tt> module) that can be seamlessly instrumented at runtime by different backends, depending on availability (ex: is this dependency installed?) and context (ex: is the program running in a terminal, or are graphical outputs possible?).</p>
<p>Unless the user forces the use of a given backend, the most advanced one that is locally available will be automatically selected.</p>
<p>An objective is to shelter user code from:</p>
<ul class="simple">
<li>the actual UI backend that will be selected ultimately on a given host</li>
<li>the rise and fall of the various backends (thinking for example to <tt class="docutils literal">gs</tt> having been quickly deprecated in favour of <tt class="docutils literal">wx</tt>); the idea is then that any new backend could be integrated, with <em>little to no change</em> in already-written code relying on MyriadGUI</li>
</ul>
<p>Of course not all features of all backends can be integrated (they have not the same expressivity, a common base must be enforced <a class="footnote-reference" href="#id55" id="id54">[14]</a>) and creating a uniform interface over all sorts of vastly different ways of displaying and interacting with the user would require a lot of efforts. So MyriadGUI follows a pragmatic route: defining first basic, relevant, user-centric conventions and services able to cover most needs and to federate (hopefully) most backends, and to incrementally augment its implementation coverage on a per-need basis. As a consequence, efforts have been made so that adding any lacking element can be done at low cost.</p>
<table class="docutils footnote" frame="void" id="id55" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id54">[14]</a></td><td>Yet optional, additional features may be defined, and each backend may choose to provide them or ignore them.</td></tr>
</tbody>
</table>
<div class="section" id="various-flavours-of-user-interfaces">
<h3><a class="toc-backref" href="#id140">Various Flavours of User Interfaces</a></h3>
<p>Such a user interface may be:</p>
<ul class="simple">
<li>either <strong>text-only</strong>, within a console, relying either on the very basic <tt class="docutils literal">text_ui</tt> (for raw text) or its more advanced <tt class="docutils literal">term_ui</tt> counterpart (for terminal-based outputs, with colours and text-based widgets)</li>
<li>or <strong>graphical</strong>, with <tt class="docutils literal">gui</tt></li>
<li>(and/or, in a possible future, <strong>audio</strong>, with a <tt class="docutils literal">audio_gui</tt> that could be added)</li>
</ul>
<p>Text-based user interfaces are quite useful, as they are lightweight, incur few dependencies (if any), and can be used with headless remote servers (<tt class="docutils literal">text_ui</tt> and <tt class="docutils literal">term_ui</tt> work well through SSH, and require no X server nor mouse).</p>
<p>As for graphical-based user interfaces, they are the richest, most usual, and generally the most convenient, user-friendly interfaces.</p>
<p>The user interfaces provided by Myriad are stateful, they rely on a <strong>state</strong> that can be:</p>
<ul class="simple">
<li>either <tt class="docutils literal">explicit</tt>, in a functional way; thus having to be carried in all calls</li>
<li>or <tt class="docutils literal">implicit</tt>, using - for that very specific need only - the process dictionary (even if we try to stay away of it as much as possible)</li>
</ul>
<p>We tested the two approaches and preferred the latter (implicit) one, which was found considerably more flexible and thus finally fully superseded the (former) explicit one.</p>
<p>We made our best so that a lower-level API interface (relying on a more basic backend) is <strong>strictly included</strong> in the higher-level ones (ex: <tt class="docutils literal">term_ui</tt> adds concepts - like the one of window or box - to the line-based <tt class="docutils literal">text_ui</tt>; similarly <tt class="docutils literal">gui</tt> is richer than <tt class="docutils literal">term_ui</tt>), in order that any program using a given user interface may use any of the next, upper ones as well (provided implicit states are used), in the following order: the <tt class="docutils literal">text_ui</tt> API is included in the one of <tt class="docutils literal">term_ui</tt>, which is itself included in the one of <tt class="docutils literal">gui</tt>.</p>
<p>We also defined the <strong>settings table</strong>, which is a table gathering all the settings specified by the developer, which the current user interface does its best to accommodate.</p>
<p>Thanks to these &quot;Matryoshka&quot; APIs and the settings table, the definition of a more generic <tt class="docutils literal">ui</tt> interface has been possible. It selects automatically, based on available local software dependencies, <strong>the most advanced available backend</strong>, with the most relevant settings.</p>
<p>For example a relevant backend will be automatically selected by:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> test/user-interface
$ make ui_run
</pre>
<p>On the other hand, if wanting to select a specified backend:</p>
<pre class="code bash literal-block">
$ make ui_run <span class="nv">CMD_LINE_OPT</span><span class="o">=</span><span class="s2">&quot;--use-ui-backend term_ui&quot;</span>
</pre>
<p>(see the corresponding <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/test/user-interface/GNUmakefile">GNUmakefile</a> for more information)</p>
</div>
<div class="section" id="raw-text-user-interface-text-ui">
<h3><a class="toc-backref" href="#id141">Raw Text User Interface: <tt class="docutils literal">text_ui</tt></a></h3>
<p>This is the most basic, line-based monochrome textual interface, directly in raw text with no cursor control.</p>
<p>It is located in <tt class="docutils literal"><span class="pre">{src,test}/user-interface/textual</span></tt>; see <tt class="docutils literal">text_ui.erl</tt> for its implementation, and <tt class="docutils literal">text_ui_test.erl</tt> for an example of its use.</p>
</div>
<div class="section" id="terminal-text-user-interface-term-ui">
<h3><a class="toc-backref" href="#id142">Terminal Text User Interface: <tt class="docutils literal">term_ui</tt></a></h3>
<p>This is a more advanced textual interface than the previous one, with colors, dialog boxes, support of locales, etc., based on <a class="reference external" href="https://en.wikipedia.org/wiki/Dialog_(software)">dialog</a> (possibly <a class="reference external" href="https://en.wikipedia.org/wiki/Newt_(programming_library)">whiptail</a> could be supported as well). Such backend of course must be available on the execution host then.</p>
<p>For example, to secure these prerequisites:</p>
<pre class="code bash literal-block">
<span class="c1"># On Arch Linux:
</span>$ pacman -S dialog

<span class="c1"># On Debian-like distros:
</span>$ apt-get install dialog
</pre>
<p>It is located in <tt class="docutils literal"><span class="pre">{src,test}/user-interface/textual</span></tt>; see <tt class="docutils literal">term_ui.erl</tt> for its implementation, and <tt class="docutils literal">term_ui_test.erl</tt> for an example of its use.</p>
</div>
<div class="section" id="graphical-user-interface-gui">
<h3><a class="toc-backref" href="#id143">Graphical User Interface: <tt class="docutils literal">gui</tt></a></h3>
<div class="section" id="for-classical-2d-applications">
<h4>For Classical 2D Applications</h4>
<div class="section" id="gui-backend">
<h5>GUI Backend</h5>
<p>This interface relied initially on <tt class="docutils literal">gs</tt> (now deprecated), now on <a class="reference external" href="http://erlang.org/doc/man/wx.html">wx</a> (a port of <a class="reference external" href="https://www.wxwidgets.org/">wxWidgets</a>), maybe later in HTML 5 <a class="footnote-reference" href="#id57" id="id56">[15]</a>. For the base dialogs, <a class="reference external" href="https://en.wikipedia.org/wiki/Zenity">Zenity</a> could have been an option.</p>
<p>If having very demanding 2D needs, one may refer to the <a class="reference internal" href="#d-services">3D services</a> section (as it is meant to be hardware-accelerated, and the 2D services are a special cases thereof).</p>
<table class="docutils footnote" frame="void" id="id57" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id56">[15]</a></td><td>Possibly relying some day for that on the <a class="reference external" href="http://nitrogenproject.com/">Nitrogen web framework</a>, on <a class="reference external" href="https://ws.n2o.dev/">N2O</a> or on any relevant HTML5 framework.</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal">gui</tt> does not adhere yet to the <tt class="docutils literal">ui</tt> conventions, but it will ultimately will. Currently it offers a graphical API on top of <tt class="docutils literal">wx</tt>.</p>
</div>
<p>As a consequence, <a class="reference external" href="https://www.wxwidgets.org/">wxWidgets</a> must be available on the host (otherwise a <tt class="docutils literal"><span class="pre">{load_driver,&quot;No</span> driver found&quot;}</tt> exception will be raised on GUI start). This should correspond to the <tt class="docutils literal">wxgtk3</tt> Arch Linux package, or the <tt class="docutils literal"><span class="pre">libwxgtk3.0-dev</span></tt> Debian one. This can be tested by executing <tt class="docutils literal"><span class="pre">wx-config</span> <span class="pre">--version</span></tt> on a shell.</p>
<p><tt class="docutils literal">wxWidgets</tt> must be installed <em>prior</em> to building Erlang, so that it is detected by its configuration script and a proper <tt class="docutils literal">wx</tt> module can be used afterwards. Running then <tt class="docutils literal">wx:demo()</tt> is a good test of the actual support.</p>
</div>
<div class="section" id="purpose-of-gui">
<h5>Purpose of <tt class="docutils literal">gui</tt></h5>
<p>The goal is to provide a small, lightweight API (including message types) that are higher-level than <tt class="docutils literal">wx</tt>, and do not depend on any particular GUI backend (such as <tt class="docutils literal">wx</tt>, <tt class="docutils literal">gs</tt>, etc.; so none of their includes, records, types or functions leak in the user realm), to avoid that user programs become obsolete too quickly because of the UI backend they rely on.</p>
<p>So for example the messages received by the user programs do not mention <tt class="docutils literal">wx</tt>, and respect only MyriadGUI conventions. These conventions are in line with the <a class="reference external" href="https://wooper.esperide.org/#method-invocation">WOOPER ones</a>, enabling (in a fully optional manner) the user code to rely on WOOPER if wanted.</p>
<p>The usual mode of operation is the following:</p>
<p><span class="raw-html"><center><img src="myriad-gui-mode-of-operation.png" id="responsive-image-medium"></img></center></span>
</p>
<ol class="arabic simple">
<li>From a user process (a test, an application, etc.), the GUI support is first started, with <tt class="docutils literal"><span class="pre">gui:start/{0,1}</span></tt></li>
<li>Then the various widgets (windows, frames, panels, buttons, etc.) are created (ex: thanks to <tt class="docutils literal">MainFrame = <span class="pre">gui:create_frame(...</span></tt>) and the user process subscribes to the events it is interested in (as a combination of an event type and a widget-as-an-event-emitter; for example:</li>
</ol>
<pre class="code erlang literal-block">
<span class="nn">gui</span><span class="p">:</span><span class="nf">subscribe_to_events</span><span class="p">({</span><span class="n">onWindowClosed</span><span class="p">,</span> <span class="nv">MainFrame</span><span class="p">}))</span>
</pre>
<ol class="arabic simple" start="3">
<li>The user process also triggers any relevant operation (ex: clearing widgets, setting various parameters), generally shows at least a main frame and records the GUI state that it needs for future use (typically containing at least the MyriadGUI references of the widgets that it created)</li>
<li>Then the user process enters its own (GUI-specific) main loop, from which it will receive the events that it subscribed to, and to which it will react by performing application-specific operations and/or GUI-related operations (creating, modifying, deleting widgets). Generally at least one condition is defined in order to leave that main loop and stop the GUI (<tt class="docutils literal">gui:stop/0</tt>)</li>
</ol>
<p>Such a scheme based on a &quot;man-in-the-middle&quot; (the MyriadGUI process) is necessary to abstract out for example the types of messages induced by a given GUI backend. If performances should not be an issue for user interaction, the integration must be carefully designed, notably because a 3-actor cooperation (user code, MyriadGUI one, backend one) opens the possibility of race conditions to occur (notably some operations, like event subscribing, must then be made synchronous, as the user process may trigger direct interactions with the backend; see implementation notes for more details).</p>
<p>Refer to the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/test/user-interface/graphical/gui_overall_test.erl">gui_overall_test.erl</a> and <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/test/user-interface/graphical/lorenz_test.erl">lorenz_test.erl</a> test full, executable usage examples thereof.</p>
<p>Here is a screenshot of the former test, where a random polygon (in green) is generated, for which are determined both the convex hull (in blue) and the MEC (<em>Minimum Enclosing Circle</em>, in purple):</p>
<p><span class="raw-html"><center><img src="myriad-minimal-enclosing-circle-test.png" id="responsive-image-medium"></img></center></span>
</p>
<p>Defining <tt class="docutils literal">gui</tt> as an interface between the user code and a backend also allows to enrich said backend <a class="footnote-reference" href="#id60" id="id59">[16]</a>.</p>
<table class="docutils footnote" frame="void" id="id60" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id59">[16]</a></td><td>For example, we needed to operate on a plain canvas, whereas <tt class="docutils literal">wx</tt> (as we understand it) offers only panels with bitmaps (with <tt class="docutils literal">wxDC</tt>, <tt class="docutils literal">wxWindowDC</tt>, <tt class="docutils literal">wxMemoryDC</tt>, etc.), with no possibility to subclass them in order to add them features. So MyriadGUI transparently introduced <tt class="docutils literal">gui_canvas</tt> to offer extended canvas services.</td></tr>
</tbody>
</table>
<p>These services are located in <tt class="docutils literal"><span class="pre">{src,test}/user-interface/graphical</span></tt> (see <tt class="docutils literal">gui.erl</tt>, <tt class="docutils literal">gui_color.erl</tt>, <tt class="docutils literal">gui_text.erl</tt>, <tt class="docutils literal">gui_canvas.erl</tt>, etc.), with a few tests (<tt class="docutils literal">gui_test.erl</tt>, <tt class="docutils literal">lorenz_test.erl</tt>) and will be enriched over time, on a per-need basis.</p>
<p id="lorenz-test">This last <tt class="docutils literal">lorenz_test.erl</tt> offers another complete example:</p>
<p><span class="raw-html"><center><img src="myriad-lorenz-test.png" id="responsive-image-full"></img></center></span>
</p>
<p>Related information of interest:</p>
<ul class="simple">
<li>if receiving errors about <tt class="docutils literal"><span class="pre">{badarg,&quot;This&quot;}</span></tt>, like in:</li>
</ul>
<pre class="code erlang literal-block">
<span class="p">{</span><span class="n">'_wxe_error_'</span><span class="p">,</span><span class="mi">710</span><span class="p">,{</span><span class="n">wxDC</span><span class="p">,</span><span class="n">setPen</span><span class="p">,</span><span class="mi">2</span><span class="p">},{</span><span class="n">badarg</span><span class="p">,</span><span class="s">&quot;This&quot;</span><span class="p">}}</span>
</pre>
<p>it is probably the sign that an attempt was done to perform an operation on an already-deallocated wx object</p>
<ul class="simple">
<li>wxErlang: <a class="reference external" href="https://arifishaq.files.wordpress.com/2017/12/wxerlang-getting-started.pdf">Getting started</a> and <a class="reference external" href="https://arifishaq.files.wordpress.com/2018/04/wxerlang-speeding-up.pdf">Speeding up</a>, by Arif Ishaq</li>
<li>Doug Edmunds' <a class="reference external" href="http://wxerlang.dougedmunds.com/">wxerlang workups</a></li>
</ul>
</div>
</div>
<div class="section" id="for-3d-applications">
<h4>For 3D Applications</h4>
<div class="section" id="id61">
<h5>Purpose</h5>
<p>In order to render 3D content, Myriad relies on <a class="reference external" href="https://en.wikipedia.org/wiki/OpenGL">OpenGL</a>, a standard, cross-platform, uniform and well-designed programming interface that enables the use of video cards in order to deport most of the (2D or 3D) heavy-lifting there.</p>
<p>Sophisticated 3D rendering is not necessarily an area where Erlang shines (perhaps, on the context of a client/server multimedia application, the client could rely on an engine like <a class="reference external" href="https://en.wikipedia.org/wiki/Godot_(game_engine)">Godot</a> instead), yet at least some level of rendering capabilities is convenient whenever performing 3D computations, implementing a server-side 3D logic, processing meshes, etc.</p>
</div>
<div class="section" id="id62">
<h5>Prerequisites</h5>
<p>So a prerequisite is that the local host enjoys at least some kind of <strong>OpenGL support</strong>, either in software or, preferably, with an hardware acceleration.</p>
<p id="opengl-troubleshooting">Just run our <tt class="docutils literal">gui_opengl_test.erl</tt> test to have the detected local configuration examined. One should refer to our HOWTO section <a class="reference external" href="http://howtos.esperide.org/ThreeDimensional.html#os-support">about 3D operating system support</a> for detailed information and troubleshooting guidelines.</p>
<p>As for the <strong>Erlang side</strong> of this OpenGL support, one may refer to <a class="reference external" href="https://www.erlang.org/doc/man/wxglcanvas#description">this section</a> to ensure that the Erlang build at hand has indeed its OpenGL support enabled.</p>
</div>
<div class="section" id="d-services">
<h5>3D Services</h5>
<div class="section" id="user-api">
<h6>User API</h6>
<p>The Myriad OpenGL utilities are defined in the <tt class="docutils literal">gui_opengl</tt> module; the many OpenGL defines are available when having included <tt class="docutils literal">gui_opengl.hrl</tt> (ex: as <tt class="docutils literal"><span class="pre">?GL_QUAD_STRIP</span></tt>).</p>
<p>These utilities directly relate to Myriad's <a class="reference internal" href="#spatial-services-and-conventions">spatial services and conventions</a> and to its support of the <a class="reference internal" href="#gltf-file-format">glTF file format</a>.</p>
<p>The <tt class="docutils literal">gui_opengl_test.erl</tt> offers a complete usage example.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Almost all OpenGL operations require that an OpenGL context already exists. When it is done, all GL/GLU operations can be done as usual.</p>
<p class="last">So the point of MyriadGUI here is mostly to create a suitable OpenGL context, offer a few additional, higher-level, stricter constructs to ease the integration and use, and to connect this rendering capability to the rest of the GUI (ex: regarding event management).</p>
</div>
</div>
<div class="section" id="configuration">
<h6>Configuration</h6>
<p>In terms of error management, extensive verifications will apply iff the <tt class="docutils literal">myriad_check_opengl_support</tt> flag is set.</p>
<p>Setting the <tt class="docutils literal">myriad_debug_opengl_support</tt> flag will result in more runtime information to be reported.</p>
</div>
<div class="section" id="internal-implementation">
<h6>Internal Implementation</h6>
<p>The MyriadGUI 2D/3D services rely on the related Erlang-native modules, namely <a class="reference external" href="https://www.erlang.org/doc/man/gl.html">gl</a> and <a class="reference external" href="https://www.erlang.org/doc/man/glu.html">glu</a>.</p>
<p>As for the <tt class="docutils literal">wx</tt> module (see the <a class="reference internal" href="#wx-availability">wx availability</a> section), it provides a convenient solution in order to create a suitable OpenGL context.</p>
<p id="sdl-based-solution"><a class="reference external" href="https://github.com/dgud/esdl">esdl</a> used to be another solution to obtain an OpenGL context; it may be revived some day, as <a class="reference external" href="https://www.libsdl.org/">SDL</a> - i.e. <em>Simple DirectMedia Layer</em> - is still striving, and offers a full (yet low-level) access to multimedia and input devices; not all applications may have use of the rest of <tt class="docutils literal">wx</tt>.</p>
<p>These Erlang-native services can be easily tested by running <tt class="docutils literal">wx:demo()</tt> from any Erlang shell and selecting then <tt class="docutils literal">gl</tt> in the left example menu.</p>
<p>These platform-specific / backend-specific (ex: wx or not, and which version thereof, ex: wxWidget 2.8 vs 3.0 API) services shall remain fully invisible from MyriadGUI user code, so that it remains sheltered for good from any change at their level.</p>
<p>The goal is to wrap only the dependencies that may change in the future (ex: wx); doing so for the ones considered (for good reasons) stable (such as gl or glu) would have no specific interest.</p>
</div>
</div>
</div>
<div class="section" id="for-multimedia-applications">
<span id="multimedia"></span><h4>For Multimedia Applications</h4>
<p>Currently we provide only very preliminary support thereof with <tt class="docutils literal">audio_utils</tt>; for sound and music playback, refer to the <a class="reference internal" href="#audio">audio</a> section for more details.</p>
<p id="speech-synthesis"><span id="tts"></span>Speech synthesis (TTS, <em>Text-to-Speech</em>) is available thanks to <tt class="docutils literal">speech_utils.erl</tt>. In practice, for best results, the actual speech generation is delegated to cloud-based providers making use of AI (neural voices) for best fluidity.</p>
<p>The input text shall preferably comply with <a class="reference external" href="https://en.wikipedia.org/wiki/Speech_Synthesis_Markup_Language">SSML</a>, typically so that it can be enriched with phonemes and prosody hints.</p>
<p>One can listen to this <a class="reference external" href="speech-test-fr-FR.ogg.opus">French speech</a> and this <a class="reference external" href="speech-test-en-US.ogg.opus">English one</a> (most browsers are now able to playback <a class="reference external" href="https://en.wikipedia.org/wiki/Opus_(audio_format)">Opus</a> content), that have been both generated by <tt class="docutils literal">speech_utils_test.erl</tt>.</p>
<p>Facilities to manage logical speeches (i.e. speeches designated by a base name such as <tt class="docutils literal">hello</tt> and declined in as many locales as needed) are available (see <tt class="docutils literal">speech_support:logical_speech/0</tt>), as well as for related containers (see <tt class="docutils literal">speech_support:speech_referential/0</tt>).</p>
</div>
<div class="section" id="for-interactive-applications">
<h4>For Interactive Applications</h4>
<p>Beyond the rendering of multimedia content, user interfaces have to <strong>collect inputs from the user</strong>, typically through mice, keyboards and joysticks.</p>
<p>Formerly, a port of <a class="reference external" href="https://www.libsdl.org/">SDL</a>, <a class="reference external" href="https://github.com/dgud/esdl">esdl</a>, was the best option, now using <tt class="docutils literal">wx</tt> for that is recommended, as, through this port, the various input devices can be managed (at least to a large extent).</p>
</div>
</div>
<div class="section" id="audio-user-interface">
<span id="audio"></span><h3><a class="toc-backref" href="#id144">Audio User Interface</a></h3>
<p>If the 2D/3D rendering can be done through <tt class="docutils literal">wx</tt>, apparently the <strong>audio capabilities</strong> (ex: <a class="reference external" href="https://docs.wxwidgets.org/3.0/group__group__class__media.html">[1]</a>, <a class="reference external" href="https://docs.wxwidgets.org/3.0/classwx_sound.html">[2]</a>) of wxWidgets have not been made available to Erlang.</p>
<p>So an Erlang program needing audio output (ex: sound special effects, musics) and/or input (ex: microphone) will have to rely on another option, possibly in link, for audio rendering, to 3D-ready <a class="reference external" href="https://github.com/edescourtis/eopenal">eopenal</a> - an (Erlang) binding of <a class="reference external" href="https://en.wikipedia.org/wiki/OpenAL">OpenAL</a>, or to a lower-level <a class="reference internal" href="#sdl-based-solution">SDL-based solution</a>. Contributions welcome!</p>
<p>Currently only very basic support for audio output is available, as <tt class="docutils literal"><span class="pre">audio_utils:playback_file/{2,3}</span></tt>.</p>
<p>See also our support for <a class="reference internal" href="#speech-synthesis">speech synthesis</a>.</p>
<p></p>
</div>
</div>
<div class="section" id="myriad-s-helper-shell-scripts">
<span id="helper-scripts"></span><h2><a class="toc-backref" href="#id145">Myriad's Helper Shell Scripts</a></h2>
<p>A small set of shell scripts has been defined, in <tt class="docutils literal">myriad/src/scripts</tt>, to provide generic facilities useful in the context of Myriad <a class="footnote-reference" href="#id69" id="id68">[17]</a>.</p>
<table class="docutils footnote" frame="void" id="id69" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id68">[17]</a></td><td>For a more general collection of (different) scripts, one may refer to <a class="reference external" href="http://hull.esperide.org">Ceylan-Hull</a>, notably the <a class="reference external" href="http://hull.esperide.org/#for-development">ones to facilitate development</a>.</td></tr>
</tbody>
</table>
<div class="section" id="erlang-dedicated-scripts">
<h3><a class="toc-backref" href="#id146">Erlang-Dedicated Scripts</a></h3>
<div class="section" id="searching-for-erlang-elements">
<h4>Searching for Erlang elements</h4>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/ergrep">ergrep</a></dt>
<dd><p class="first">To search for a text pattern through an Erlang source tree.</p>
<div class="line-block">
<div class="line">Usage: ergrep [-v|--verbose] [-q|--quiet] [-f|--filenames-only] [-i|--insensitive] &lt;Expression to be found in sources&gt; [TARGET_BASE_DIR]: recursive grep in Erlang source files, either from the TARGET_BASE_DIR directory, if specified, otherwise from the current directory.</div>
</div>
<div class="last line-block">
<div class="line">Options:</div>
<div class="line">-v or --verbose: be specifically verbose</div>
<div class="line">-q or --quiet: be specifically quiet, just listing matches</div>
<div class="line">-f or --filenames-only: display only filenames, not also the matched patterns, and if there are multiple matches in the same file, its filename will be output only once (implies quiet); useful for scripts</div>
<div class="line">-i or --insensitive: perform case-insensitive searches in the content of files, and also in the searched Erlang filenames</div>
<div class="line-block">
<div class="line">Example: ergrep -i 'list_to_form(' /tmp</div>
</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/find-type-definition.sh">find-type-definition.sh</a></dt>
<dd><p class="first">To search for the definition of a type of interest.</p>
<div class="last line-block">
<div class="line">Usage: find-type-definition.sh [-h|--help] A_TYPE [A_DIR]: attempts to find the definition of the specified Erlang type from the specified directory (if any), otherwise from the current one.</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/find-function-specification.sh">find-function-specification.sh</a></dt>
<dd><p class="first">To search for a function spec of interest.</p>
<div class="last line-block">
<div class="line">Usage: find-function-specification.sh [-h|--help] A_FUNCTION_NAME [A_DIR]: attempts to find the type specification for the specified Erlang function (even if the name is partial and/or includes an arity) from the specified directory (if any), otherwise from the current one.</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/find-record-definition.sh">find-record-definition.sh</a></dt>
<dd><p class="first">To search for the definition of a record of interest.</p>
<div class="last line-block">
<div class="line">Usage: find-record-definition.sh [-h|--help] A_RECORD_NAME [A_DIR]: attempts to find the definition of the specified Erlang record from the specified directory (if any), otherwise from the current one.</div>
</div>
</dd>
</dl>
</div>
<div class="section" id="regarding-typing">
<h4>Regarding Typing</h4>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/list-available-types.sh">list-available-types.sh</a></dt>
<dd><p class="first">Lists all Erlang types found in specified tree.</p>
<div class="last line-block">
<div class="line">Usage: list-available-types.sh [-h|--help] [ROOT_DIR]: lists all types (according to Erlang type specifications) defined from the ROOT_DIR directory (if specified) or from the current directory.</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/add-deduced-type-specs.escript">add-deduced-type-specs.escript</a></dt>
<dd><p class="first">Generates and adds the type specification of all functions in specified module(s).</p>
<div class="line-block">
<div class="line">Usage: add-deduced-type-specs.escript FS_ELEMENT</div>
</div>
<div class="line-block">
<div class="line">Adds, for each selected BEAM file (either specified directly as a file, or found recursively from a specified directory), in the corresponding source file(s), for each function, the type specification that could be deduced from its current implementation.</div>
</div>
<div class="last line-block">
<div class="line">FS_ELEMENT is either the path of a BEAM file or a directory that will be scanned recursively for BEAM files.</div>
<div class="line">Note that BEAM files must be already compiled, and with debug information (see the '+debug_info' compile flag).</div>
<div class="line">Note also that generating type specs this way may not a good practice.</div>
</div>
</dd>
</dl>
</div>
<div class="section" id="regarding-basic-performance-measurement">
<h4>Regarding Basic Performance Measurement</h4>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/etop.sh">etop.sh</a></dt>
<dd><p class="first">Monitors on the console the busiest Erlang processes of a VM.</p>
<div class="last line-block">
<div class="line">Usage: etop.sh [-node NODE_NAME] [-setcookie COOKIE]: shows on the console the activity of the Erlang processes on specified Erlang node (enter CTRL-C twice to exit).</div>
<div class="line">Example: etop.sh -node <a class="reference external" href="mailto:foobar&#37;&#52;&#48;baz&#46;org">foobar<span>&#64;</span>baz<span>&#46;</span>org</a> -setcookie 'my cookie'</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/benchmark-command.escript">benchmark-command.escript</a></dt>
<dd><p class="first">Returns a mean resource consumption for the specified shell command (one may prefer relying on <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Hull/blob/master/benchmark-command.sh">benchmark-command.sh</a>).</p>
<div class="line-block">
<div class="line">Usage: benchmark-command.escript COMMAND: returns a mean resource consumption for the specified shell command.</div>
</div>
<p class="last">Example: benchmark-command.escript &quot;my_script.sh 1 2&quot;</p>
</dd>
</dl>
</div>
<div class="section" id="miscellaneous">
<h4>Miscellaneous</h4>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/make-code-stats.sh">make-code-stats.sh</a></dt>
<dd><p class="first">Outputs basic statistics about an Erlang code base.</p>
<div class="last line-block">
<div class="line">Usage: make-code-stats.sh [-h|--help] [SOURCE_DIRECTORY]: evaluates various simple metrics of the Erlang code found from any specified root directory, otherwise from the current one.</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/launch-erl.sh">launch-erl.sh</a></dt>
<dd><p class="first">The only shell script on which we rely in order to launch an Erlang VM.</p>
<div class="line-block">
<div class="line">Usage: launch-erl.sh [-v] [-c a_cookie] [--sn a_short_node_name | --ln a_long_node_name | --nn an_ignored_node_name ] [--tcp-range min_port max_port] [--epmd-port new_port] [--fqdn a_fqdn] [--max-process-count max_count] [--busy-limit kb_size] [--async-thread-count thread_count] [--background] [--non-interactive] [--eval an_expression] [--no-auto-start] [-h|--help] [--beam-dir a_path] [--beam-paths path_1 path_2] [-start-verbatim-options [...]]: launches the Erlang interpreter with specified settings.</div>
</div>
<div class="line-block">
<div class="line">Detailed options:</div>
<div class="line-block">
<div class="line">-v: be verbose</div>
<div class="line">-c a_cookie: specify a cookie, otherwise no cookie will be specifically set</div>
<div class="line">--sn a_short_node_name: distributed node using specified short name (ex: 'my_short_name')</div>
<div class="line">--ln a_long_node_name: distributed node using specified long name (ex: 'my_long_name')</div>
<div class="line">--nn an_ignored_node_name: non-distributed node, specified name ignored (useful to just switch the naming options)</div>
<div class="line">--tcp-range min_port max_port: specify a TCP port range for inter-node communication (useful for firewalling issues)</div>
<div class="line">--epmd-port new_port: specify a specific EPMD port (default: 4369); only relevant if the VM is to be distributed (using short or long names), initially or at runtime</div>
<div class="line">--fqdn a_fqdn: specify the FQDN to be used</div>
<div class="line">--max-process-count max_count: specify the maximum number of processes per VM (default: 400000)</div>
<div class="line">--busy-limit size: specify the distribution buffer busy limit, in kB (default: 1024)</div>
<div class="line">--async-thread-count thread_count: specify the number of asynchronous threads for driver calls (default: 128)</div>
<div class="line">--background: run the launched interpreter in the background (ideal to run as a daemon, ex: on a server)</div>
<div class="line">--daemon: run the node as a daemon (relies on run_erl and implies --background)</div>
<div class="line">--non-interactive: run the launched interpreter with no shell nor input reading (ideal to run through a job manager, ex: on a cluster)</div>
<div class="line">--eval 'an Erlang expression': start by evaluating this expression</div>
<div class="line">--no-auto-start: disable the automatic execution at VM start-up</div>
<div class="line">-h or --help: display this help</div>
<div class="line">--beam-dir a_path: adds specified directory to the path searched for beam files (multiple --beam-dir options can be specified)</div>
<div class="line">--beam-paths first_path second_path ...: adds specified directories to the path searched for beam files (multiple paths can be specified; must be the last option)</div>
<div class="line">--log-dir: specify the directory in which the VM logs (if using run_erl) shall be written</div>
</div>
</div>
<div class="line-block">
<div class="line">Other options will be passed 'as are' to the interpreter with a warning, except if they are listed after a '-start-verbatim-options' option, in which case they will passed with no warning.</div>
</div>
<div class="line-block">
<div class="line">If neither '--sn' nor '--ln' is specified, then the node will not be a distributed one.</div>
</div>
<div class="last line-block">
<div class="line">Example: launch-erl.sh -v --ln ceylan --eval 'class_TimeManager_test:run()'</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/show-xml-file.escript">show-xml-file.escript</a></dt>
<dd><p class="first">Displays the content of the specified XML file.</p>
<div class="last line-block">
<div class="line">Usage: show_xml_file.escript XML_FILE_PATH</div>
<div class="line">Displays sequentially in a {name,Value} tree the structure of specified XML file (XML elements along with their XML attributes).</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="more-general-scripts">
<h3><a class="toc-backref" href="#id147">More General Scripts</a></h3>
<div class="section" id="to-generate-documentation">
<h4>To generate documentation</h4>
<p>These scripts are mostly unrelated to Erlang, yet are useful to be available from our most basic layer (Myriad).</p>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/generate-docutils.sh">generate-docutils.sh</a></dt>
<dd><p class="first">Generates a proper PDF and/or HTML file from specified RST (<a class="reference external" href="https://en.wikipedia.org/wiki/ReStructuredText">reStructuredText</a>) one (main, standalone script).</p>
<div class="line-block">
<div class="line">Usage: generate-docutils.sh &lt;target rst file&gt; [--pdf|--all|&lt;comma-separated path(s) to CSS file to be used, ex: common/css/XXX.css,other.css&gt;] [--icon-file ICON_FILENAME]</div>
</div>
<div class="line-block">
<div class="line">Generates a final document from  specified docutils source file (<a href="#id70"><span class="problematic" id="id71">*</span></a>.rst).</div>
</div>
<div class="last line-block">
<div class="line">If '--pdf' is specified, a PDF will be created, if '--all' is specified, all output formats (i.e. HTML and PDF) will be created, otherwise HTML files only will be generated, using any specified CSS file.</div>
</div>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/generate-pdf-from-rst.sh">generate-pdf-from-rst.sh</a></dt>
<dd><p class="first">Generates a proper PDF and/or HTML file from specified RST (<a class="reference external" href="https://en.wikipedia.org/wiki/ReStructuredText">reStructuredText</a>) one; the previous <tt class="docutils literal"><span class="pre">generate-docutils.sh</span></tt> script is often preferred to this one, which depends on Myriad.</p>
<div class="line-block">
<div class="line">Usage: generate-pdf-from-rst.sh RST_FILE: generates a PDF file from the specified RST file, overwriting any past file with that name.</div>
</div>
<div class="last line-block">
<div class="line">Ex: 'generate-pdf-from-rst.sh my_file.rst' will attempt to generate a new 'my_file.pdf' file.</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="script-based-apps">
<h3><a class="toc-backref" href="#id148">Script-based Apps</a></h3>
<p>These shell scripts are actually user-facing shell interfaces that plug directly on some more involved Erlang programs, i.e. applications that are <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/tree/master/src/apps">available here</a>.</p>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/apps/generate-password/generate-password.sh">generate-password.sh</a></dt>
<dd><p class="first">Generates a proper random password respecting various rules, whose simple application can be transparently checked (probably at least more easily audited than most password managers - thus maybe more trustable).</p>
<div class="line-block">
<div class="line">Usage: generate-password.escript [-a ALPHABET|--alphabet ALPHABET]</div>
<div class="line-block">
<div class="line">[-l MIN_LEN MAX_LEN|--length MIN_LEN MAX_LEN] [-h|--help]</div>
</div>
</div>
<div class="line-block">
<div class="line">Generates a suitable password, where:</div>
<div class="line">- ALPHABET designates the set of characters to draw from (default one being 'extended'), among:</div>
<div class="line-block">
<div class="line">* 'base': alphanumeric letters, all cases [A-Za-z0-9]</div>
<div class="line">* 'extended': 'base' + basic punctuation (i.e. '[](){}:,;-_.!?')</div>
<div class="line">* 'full': 'base' + all punctuation (i.e. basic + '&quot;'&#64; /&amp;$*^%=+|')</div>
</div>
<div class="line">- MIN_LEN and MAX_LEN are the respective minimum and maximum numbers of characters</div>
<div class="line">(bounds included) used to generate this password [default: between 15 and 20]</div>
</div>
<p class="last">See also: the <a class="reference external" href="https://hull.esperide.org/#for-security">security section</a> of Ceylan-Hull, for more general guidelines and tooling regarding the proper management of credentials.</p>
</dd>
<dt><a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/apps/merge-tool/merge.sh">merge.sh</a></dt>
<dd><p class="first">Helps merging efficiently and reliably file trees; it is actually a rather involved text-based application that allows scanning/comparing/merging trees, typically in order to deduplicate file hierarchies that were cloned once yet may have since then diverged.</p>
<div class="line-block">
<div class="line">Usage: following operations can be triggered:</div>
<div class="line-block">
<div class="line">- 'merge.sh --input INPUT_TREE --reference REFERENCE_TREE'</div>
<div class="line">- 'merge.sh --scan A_TREE'</div>
<div class="line">- 'merge.sh --rescan A_TREE'</div>
<div class="line">- 'merge.sh --resync A_TREE'</div>
<div class="line">- 'merge.sh --uniquify A_TREE'</div>
<div class="line">- 'merge.sh -h' or 'merge.sh --help'</div>
</div>
</div>
<div class="line-block">
<div class="line">Ensures, for the first form, that all the changes in a possibly more up-to-date, &quot;newer&quot; tree (INPUT_TREE) are merged back</div>
<div class="line">to the reference tree (REFERENCE_TREE), from which the first tree may have derived. Once executed, only a refreshed,</div>
<div class="line">complemented reference tree will exist, as the input tree will have been removed: all its original content (i.e. its content</div>
<div class="line">that was not already in the reference tree) will have been transferred in the reference tree.</div>
<div class="line-block">
<div class="line">In the reference tree, in-tree duplicated content will be either kept as it is, or removed as a whole (to keep only one</div>
</div>
<div class="line">copy thereof), or replaced by symbolic links in order to keep only a single reference version of each actual content.</div>
<div class="line-block">
<div class="line">At the root of the reference tree, a '.merge-tree.cache' file will be stored, in order to avoid any later recomputations of</div>
</div>
<div class="line">the checksums of the files that it contains, should they have not changed. As a result, once a merge is done, the reference</div>
<div class="line">tree may contain an uniquified version of the union of the two specified trees, and the input tree will not exist anymore</div>
<div class="line">after the merge.</div>
<div class="line"><br /></div>
<div class="line-block">
<div class="line">For the second form (--scan option), the specified tree will simply be inspected for duplicates, and a corresponding</div>
</div>
<div class="line">'.merge-tree.cache' file will be created at its root (to be potentially reused by a later operation).</div>
</div>
<div class="line-block">
<div class="line-block">
<div class="line">For the third form (--rescan option), an attempt to rebuild an updated '.merge-tree.cache' file will be performed,</div>
</div>
<div class="line">computing only the checksum of the files that were not already referenced, or whose timestamp or size changed.</div>
</div>
<div class="line-block">
<div class="line-block">
<div class="line">For the fourth form (--resync option), a rebuild even lighter than the previous rescan of '.merge-tree.cache' will be done,</div>
</div>
<div class="line">checking only sizes (not timestamps), and updating these timestamps.</div>
</div>
<div class="line-block">
<div class="line">For the fifth form (--uniquify option), the specified tree will be scanned first (see the corresponding operation), and</div>
</div>
<div class="line-block">
<div class="line">For the fifth form (--uniquify option), the specified tree will be scanned first (see the corresponding operation), and</div>
<div class="line">then the user will be offered various actions regarding found duplicates (being kept as are, or removed, or replaced with</div>
<div class="line">symbolic links), and once done a corresponding up-to-date '.merge-tree.cache' file will be created at its root (to be</div>
<div class="line">potentially reused by a later operation).</div>
<div class="line"><br /></div>
<div class="line-block">
<div class="line">For the sixth form (-h or --help option), displays this help.</div>
<div class="line"><br /></div>
<div class="line">Note that the --base-dir A_BASE_DIR option can be specified by the user to designate the base directory of all relative</div>
</div>
<div class="line">paths mentioned. When a cache file is found, it can be either ignored (and thus recreated) or re-used, either as it is or</div>
<div class="line">after a weak check, where only file existence, sizes and timestamps are then verified (not checksums).</div>
</div>
<p class="last">See also: the <tt class="docutils literal"><span class="pre">test-all</span></tt> target of the merge-related <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/apps/merge-tool/GNUmakefile">makefile</a>, to give it a try before applying such procedure to your data of interest.</p>
</dd>
</dl>
<p></p>
</div>
</div>
<div class="section" id="utility-toolbox">
<span id="toolbox"></span><h2><a class="toc-backref" href="#id149">Utility Toolbox</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This part is the <strong>actual core</strong> of the <tt class="docutils literal"><span class="pre">Ceylan-Myriad</span></tt> library: a toolbox comprising many helper functions (with their tests), defined in the <tt class="docutils literal"><span class="pre">myriad/src/{utils,data-management}</span></tt> directories, often providing richer, enhanced, more specialised services compared to the ones offered by the Erlang standard libraries.</p>
</div>
<p>These helpers (code and typing information) are thematically aggregated in modules that are generally suffixed by <tt class="docutils literal">_utils</tt> (for a more collection of helpers) or <tt class="docutils literal">_support</tt> (for a service deserving more integration), and include:</p>
<ul class="simple">
<li>many <strong>basic, general-purpose services</strong>, defined in <tt class="docutils literal">basic_utils.erl</tt>, regarding:<ul>
<li>the base types we defined</li>
<li>notifications</li>
<li>message handling</li>
<li>many miscellaneous functions</li>
</ul>
</li>
</ul>
<ul class="simple">
<li>functions to manage Erlang <strong>compiled BEAM code</strong> (<tt class="docutils literal">code_utils.erl</tt>)</li>
<li>services to manage the <strong>execution of other programs</strong> (<tt class="docutils literal">executable_utils.erl</tt>), to:<ul>
<li>locate said executables</li>
<li>to execute functional services (ex: display a PDF) regardless of the actual executable involved</li>
</ul>
</li>
<li>a few <strong>test-related facilities</strong>, in <tt class="docutils literal">test_facilities.erl</tt></li>
<li>services to handle more easily the (UNIX) shells and also the command-line arguments (a bit like <tt class="docutils literal">getopt</tt>), regardless of the interpreter or escript context (<tt class="docutils literal">shell_utils.erl</tt>)</li>
<li>helpers for <strong>file-based</strong> I/O operations (<tt class="docutils literal">file_utils.erl</tt>); note that we now recommend not to open files with a specific encoding being set, but instead to encode the content before any writing thereof; refer to the <tt class="docutils literal">Regarding encodings and Unicode</tt> section in <tt class="docutils literal">file_utils.erl</tt> for further information</li>
<li>services to manage identifiers of various sorts, including sortable ones (<tt class="docutils literal">id_utils.erl</tt>)</li>
<li>a very basic support of <strong>Finite State Machines</strong> (<tt class="docutils literal"><span class="pre">fsm_utils.{e,h}rl</span></tt>)</li>
<li>a few operations defined on <strong>graphs</strong> (<tt class="docutils literal">graph_utils.erl</tt>, with <tt class="docutils literal"><span class="pre">find_breadth_first/{3,4}</span></tt>)</li>
</ul>
<ul class="simple">
<li>support for <strong>network</strong>-related concerns (<tt class="docutils literal"><span class="pre">net_utils.erl.{e,h}rl</span></tt>)</li>
<li>services to offer <strong>randomness</strong> (<tt class="docutils literal">random_utils.erl</tt>), with regard to various sources (the Erlang built-in algorithm, <tt class="docutils literal">crypto</tt>, newer ones like <tt class="docutils literal">exsplus</tt> - our current default, <tt class="docutils literal">exs64</tt> and <tt class="docutils literal">exs1024</tt>), for seeding, drawing, etc.</li>
<li>very little support of <strong>RDF</strong> operations, standing for <a class="reference external" href="https://en.wikipedia.org/wiki/Resource_Description_Framework">Resource Description Framework</a> (<tt class="docutils literal">rdf_utils.erl</tt>)</li>
<li>support for <strong>XML</strong> (<tt class="docutils literal"><span class="pre">xml_utils.{e,h}rl</span></tt>, based on built-in <tt class="docutils literal">xmerl</tt>), for parsing and generation</li>
<li>facilities to handle content to the web, to HTTP, etc. (<tt class="docutils literal">web_utils.erl</tt>) and to perform <strong>REST calls</strong> (<tt class="docutils literal">rest_utils.erl</tt>), using built-in <tt class="docutils literal">httpc</tt> and <tt class="docutils literal">http_client</tt> (including JSON services mentioned below)</li>
<li>elements for the sending of <strong>SMS</strong> (<tt class="docutils literal">sms_utils.erl</tt>), based either on third-party providers providing REST APIs, or via a mobile phone (typically connected thanks to a USB cable); nothing as advanced as <a class="reference external" href="http://mobile.esperide.org/">Ceylan-Mobile</a>, though</li>
<li>support for operations at the <strong>operating-system</strong> level (<tt class="docutils literal"><span class="pre">system_utils.{e,h}rl</span></tt>)</li>
<li>services to handle <strong>text</strong> (<tt class="docutils literal">text_utils.erl</tt>)</li>
</ul>
<ul class="simple">
<li>functions to manage <strong>time</strong> information (<tt class="docutils literal">time_utils.erl</tt>)</li>
<li>a few helpers to ease the writing of <a class="reference external" href="http://erlang.org/doc/man/escript.html">escripts</a> relying on the Myriad layer (<tt class="docutils literal">script_utils.erl</tt>)</li>
<li>services addressed to the use of OTP, in <tt class="docutils literal">otp_utils.erl</tt>, allowing notably to run OTP applications out of an OTP context (typically through our native build/run system rather than through rebar3 and even OTP releases)</li>
<li>services about all kinds of <strong>units</strong> (<tt class="docutils literal">unit_utils.erl</tt>); refer to the <a class="reference internal" href="#management-of-units">Management of Units</a> section below for more information</li>
<li>basic services for <strong>trace emission</strong> (a.k.a logging - not related to Erlang tracing), either directly through <tt class="docutils literal">trace_utils.erl</tt>, or thanks to <tt class="docutils literal">trace_bridge.erl</tt> - typically to rely on more advanced trace systems such as <a class="reference external" href="http://traces.esperide.org/">Ceylan-Traces</a>; now compliant with newer OTP logger and Syslog protocol as defined in <a class="reference external" href="https://www.ietf.org/rfc/rfc5424.txt">RFC 5424</a>, collecting bother userland traces and VM-level logs</li>
<li>very basic facilities for <strong>applications</strong> (not in the sense of OTP ones), in <tt class="docutils literal"><span class="pre">app_facilities.{e,h}rl</span></tt> with an example (<tt class="docutils literal">most_basic_example_app.erl</tt>)</li>
</ul>
<ul class="simple" id="user-preferences">
<li>a basic support for <strong>user-defined preferences</strong>; this service relies on our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/data-management/preferences.erl">preferences</a> module to make available any user preferences expressed in the <a class="reference external" href="#etf">ETF format</a>, and typically defined in a <tt class="docutils literal"><span class="pre">~/.ceylan-settings.etf</span></tt> file (possibly a symlink pointing to an actual file in VCS)</li>
<li>a bit of <strong>locale management</strong>, in <tt class="docutils literal">locale_utils.erl</tt></li>
<li>minor services about the <strong>monitoring of Erlang processes</strong>, in <tt class="docutils literal">monitor_utils.erl</tt> and their <strong>registering</strong> in naming services, in <tt class="docutils literal">naming_utils.erl</tt></li>
<li>facilities to better <strong>interface Erlang to other languages</strong>, in <tt class="docutils literal">language_utils.erl</tt> and <tt class="docutils literal">{python,java}_utils.erl</tt>; nothing as advanced as <a class="reference external" href="http://seaplus.esperide.org/">Ceylan-Seaplus</a>, though</li>
</ul>
<p></p>
</div>
<div class="section" id="support-for-metaprogramming">
<span id="metaprogramming"></span><h2><a class="toc-backref" href="#id150">Support for Metaprogramming</a></h2>
<p>Over time, quite a lot of developments grew to form primitives that manage ASTs (<em>Astract Syntax Trees</em>), based on Erlang's parse transforms.</p>
<p>These developments are gathered in the <tt class="docutils literal">src/meta</tt> directory, providing notably:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">meta_utils.{e,h}rl</span></tt>: basic primitives to <strong>transform ASTs</strong>, with a bit of testing (<tt class="docutils literal">meta_utils_test</tt>)</li>
<li><tt class="docutils literal">type_utils</tt>: a still rather basic toolbox to <strong>manage data types</strong> - whether built-in, compound or parametrised (expressed as strings, as terms, etc.)</li>
<li><tt class="docutils literal">ast_*</tt> modules to handle the various <strong>elements that can be found in an AST</strong> (ex: <tt class="docutils literal">ast_expression</tt>, <tt class="docutils literal">ast_type</tt>, <tt class="docutils literal">ast_pattern</tt>, etc.)</li>
</ul>
<p>Finally, a few usage examples of these facilities are:</p>
<ul class="simple">
<li><tt class="docutils literal">minimal_parse_transform_test</tt>: the simplest parse transform test that we use, typically operating on <tt class="docutils literal">simple_parse_transform_target</tt></li>
<li><tt class="docutils literal">example_parse_transform</tt>: a rather minimal parse transform</li>
<li><tt class="docutils literal">myriad_parse_transform</tt>: the parse transform used within <tt class="docutils literal">Myriad</tt>, transforming each and every module of that layer (and of at least some modules of upper layers)</li>
</ul>
<p>So the purpose of this parse transform is to <strong>convert ASTs that are Myriad-compliant into ASTs that are directly Erlang compliant</strong>.</p>
<p id="table-transformations">For that, following changes are operated:</p>
<ul class="simple">
<li>in type specifications, the Myriad-specific <tt class="docutils literal">void/0</tt>, <tt class="docutils literal">maybe/1</tt> and <tt class="docutils literal"><span class="pre">fallible/{1,2}</span></tt> types are adequately translated:<ul>
<li><tt class="docutils literal">void()</tt> becomes <tt class="docutils literal">basic_utils:void()</tt>, a type alias of <tt class="docutils literal">any()</tt>, made to denote returned terms that are not expected to be used by the caller (as if that function's only purpose was its side-effects)</li>
<li><tt class="docutils literal">maybe(T)</tt> becomes the type union <tt class="docutils literal"><span class="pre">'undefined'|T</span></tt></li>
<li><tt class="docutils literal">fallible(T)</tt> becomes ultimately the type union <tt class="docutils literal"><span class="pre">{'ok',T}|{'error',term()}</span></tt>, while <tt class="docutils literal">fallible(Tok, Terror)</tt> becomes <tt class="docutils literal"><span class="pre">{'ok',Tok}|{'error',Terror}</span></tt></li>
</ul>
</li>
<li>both in type specifications and actual code, <tt class="docutils literal">table/2</tt>, the Myriad-specific associative table pseudo-type, is translated into an actual <a class="reference internal" href="#table-type">table type</a></li>
<li>the <tt class="docutils literal">const_table</tt> module allows to generate sharable, read-only associative tables probably in the most efficient way in Erlang (refer to the <a class="reference internal" href="#const-table">const table</a> section for further information)</li>
<li>the <tt class="docutils literal">cond_utils</tt> services drive conditional code injection: based on the build-time tokens defined, their values can be used to perform compilation-time operations such as <strong>if</strong> (see in this module <tt class="docutils literal">if_debug/1</tt>, <tt class="docutils literal"><span class="pre">if_defined/{2,3}</span></tt>, <tt class="docutils literal"><span class="pre">if_set_to/{3,4}</span></tt>), <strong>switch</strong> (see <tt class="docutils literal"><span class="pre">switch_set_to/{2,3}</span></tt>, possibly with a default clause) or <strong>assert</strong> (<tt class="docutils literal"><span class="pre">assert/{1,2,3}</span></tt>); if useful, it should be fairly easy (infrastructure mostly ready) to transform the (currently constant) user-defined build tokens into mutable variables and to add for example compile-time assignments (<tt class="docutils literal">cond_utils:create_token(TOKEN, MAYBE_INITIAL_VALUE)</tt>, <tt class="docutils literal">cond_utils:set_token_value(TOKEN, VALUE)</tt> and <tt class="docutils literal">cond_utils:remove_token(TOKEN, MAYBE_INITIAL_VALUE)</tt>) of these variables and loops (<strong>for</strong>, <strong>while</strong>, etc.) if not going for a Turing-complete language, if ever that made sense for some uses; see the <a class="reference internal" href="#support-for-code-injection">Support for Code Injection</a> for additional usage details regarding the supported primitives</li>
</ul>
<p>More generally, Myriad offers the support to traverse <em>any</em> AST (the whole Erlang grammar is supported, in its abstract form) and to <strong>transform</strong> it (ex: an expression being removed, transformed or replaced by other expressions), with the ability for the user to define his own type/call replacement mappings, or more general transformation functions to be triggered when specified elements are found in the AST (ex: remote calls with relevant MFA).</p>
<p>The traversal may be done in a stateful manner, i.e. any user-defined transformation will be able to access (read/write) any state of its own in the course of the traversal.</p>
<p>As a result, a single pass through the input AST may be done, in which any kind of transformations may be applied, resulting in another (Erlang-compliant) AST being output and afterwards compiled.</p>
<p></p>
</div>
<div class="section" id="spatial-support">
<span id="spatial-services-and-conventions"></span><span id="spatial"></span><h2><a class="toc-backref" href="#id151">Spatial Support</a></h2>
<div class="section" id="motivation">
<h3><a class="toc-backref" href="#id152">Motivation</a></h3>
<p>The purpose of this section is to describe the facilities offered by Myriad in terms of <strong>spatial operations</strong>, notably for 2D, 3D and 4D support.</p>
<p>We introduced these elements mostly for convenience, to have them readily available in a simple, controllable form, in pure Erlang, easy to enrich and without involving extra dependencies.</p>
<p>This support is not expected to be specifically complete, battle-tested or efficient. If looking for such traits, one may consider:</p>
<ul class="simple">
<li>the elements already available directly in Erlang, notably the <a class="reference external" href="https://erlang.org/doc/man/gl.html">gl</a> module, providing for example primitives to <a class="reference external" href="https://erlang.org/doc/man/gl.html#loadTransposeMatrixd-1">load OpenGL matrices</a> and operate on them</li>
<li>in the Erlang community: <a class="reference external" href="http://www.wings3d.com/">Wings 3D</a>, an open-source modeller <a class="reference external" href="https://github.com/dgud/wings/tree/master/src">whose sources</a> of course implement many spatial operations</li>
<li>integrating advanced, non-Erlang libraries such as ones for linear operations implementing the <a class="reference external" href="https://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">BLAS</a> specification; using the C binding (<em>CBLAS interface</em>) of a renown implementation (optimised at length and making use of processor-specific extensions), such as <a class="reference external" href="https://en.wikipedia.org/wiki/LAPACK">LAPACK</a> and making it available to Erlang typically thanks to either NIFs (most suitable approach here) or a C-node (possibly thanks to <a class="reference external" href="http://seaplus.esperide.org">Ceylan-Seaplus</a>) would certainly be an option - all the more relevant that a bulk of linear operations could be offset as a whole to it; some Erlang projects target similar objectives, like <a class="reference external" href="https://github.com/sklassen/erlang-linalg-native">linalg</a> or <a class="reference external" href="https://github.com/versilov/matrex">matrex</a>; more generally the services implemented by a library such as <a class="reference external" href="https://www.gnu.org/software/gsl/">GSL</a> (the <em>GNU Scientific Library</em>) could, thanks to a third-party project, become available to Erlang programs</li>
</ul>
<p>In order to check the functional services and the correctness of operations, we recommend the use of <a class="reference external" href="https://www.scilab.org/">Scilab</a> (example on Arch: <tt class="docutils literal">yay <span class="pre">-Sy</span> scilab</tt>) or <a class="reference external" href="https://www.gnu.org/software/octave/">GNU Octave</a> (example on Arch: <tt class="docutils literal">pacman <span class="pre">-Sy</span> octave</tt>). Beware to the lower-precision of their textual outputs (ex: use <tt class="docutils literal">format long</tt> with Octave to request 15 significant figures), and to the extra packages that may needed (ex: <tt class="docutils literal"><span class="pre">octave-quaternion</span></tt>, available in the AUR).</p>
</div>
<div class="section" id="conventions">
<h3><a class="toc-backref" href="#id153">Conventions</a></h3>
<div class="section" id="linear-conventions">
<h4>Linear Conventions</h4>
<p>Dimensions are non-null (a zero dimension has little interest). Dimension 1 corresponds to scalar and is not special-cased (hence one shall preferably use directly scalars if able to determine that being in a single dimension context).</p>
<p>A linear-related <strong>index</strong> (ex: of a coordinate of a point, a vector or a matrix) starts at <tt class="docutils literal">1</tt> (not 0), as by default all <a class="reference internal" href="#indices">indices</a> in Myriad.</p>
<p><strong>Points</strong> are to be specified by the user as <em>tuples</em> (preferably to lists) whose coordinates are either integer ones (for example <span class="formula"><i>P</i> = <span class="environment"><span class="arrayrow">
<span class="arraycell align-l">
10
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
45
</span>

</span>
</span></span> translating to <tt class="docutils literal"><span class="pre">P={10,45}</span></tt>, typically for GUI-related processing of on-screen coordinates) or floating-point ones (<tt class="docutils literal">{0.0, <span class="pre">-1.0,</span> 0.0}</tt> for a point in 3D space). This is the most natural term mapping, and their internal representation is an homogeneous tuple (i.e. whose elements are all of the corresponding type): either <tt class="docutils literal">integer_point/0</tt> or <tt class="docutils literal">point/0</tt>.</p>
<p>The vast majority of the linear operations can be carried by modules operating either on:</p>
<ul class="simple">
<li><strong>arbitrary</strong> dimensions (as high as needed, and freely chosen by the user, at compile-time or runtime)</li>
<li><strong>specialised</strong> dimensions, namely 2D, 3D or 4D; their interest lies in efficiency (these specialised constructs are designed to induce less computing and smaller memory footprints) and in the definition of dimension-specific operators (ex: the cross-products in 3D)</li>
</ul>
<p>Points can therefore be of arbitrary dimension (then they are taken in charge by the <tt class="docutils literal">point</tt> module), or can be specialised for 2D, 3D or 4D (then they are taken in charge by the <tt class="docutils literal">point{2,3,4}</tt> modules).</p>
<p>As for <strong>vectors</strong>, they are to be specified by the user as <em>lists</em> of floating-point coordinates (ex: <span class="formula"><i>V⃗</i> = <span class="environment"><span class="arrayrow">
<span class="arraycell align-l">
0.0
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 − 7.3
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
3.22
</span>

</span>
</span></span> translating to <tt class="docutils literal"><span class="pre">V=[0.0,</span> <span class="pre">-7.3,</span> 3.22]</tt>); this directly corresponds to their internal representation, in order to better accommodate linear operations (being a special case of matrices).</p>
<p>So vectors also can be of arbitrary dimension (then they are taken in charge by the <tt class="docutils literal">vector</tt> module), or can be specialised for 2D, 3D or 4D (then they are taken in charge by the <tt class="docutils literal">vector{2,3,4}</tt> modules).</p>
<p>Points and vectors (of arbitrary dimension, or specialised) can be converted both ways, see <tt class="docutils literal"><span class="pre">point*:{to,from}_vector/1</span></tt> and <tt class="docutils literal"><span class="pre">vector*:{to,from}_point/1</span></tt>.</p>
<p>The <strong>matrices</strong> handled here can be of any dimensions (they are often square), and their elements are floating-point coordinates as well.</p>
<p>Let's consider a <span class="formula"><i>m</i> × <i>n</i></span> matrix (m rows, n columns):</p>
<div class="formula">
<i>M</i> = <span class="environment"><span class="arrayrow">
<span class="arraycell align-l">
<i>a</i>11
</span>
<span class="arraycell align-l">
<i>a</i>12
</span>
<span class="arraycell align-l">
...
</span>
<span class="arraycell align-l">
<i>a</i>1<i>n</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
<i>a</i>21
</span>
<span class="arraycell align-l">
<i>a</i>22
</span>
<span class="arraycell align-l">
...
</span>
<span class="arraycell align-l">
<i>a</i>2<i>n</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
...
</span>
<span class="arraycell align-l">
...
</span>
<span class="arraycell align-l">
...
</span>
<span class="arraycell align-l">
...
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
<i>am</i>1
</span>
<span class="arraycell align-l">
<i>am</i>2
</span>
<span class="arraycell align-l">
...
</span>
<span class="arraycell align-l">
<i>amn</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">

</span>

</span>
</span>
</div>
<p>Such a matrix may be expressed:</p>
<ul class="simple">
<li>as one of arbitrary dimension (designated from now on as an &quot;<em>arbitrary matrix</em>&quot;), corresponding to the <tt class="docutils literal">matrix:matrix/0</tt> type; internally such matrices are nested lists: a list of <tt class="docutils literal">m</tt> rows, each being a list of <tt class="docutils literal">n</tt> elements, hence defined in <a class="reference external" href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">row-major order</a> (not column-major one)</li>
<li>if being square and of a well-known dimension among 2, 3 or 4 (special cases defined for convenience and performance), as a value belonging to the <tt class="docutils literal"><span class="pre">matrix{2,3,4}/0</span></tt> types (which are records like <tt class="docutils literal">#matrix4{}</tt>, whose fields are named according to the matrix elements, such as <tt class="docutils literal">m41</tt>); they are designated hereafter as &quot;<em>specialised matrices</em>&quot;</li>
<li>in a symbolic way, such as <tt class="docutils literal">identity_4</tt> (meaning the identity 4x4 matrix)</li>
<li>for some dimensions (ex: 3D or 4D), extra representations exist (compact 4x4 matrices, made of a 3x3 matrix and a vector3, in the context of homogeneous operations)</li>
</ul>
<p>Taking as an example a 2x2 matrix like:</p>
<div class="formula">
<i>M</i> = <span class="environment"><span class="arrayrow">
<span class="arraycell align-l">
<i>a</i>11
</span>
<span class="arraycell align-l">
<i>a</i>12
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
<i>a</i>21
</span>
<span class="arraycell align-l">
<i>a</i>22
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">

</span>

</span>
</span>
</div>
<p>it can be created as an arbitrary <tt class="docutils literal">matrix/0</tt> with:</p>
<pre class="code erlang literal-block">
<span class="nv">M1</span> <span class="o">=</span> <span class="nn">matrix</span><span class="p">:</span><span class="nf">new</span><span class="p">([</span> <span class="p">[</span><span class="nv">A11</span><span class="p">,</span><span class="nv">A12</span><span class="p">],</span> <span class="p">[</span><span class="nv">A21</span><span class="p">,</span><span class="nv">A22</span><span class="p">]</span> <span class="p">])</span>
</pre>
<p>Alternatively it can be directly created as a specialised (presumably more efficient) 2x2 matrix <tt class="docutils literal">matrix2</tt> with:</p>
<pre class="code erlang literal-block">
<span class="nv">M2</span> <span class="o">=</span> <span class="nn">matrix2</span><span class="p">:</span><span class="nf">new</span><span class="p">([</span> <span class="p">[</span><span class="nv">A11</span><span class="p">,</span><span class="nv">A12</span><span class="p">],</span> <span class="p">[</span><span class="nv">A21</span><span class="p">,</span><span class="nv">A22</span><span class="p">]</span> <span class="p">])</span>
<span class="c">% Or:
</span><span class="nv">M3</span> <span class="o">=</span> <span class="nn">matrix2</span><span class="p">:</span><span class="nf">from_coordinates</span><span class="p">(</span><span class="nv">A11</span><span class="p">,</span> <span class="nv">A12</span><span class="p">,</span> <span class="nv">A21</span><span class="p">,</span> <span class="nv">A22</span><span class="p">)</span>
<span class="c">% Or even:
</span><span class="nv">M4</span> <span class="o">=</span> <span class="nn">matrix2</span><span class="p">:</span><span class="nf">from_arbitrary</span><span class="p">(</span><span class="nv">M1</span><span class="p">)</span>
<span class="nv">M5</span> <span class="o">=</span> <span class="nn">matrix</span><span class="p">:</span><span class="nf">specialise</span><span class="p">(</span><span class="nv">M1</span><span class="p">)</span>
</pre>
<p>There is a priori little interest in &quot;unspecialising&quot; (i.e. going from specialised to arbitrary matrix) by having:</p>
<pre class="code erlang literal-block">
<span class="nv">M6</span> <span class="o">=</span> <span class="nn">matrix</span><span class="p">:</span><span class="nf">unspecialise</span><span class="p">(</span><span class="nv">M2</span><span class="p">)</span>
</pre>
<p>In practice the actual, internal terms corresponding to all these matrices would be:</p>
<pre class="code erlang literal-block">
<span class="c">% For arbitrary ones:
% (supposing that all Axy coordinates are already floats):
</span><span class="nv">M1</span> <span class="o">=</span> <span class="nv">M6</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="nv">A11</span><span class="p">,</span><span class="nv">A12</span><span class="p">],</span>
            <span class="p">[</span><span class="nv">A21</span><span class="p">,</span><span class="nv">A22</span><span class="p">]</span> <span class="p">]</span>

<span class="c">% For specialised ones:
</span><span class="nv">M2</span> <span class="o">=</span> <span class="nv">M3</span> <span class="o">=</span> <span class="nv">M4</span> <span class="o">=</span> <span class="nv">M5</span> <span class="o">=</span> <span class="nl">#matrix2</span><span class="p">{</span> <span class="n">m11</span><span class="o">=</span><span class="nv">A11</span><span class="p">,</span> <span class="n">m12</span><span class="o">=</span><span class="nv">A12</span><span class="p">,</span>
                              <span class="n">m21</span><span class="o">=</span><span class="nv">A21</span><span class="p">,</span> <span class="n">m22</span><span class="o">=</span><span class="nv">A22</span> <span class="p">}</span>
</pre>
<p>Finally, <strong>quaternions</strong> are also supported (see <tt class="docutils literal">quaternion.erl</tt>). They can be defined from 4 numbers, or as a 3D rotation. They are stored as quadruplets of floats, and can be added, multiplied, negated, scaled, normalised, conjugates, inversed, etc., and may be represented either as</p>
<div class="formula">
<i>Q</i> = <span class="environment"><span class="arrayrow">
<span class="arraycell align-l">
<i>A</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
<i>B</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
<i>C</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
<i>D</i>
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">
 
</span>

</span>
<span class="arrayrow">
<span class="arraycell align-l">

</span>

</span>
</span>
</div>
<p>or as:</p>
<div class="formula">
<i>Q</i> = <i>A</i> + <i>B</i>.<b>i</b> + <i>C</i>.<b>j</b> + <i>D</i>.<b>k</b>
</div>
<p>They notably provide a higher-level, more convenient counterpart to 3x3 rotation matrices (see <tt class="docutils literal">matrix3:rot_matrix3()</tt>); both can be computed from a unit axis and an angle.</p>
<p>Note that:</p>
<ul class="simple">
<li>we call a container <em>type-homogeneous</em> iff all the coordinates that it gathers are all either integer or floating-point ones</li>
<li>new instances (ex: of points, matrices, vectors, quaternions) may be:<ul>
<li>either literally specified, with a term directly corresponding to their internal form</li>
<li>or based on a <tt class="docutils literal">new</tt> operator (ex: <tt class="docutils literal">matrix:new/1</tt>), in which case with a higher-level user-term (ex: a matrix with integer coordinates, in which case they will be automatically converted to floats)</li>
</ul>
</li>
<li>for clarity and in order to provide them with specified operations (like dot product), we preferred defining vectors as a separate type from the matrix one (even if a vector can be seen as a 1-column matrix)</li>
<li>by default, for least surprise, coordinates are displayed in full, i.e. <em>not</em> rounded (refer to the <tt class="docutils literal">printout_{width,precision}</tt> defines in <tt class="docutils literal">linear.hrl</tt>)</li>
<li>the procedure to check the validity of computations is the following:<ul>
<li>first implement the arbitrary version</li>
<li>validate it, by composing internal operations and by comparison with a tool like Scilab/Octave</li>
<li>implement the specialised versions</li>
<li>validate them against the arbitrary version</li>
</ul>
</li>
<li>the most common operations are defined for each datatype: creating, modifying, comparing, displaying and, whenever appropriate: adding, subtracting, scaling, multiplying, rotating, measuring, transposing, reversing, etc.</li>
<li>operations are not implemented defensively, in the sense that a base runtime error will be triggered if a type or a size does not match, rather than being tested explicitly (anyway generally no useful extra context could then be specifically reported)</li>
<li>additional runtime checks (ex: to check whether parameters expected to be unit vectors are normalised indeed) can nevertheless be enabled by setting the <tt class="docutils literal">myriad_check_linear</tt> flag (refer to <tt class="docutils literal">GNUmakevars.inc</tt>)</li>
<li>for <a class="reference external" href="https://en.wikipedia.org/wiki/Homogeneous_coordinates#Use_in_computer_graphics_and_computer_vision">homogeneous coordinates</a>: any implicit homogeneous <cite>w</cite> coordinate is <tt class="docutils literal">1.0</tt></li>
<li>most operations here involve floating-point coordinates, rather than integer ones; as an Erlang's <tt class="docutils literal">float()</tt> is a double-precision one, it requires more resources (CPU and memory footprint) than a basic, single-precision one; for applications not requiring extra precision, maybe the Erlang VM could be compiled in order to rely on single-precision floats instead</li>
</ul>
</div>
<div class="section" id="geometric-conventions">
<h4>Geometric Conventions</h4>
<p><span class="raw-html"><center><img src="myriad-space-time-referential.png" id="responsive-image-tiny"></img></center></span>
</p>
<p>For <strong>space</strong> coordinates, three axes are defined for a global referential:</p>
<ul class="simple">
<li>abscissa: X axis (in red, <tt class="docutils literal">#FF0000</tt>)</li>
<li>ordinate: Y axis (in green, <tt class="docutils literal">#008000</tt>)</li>
<li>depth: Z axis (in blue, <tt class="docutils literal">#0000FF</tt>)</li>
</ul>
<p>By default, we consider right-handed Cartesian coordinate systems, and we rely on &quot;Z-up&quot; conventions (the Z axis being vertical and designating altitudes), like modelling software such as <a class="reference external" href="https://www.blender.org/">Blender</a> <a class="footnote-reference" href="#id76" id="id75">[18]</a>.</p>
<table class="docutils footnote" frame="void" id="id76" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id75">[18]</a></td><td>Unlike many games, for which the Y axis is up, Z being the depth, perpendicular to the screen. Anyway a simple camera transformation is enough to switch conventions.</td></tr>
</tbody>
</table>
<p>In 2D, typically for on-screen coordinates (ex: when drawing in a canvas), the corresponding projected referential applies, based on the X and Y axes <a class="footnote-reference" href="#id78" id="id77">[19]</a>:</p>
<p><span class="raw-html"><center><img src="myriad-2D-referential.png" id="responsive-image-xsmall"></img></center></span>
</p>
<table class="docutils footnote" frame="void" id="id78" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id77">[19]</a></td><td>This 2D referential corresponds to the base space-time one, when the viewpoint is located in the negative Z axis and looks at the origin.</td></tr>
</tbody>
</table>
<p>For each of the spatial dimensions of interest, generally <tt class="docutils literal">1.0</tt> corresponds to 1 meter, otherwise to 1 <a class="reference external" href="https://en.wikipedia.org/wiki/Light-second">light-second</a> (i.e. roughly 300 000 km <a class="footnote-reference" href="#id80" id="id79">[20]</a>).</p>
<table class="docutils footnote" frame="void" id="id80" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id79">[20]</a></td><td>Then for more human-sized distances, a scale of one light-nanosecond (10^-9 second) might be more convenient, as it corresponds almost to 30 cm.</td></tr>
</tbody>
</table>
<p>For <strong>all angles</strong>, the default unit is the <a class="reference external" href="https://en.wikipedia.org/wiki/Radian">radian</a> (<span class="formula">2<i>π</i></span> radians is equal to 360 degrees), and the positive rotation is counterclockwise.</p>
<p>For <strong>face culling</strong>, front-facing is determined by relying on a counter-clockwise order winding order of triangles (like default OpenGL's <a class="reference external" href="https://www.khronos.org/opengl/wiki/Face_Culling">GL_CCW</a>):</p>
<p><span class="raw-html"><center><img src="myriad-culling-conventions.png" id="responsive-image-medium"></img></center></span>
</p>
<p>Indeed a triangle enumerating its vertices in counter-clockwise order (<tt class="docutils literal"><span class="pre">A-&gt;B-&gt;C</span></tt>) would define a normal vector <span class="formula"><i>N⃗</i> = <i><span class="withsymbol"><span class="symbolover">⟶</span><span class="undersymbol">AB</span></span></i> × <i><span class="withsymbol"><span class="symbolover">⟶</span><span class="undersymbol">BC</span></span></i></span> pointing towards the outside of a body comprising that triangle.</p>
<p>If <span class="formula"><i>V⃗</i>⋅<i>N⃗</i></span> (i.e. the dot-product of the view direction vector and of this outward vector product) is:</p>
<ul class="simple">
<li>strictly negative: then the face is front-facing</li>
<li>positive: then the face is rear-facing</li>
</ul>
<p>Said otherwise, front-facing polygons are the ones whose signed area is strictly positive; see also: <tt class="docutils literal"><span class="pre">polygon:{get_area,get_signed_area}/1</span></tt>.</p>
<p>A fourth coordinate besides X, Y and Z could be used, as an extra axis (in yellow, <tt class="docutils literal">#F6DE2D</tt>):</p>
<ul class="simple">
<li>either for <strong>homogeneous</strong> coordinates, in which case it will be considered to be spatial as well, with the same unit as the three first ones, and preferably designated as <tt class="docutils literal">W</tt></li>
<li>or for <strong>time</strong> coordinates, with a single axis defined for a global referential: the <tt class="docutils literal">T</tt> one, for which <tt class="docutils literal">1.0</tt> corresponds to 1 second</li>
</ul>
</div>
<div class="section" id="related-services">
<h4>Related Services</h4>
<p>Elements of interest can be:</p>
<ul class="simple">
<li>some support of polygons, in <tt class="docutils literal">polygon.erl</tt></li>
<li>a basic support for 2D bounding-boxes (including rectangles, &quot;lazy&quot; circles and <em>Minimal Enclosing Circles</em> based on convex hulls; see <tt class="docutils literal"><span class="pre">bounding_boxes2.{hrl,erl}</span></tt>) and corresponding 3D bounding-boxes (including right cuboids and spheres; see <tt class="docutils literal"><span class="pre">bounding_boxes3.{hrl,erl}</span></tt>)</li>
<li>elements in order to import/export 3D scenes thanks to the <a class="reference internal" href="#gltf-file-format">glTF file format</a></li>
</ul>
</div>
<div class="section" id="possible-enhancements">
<h4>Possible Enhancements</h4>
<p>In the future, the most usual spatial types such as <tt class="docutils literal">matrix</tt> and <tt class="docutils literal">vector</tt> may be shortened in Myriad-based code as respectively <tt class="docutils literal">m</tt> and <tt class="docutils literal">v</tt>, the Myriad parse transform being then in charge of expanding accordingly (ex: a in-code shorthand <tt class="docutils literal">m3:new/0</tt> becoming <tt class="docutils literal">matrix3:new/0</tt> to the eyes of the compiler).</p>
<p></p>
</div>
</div>
</div>
<div class="section" id="management-of-units">
<span id="units"></span><h2><a class="toc-backref" href="#id154">Management of Units</a></h2>
<div class="section" id="id81">
<h3><a class="toc-backref" href="#id155">Motivation</a></h3>
<p>A value of a given type (ex: a float) can actually correspond to quantities as different as meters and kilowatts per hour.</p>
<p>Therefore <strong>units shall preferably be specified alongside with values being processed</strong>, and a language to express, check and convert these units must be retained. Of course units are of interest as other metadata are - such as accuracy, semantics, etc.</p>
</div>
<div class="section" id="available-support">
<h3><a class="toc-backref" href="#id156">Available Support</a></h3>
<p>The <tt class="docutils literal">Myriad</tt> layer provides such a service, in a very basic, ad hoc form (which is useful to introduce &quot;special&quot; non-physical, non-standard units, such as <tt class="docutils literal">euro/year</tt>), meant to be enriched over time.</p>
</div>
<div class="section" id="specifying-units">
<h3><a class="toc-backref" href="#id157">Specifying Units</a></h3>
<div class="section" id="aliases">
<h4>Aliases</h4>
<p>For convenience, <em>aliases</em> of units can be defined, i.e. alternate names for a given canonical unit. For example the Hertz unit (<tt class="docutils literal">Hz</tt>) is an alias of the <tt class="docutils literal"><span class="pre">s^-1</span></tt> (per-second) canonical unit.</p>
</div>
<div class="section" id="built-in-units">
<h4>Built-in Units</h4>
<p>So one may use the following <strong>built-in units</strong>, whose symbol <a class="footnote-reference" href="#id84" id="id82">[21]</a> is specified here between brackets, like in <tt class="docutils literal">&quot;[N.m]&quot;</tt> (an alternate notation is to prefix a unit with <tt class="docutils literal">U:</tt>, like in <tt class="docutils literal">&quot;U: N.m&quot;</tt>):</p>
<ul class="simple">
<li>the seven <a class="reference external" href="https://en.wikipedia.org/wiki/SI_base_unit">SI base units</a>, namely:<ul>
<li>meter, for length [<tt class="docutils literal">m</tt>]</li>
<li>gram, for mass [<tt class="docutils literal">g</tt>] <a class="footnote-reference" href="#id85" id="id83">[22]</a> (note: this is a footnote, not an exponent!)</li>
<li>second, for time [<tt class="docutils literal">s</tt>]</li>
<li>ampere, for electric current [<tt class="docutils literal">A</tt>]</li>
<li>kelvin, for thermodynamic temperature [<tt class="docutils literal">K</tt>]</li>
<li>mole, for the amount of substance [<tt class="docutils literal">mol</tt>]</li>
<li>candela, for luminous intensity [<tt class="docutils literal">cd</tt>]</li>
</ul>
</li>
<li>the usual <a class="reference external" href="https://en.wikipedia.org/wiki/SI_derived_unit">derived units</a>, notably:<ul>
<li>hertz, for frequency [<tt class="docutils literal">Hz</tt>]</li>
<li>degree, for degree of arc [<tt class="docutils literal">°</tt>] (not supported yet)</li>
<li>radian, for angle [<tt class="docutils literal">rad</tt>] (not supported yet)</li>
<li>steradian, for solid angle [<tt class="docutils literal">sr</tt>] (not supported yet)</li>
<li>newton, for force, weight [<tt class="docutils literal">N</tt>]</li>
<li>pascal, for pressure, stress [<tt class="docutils literal">Pa</tt>]</li>
<li>joule, for energy, work, heat [<tt class="docutils literal">J</tt>]</li>
<li>watt, for power, radiant flux [<tt class="docutils literal">W</tt>]</li>
<li>coulomb, for electric charge, quantity of electricity [<tt class="docutils literal">C</tt>]</li>
<li>volt, for voltage, electrical potential difference, electromotive force [<tt class="docutils literal">V</tt>]</li>
<li>farad, for electrical capacitance [<tt class="docutils literal">F</tt>]</li>
<li>ohm, for electrical resistance, impedance, reactance [<tt class="docutils literal">Ohm</tt>]</li>
<li>siemens, for electrical conductance [<tt class="docutils literal">S</tt>]</li>
<li>weber, for magnetic flux [<tt class="docutils literal">Wb</tt>]</li>
<li>tesla, for magnetic field strength, magnetic flux density [<tt class="docutils literal">T</tt>]</li>
<li>henry, for inductance [<tt class="docutils literal">H</tt>]</li>
<li>lumen, for luminous flux [<tt class="docutils literal">lm</tt>]</li>
<li>lux, for illuminance [<tt class="docutils literal">lx</tt>]</li>
<li>becquerel, for radioactive decays per unit time [<tt class="docutils literal">Bq</tt>]</li>
<li>gray, for absorbed dose of ionizing radiation [<tt class="docutils literal">Gy</tt>]</li>
<li>sievert, for equivalent dose of ionizing radiation [<tt class="docutils literal">Sv</tt>]</li>
<li>katal, for catalytic activity [<tt class="docutils literal">kat</tt>]</li>
</ul>
</li>
<li>the units <strong>widely used</strong> in conjunction with SI units (note that they may not respect the principle of being a product of integer powers of one or more of the base units):<ul>
<li>litre, for 10<sup>-3</sup>m<sup>3</sup>volumes [<tt class="docutils literal">L</tt>]</li>
<li>tonne, for 1,000 kilogram masses [<tt class="docutils literal">t</tt>]</li>
<li>electronvolt, for 1.602176565(35).10-19 joule energies  [<tt class="docutils literal">eV</tt>]</li>
<li>minute, for 60-second durations [<tt class="docutils literal">min</tt>]</li>
<li>hour, for 60-minute durations [<tt class="docutils literal">h</tt>]</li>
<li>day, for 24-hour durations [<tt class="docutils literal">day</tt>]</li>
<li>week, for 7-day durations [<tt class="docutils literal">week</tt>]</li>
</ul>
</li>
<li>the <strong>special</strong> units (they generally cannot map directly to any SI unit, yet can be handled separately), designating:<ul>
<li>month [<tt class="docutils literal">month</tt>] (correspondence to base time units unspecified, as this duration is not constant; ex: a month can be 29, 30 or 31 days)</li>
<li>year [<tt class="docutils literal">year</tt>] (correspondence to base time units unspecified, as this duration is not constant; ex: a year can be 365, 366 or 365.25 days, etc.)</li>
<li>degree Celsius, for temperature relative to 273.15 K [<tt class="docutils literal">°C</tt>] (see note below)</li>
<li>dimension-less quantities (ex: an index) [<tt class="docutils literal">dimensionless</tt>] (most probably clearer than <tt class="docutils literal">m/m</tt>)</li>
<li>a count, i.e. a dimensionless number, generally a positive integer [<tt class="docutils literal">count</tt>] (ex: <tt class="docutils literal">14</tt>), considered as an alias of <tt class="docutils literal">dimensionless</tt></li>
<li>a ratio, i.e. a dimensionless floating-point value, generally displayed as a percentage [<tt class="docutils literal">ratio</tt>] (ex: <tt class="docutils literal"><span class="pre">-12.9%</span></tt>); another alias of <tt class="docutils literal">dimensionless</tt></li>
<li>currencies, either [<tt class="docutils literal">$</tt>] (US Dollar) or [<tt class="docutils literal">euros</tt>] (Euro), whose exchange rates of course vary</li>
<li>values whose unit has not been specified [<tt class="docutils literal">unspecified_unit</tt>]</li>
</ul>
</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Metric_prefix">metric prefixes</a> thereof, i.e. multiples and sub-multiples of the units previously mentioned; currently the supported prefixes are:<ul>
<li>yotta, i.e. 10<sup>24</sup> [<tt class="docutils literal">Y</tt>]</li>
<li>zetta, i.e. 10<sup>21</sup> [<tt class="docutils literal">Z</tt>]</li>
<li>exa, i.e. 10<sup>18</sup> [<tt class="docutils literal">E</tt>]</li>
<li>peta, i.e. 10<sup>15</sup> [<tt class="docutils literal">P</tt>]</li>
<li>tera, i.e. 10<sup>12</sup> [<tt class="docutils literal">T</tt>]</li>
<li>giga, i.e. 10<sup>9</sup> [<tt class="docutils literal">G</tt>]</li>
<li>mega, i.e. 10<sup>6</sup> [<tt class="docutils literal">M</tt>]</li>
<li>kilo, i.e. 10<sup>3</sup> [<tt class="docutils literal">k</tt>]</li>
<li>hecto, i.e. 10<sup>2</sup> [<tt class="docutils literal">h</tt>]</li>
<li>deca, i.e. 10 [<tt class="docutils literal">da</tt>]</li>
<li>deci, i.e. 10<sup>-1</sup> [<tt class="docutils literal">d</tt>]</li>
<li>centi, i.e. 10<sup>-2</sup> [<tt class="docutils literal">c</tt>]</li>
<li>milli, i.e. 10<sup>-3</sup> [<tt class="docutils literal">m</tt>]</li>
<li>micro, i.e. 10<sup>-6</sup> [<tt class="docutils literal">µ</tt>]</li>
<li>nano, i.e. 10<sup>-9</sup> [<tt class="docutils literal">n</tt>]</li>
<li>pico, i.e. 10<sup>-12</sup> [<tt class="docutils literal">p</tt>]</li>
<li>femto, i.e. 10<sup>-15</sup> [<tt class="docutils literal">f</tt>]</li>
<li>atto, i.e. 10<sup>-18</sup> [<tt class="docutils literal">a</tt>]</li>
<li>zepto, i.e. 10<sup>-21</sup> [<tt class="docutils literal">z</tt>]</li>
<li>yocto, i.e. 10<sup>-24</sup> [<tt class="docutils literal">y</tt>]</li>
</ul>
</li>
</ul>
<table class="docutils footnote" frame="void" id="id84" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id82">[21]</a></td><td>To avoid requesting the user to type specific Unicode characters, we transliterated some of the symbols. For example, instead of using the capital Omega letter, we used <tt class="docutils literal">Ohm</tt>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id85" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id83">[22]</a></td><td>We preferred here deviating a bit from the SI system, by using this non-prefixed unit (the <em>gram</em>) instead of the SI standard one, which happens to be the <em>kilogram</em>.</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There is a problem with temperatures, as they can be expressed at least in kelvins or degrees Celsius, whereas the two corresponding scales do not match, since there is an offset: <tt class="docutils literal">[K] = [°C] + 273.15</tt>.</p>
<p>As a result, unit conversions would require updating as well the corresponding value, and, more generally, they should be treated as fully distinct units (ex: <tt class="docutils literal"><span class="pre">kW/°C</span></tt> cannot be automatically converted in terms of SI base units, i.e. using <tt class="docutils literal">K</tt>).</p>
<p>This is why we &quot;degraded&quot; Celsius degrees, from a derived unit to a special one.</p>
<p class="last">The same applies to the Fahrenheit unit (a likely addition), as: <tt class="docutils literal">[°C] = <span class="pre">5/9.([°F]-32)</span></tt>.</p>
</div>
</div>
<div class="section" id="composing-one-s-units">
<h4>Composing One's Units</h4>
<p>So an actual unit can be composed from the aforementioned built-in units (be they base, derived, widely used, special units; prefixed or not) <a class="footnote-reference" href="#id87" id="id86">[23]</a>, using two built-in operators, which are <tt class="docutils literal">&quot;.&quot;</tt> (multiply, represented by the dot character - not <tt class="docutils literal">&quot;*&quot;</tt>) and <tt class="docutils literal">&quot;/&quot;</tt> (divide, represented by the forward slash character).</p>
<table class="docutils footnote" frame="void" id="id87" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id86">[23]</a></td><td>In the future, defining an actual unit from other actual units might be contemplated.</td></tr>
</tbody>
</table>
<p>The resulting type shall be specified as a string, containing a series of built-in units (potentially prefixed) alternating with built-in operators, like in: <tt class="docutils literal">&quot;kW.s/m&quot;</tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As a result, <tt class="docutils literal">&quot;kWh&quot;</tt> is not a valid unit: it should be denoted as <tt class="docutils literal">&quot;kW.h&quot;</tt>.</p>
<p class="last">Similarly, <tt class="docutils literal"><span class="pre">&quot;W/(m.k)&quot;</span></tt> is not valid, since parentheses are currently not supported: <tt class="docutils literal">&quot;W/m/k&quot;</tt> may be used instead.</p>
</div>
<p>Finally, exponents can be used as a shorthand for both operators (ex: <tt class="docutils literal"><span class="pre">kg.m^2.s^-1</span></tt>, instead of <tt class="docutils literal">kg.m.m/s</tt>). They should be specified explicitly, thanks to the caret character (<tt class="docutils literal">&quot;^&quot;</tt>); for example <tt class="docutils literal">&quot;m^2/s&quot;</tt>, not <tt class="docutils literal">&quot;m²/s&quot;</tt>.</p>
<p>If deemed both safe and useful, we may consider in the future performing:</p>
<ul class="simple">
<li>symbolic unit checking (i.e. determining that a derived unit such as <tt class="docutils literal">N.s</tt> (newton.second) is actually, in canonical SI units, <tt class="docutils literal"><span class="pre">m^2.kg.s^-1</span></tt>), and thus that values of these two types can safely be used indifferently in computations</li>
<li>automatic value conversions (ex: converting <tt class="docutils literal">km/hour</tt> into <tt class="docutils literal">m/s</tt>), provided that the overall computational precision is not significantly deteriorated</li>
</ul>
<p>The corresponding mechanisms (type information, conversion functions, unit checking and transformation, etc.) are defined in <tt class="docutils literal">unit_utils.erl</tt> and tested in <tt class="docutils literal">unit_utils_test.erl</tt>,  in the <tt class="docutils literal">myriad/src/utils</tt> directory.</p>
</div>
<div class="section" id="checking-units">
<h4>Checking Units</h4>
<p>A typical example:</p>
<pre class="code erlang literal-block">
<span class="mi">1</span><span class="o">&gt;</span> <span class="nv">MyInputValue</span><span class="o">=</span><span class="s">&quot;-24 mS.m^-1&quot;</span><span class="p">.</span>
<span class="mi">2</span><span class="o">&gt;</span> <span class="p">{</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Unit</span><span class="p">}</span><span class="o">=</span><span class="nn">unit_utils</span><span class="p">:</span><span class="nf">parse_value_with_unit</span><span class="p">(</span><span class="nv">MyInputValue</span><span class="p">).</span>
<span class="mi">3</span><span class="o">&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Corresponding value: </span><span class="si">~f</span><span class="s">.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="nv">Value</span> <span class="p">]</span> <span class="p">).</span>
<span class="nv">Corresponding</span> <span class="nn">value</span><span class="p">:</span> <span class="o">-</span><span class="mi">24</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span>
<span class="mi">4</span><span class="o">&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Corresponding unit: </span><span class="si">~s</span><span class="s">.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span>
   <span class="p">[</span><span class="nn">unit_utils</span><span class="p">:</span><span class="nf">unit_to_string</span><span class="p">(</span><span class="nv">Unit</span><span class="p">)]).</span>
<span class="s">&quot;s^3.A^2.g^-1.m^-3, of order -6&quot;</span>
<span class="mi">5</span><span class="o">&gt;</span> <span class="nn">unit_utils</span><span class="p">:</span><span class="nf">value_with_unit_to_string</span><span class="p">(</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Unit</span><span class="p">).</span>
<span class="s">&quot;-2.4e-5 s^3.A^2.g^-1.m^-3&quot;</span>
</pre>
</div>
</div>
<div class="section" id="possible-improvements-regarding-dimensional-analysis">
<h3><a class="toc-backref" href="#id158">Possible Improvements Regarding Dimensional Analysis</a></h3>
<p>Some programming languages provide systems to manage dimensional information (ex: for physical quantities), generally through add-ons or libraries (rarely as a built-in feature).</p>
<p>A first level of support is to provide, like here, an API to manage units. Other levels can be:</p>
<ol class="arabic simple">
<li>to integrate unit management directly, seamlessly in language expressions, as if it was built-in (as opposed to having to use explicitly a third-party API for that); for example at least half a dozen different libraries provide that in Python</li>
<li>to be able to define &quot;polymorphic units and functions&quot;, for example to declare in general that a speed is a distance divided by a duration, regardless of the possible units used for that</li>
<li>to perfom <em>static</em> dimensional analysis, instead of checking units at runtime</li>
</ol>
<p>The two latter use cases can for example be at least partially covered by Haskell libraries.</p>
<p></p>
</div>
</div>
<div class="section" id="sql-support">
<h2><a class="toc-backref" href="#id159">SQL support</a></h2>
<div class="section" id="about-sql">
<h3><a class="toc-backref" href="#id160">About SQL</a></h3>
<p>Some amount of <a class="reference external" href="https://en.wikipedia.org/wiki/SQL">SQL</a> (<em>Structured Query Language</em>) support for relational database operations is provided by the <tt class="docutils literal">Myriad</tt> layer.</p>
<p>As this support relies on an optional prerequisite, this service is disabled by default.</p>
</div>
<div class="section" id="database-backends">
<h3><a class="toc-backref" href="#id161">Database Backends</a></h3>
<p>To perform SQL operations, a corresponding software solution must be available.</p>
<p>Two SQL database backends have been preferred here: <strong>SQLite 3</strong> for lighter needs, and <strong>PostgreSQL</strong> for heavier ones, notably whenever having to connect to a third-party instance thereof.</p>
<div class="section" id="sqlite-3">
<h4>SQLite 3</h4>
<div class="section" id="sqlite-basics">
<h5>SQLite Basics</h5>
<p>The <a class="reference external" href="https://www.sqlite.org/about.html">SQLite 3</a> library provides a self-contained, serverless, zero-configuration, transactional SQL database. It is an embedded SQL database engine, as opposed to server-based ones like <a class="reference external" href="https://en.wikipedia.org/wiki/PostgreSQL">PostgreSQL</a> or <a class="reference external" href="https://en.wikipedia.org/wiki/MariaDB">MariaDB</a>.</p>
<p>It can be installed on Debian thanks to the <tt class="docutils literal">sqlite3</tt> and <tt class="docutils literal"><span class="pre">sqlite3-dev</span></tt> packages, <tt class="docutils literal">sqlite</tt> on Arch Linux.</p>
<p>We require version 3.6.1 or higher (preferably: latest stable one). It can be checked thanks to <tt class="docutils literal">sqlite3 <span class="pre">--version</span></tt>.</p>
<p>Various related tools are very convenient in order to interact with a SQLite database, including <tt class="docutils literal">sqlitebrowser</tt> and <tt class="docutils literal">sqliteman</tt>.</p>
<p>On Arch Linux, one can thus use: <tt class="docutils literal">pacman <span class="pre">-Sy</span> sqlite sqlitebrowser sqliteman</tt>.</p>
<p>Testing the backend as it is:</p>
<pre class="code bash literal-block">
$ sqlite3 my_test
</pre>
<pre class="code sql literal-block">
<span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">13</span><span class="p">.</span><span class="mi">0</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">30</span>
<span class="n">Enter</span> <span class="ss">&quot;.help&quot;</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">tblone</span><span class="p">(</span><span class="n">one</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">two</span> <span class="nb">smallint</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">tblone</span> <span class="k">values</span><span class="p">(</span><span class="s1">'helloworld'</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">tblone</span> <span class="k">values</span><span class="p">(</span><span class="s1">'my_myriad'</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">tblone</span><span class="p">;</span>
<span class="n">helloworld</span><span class="o">|</span><span class="mi">20</span>
<span class="n">my_myriad</span><span class="o">|</span><span class="mi">30</span>
<span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">quit</span>
</pre>
<p>A file <tt class="docutils literal">my_test</tt>, identified as <tt class="docutils literal">SQLite 3.x database</tt>, must have been created, and can be safely removed.</p>
</div>
<div class="section" id="sqlite-binding">
<h5>SQLite Binding</h5>
<p>This database system can be directly accessed (as a client) thanks to an Erlang binding.</p>
<p>Two of them have been identified as good candidates:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/alexeyr/erlang-sqlite3">erlang-sqlite3</a>: seems popular, with many contributors and users, actively maintained, based on a <tt class="docutils literal">gen_server</tt> interacting with a C-node, involving only a few source files</li>
<li><a class="reference external" href="https://github.com/mmzeeman/esqlite">esqlite</a>: based on a NIF, so more able to jeopardize the stability of the VM, yet potentially more efficient</li>
</ul>
<p>Both are free software.</p>
<p>We finally preferred <tt class="docutils literal"><span class="pre">erlang-sqlite3</span></tt>.</p>
<p>By default we consider that this backend has been installed in <tt class="docutils literal"><span class="pre">~/Software/erlang-sqlite3</span></tt>. The <tt class="docutils literal">SQLITE3_BASE</tt> variable in <tt class="docutils literal">myriad/GNUmakevars.inc</tt> can be set to match any other install path.</p>
<p>Recommended installation process:</p>
<pre class="code bash literal-block">
$ mkdir ~/Software
$ <span class="nb">cd</span> ~/Software
$ git clone https://github.com/alexeyr/erlang-sqlite3.git
Cloning into <span class="s1">'erlang-sqlite3'</span>...
remote: Counting objects: <span class="m">1786</span>, <span class="k">done</span>.
remote: Total <span class="m">1786</span> <span class="o">(</span>delta <span class="m">0</span><span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta <span class="m">0</span><span class="o">)</span>, pack-reused <span class="m">1786</span>
Receiving objects: <span class="m">100</span>% <span class="o">(</span><span class="m">1786</span>/1786<span class="o">)</span>, <span class="m">3</span>.24 MiB <span class="p">|</span> <span class="m">570</span>.00 KiB/s, <span class="k">done</span>.
Resolving deltas: <span class="m">100</span>% <span class="o">(</span><span class="m">865</span>/865<span class="o">)</span>, <span class="k">done</span>.
Checking connectivity... <span class="k">done</span>.
$ <span class="nb">cd</span> erlang-sqlite3/
$ make
rm -rf deps ebin priv/*.so doc/* .eunit/* c_src/*.o config.tmp
rm -f config.tmp
<span class="nb">echo</span> <span class="s2">&quot;normal&quot;</span> &gt; config.tmp
./rebar get-deps <span class="nv">compile</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>get-deps<span class="o">)</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>compile<span class="o">)</span>
Compiled src/sqlite3_lib.erl
Compiled src/sqlite3.erl
Compiling c_src/sqlite3_drv.c
<span class="o">[</span>...<span class="o">]</span>
</pre>
<p>Testing the binding:</p>
<pre class="code bash literal-block">
make <span class="nb">test</span>
./rebar get-deps compile <span class="nv">eunit</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>get-deps<span class="o">)</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>compile<span class="o">)</span>
<span class="o">==</span>&gt; erlang-sqlite3 <span class="o">(</span>eunit<span class="o">)</span>
Compiled src/sqlite3.erl
Compiled src/sqlite3_lib.erl
Compiled test/sqlite3_test.erl
<span class="o">========================</span> <span class="nv">EUnit</span> <span class="o">========================</span>
module <span class="s1">'sqlite3_test'</span>
  sqlite3_test: all_test_ <span class="o">(</span>basic_functionality<span class="o">)</span>...<span class="o">[</span><span class="m">0</span>.002 s<span class="o">]</span> ok
  sqlite3_test: all_test_ <span class="o">(</span>table_info<span class="o">)</span>...ok
  <span class="o">[</span>...<span class="o">]</span>
  sqlite3_lib: delete_sql_test...ok
  sqlite3_lib: drop_table_sql_test...ok
  <span class="o">[</span><span class="k">done</span> in <span class="m">0</span>.024 s<span class="o">]</span>
  module <span class="s1">'sqlite3'</span>
<span class="o">=======================================================</span>
All <span class="m">30</span> tests passed.
Cover analysis: ~/Software/erlang-sqlite3/.eunit/index.html
</pre>
<p>Pretty reassuring.</p>
</div>
</div>
<div class="section" id="id89">
<h4>PostgreSQL</h4>
<div class="section" id="postgresql-basics">
<h5>PostgreSQL Basics</h5>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/PostgreSQL">PostgreSQL</a> is a well known, free and open-source (client/server) <em>Relational Database Management System</em> (RDBMS) emphasizing extensibility and SQL compliance. It is designed to handle a range of workloads, from single machines to larger services with many concurrent users.</p>
<p>This object-relational database can be enriched to support other datatypes, such as geographic objects with <a class="reference external" href="https://en.wikipedia.org/wiki/PostGIS">PostGIS</a>.</p>
<p>It can be installed on Debian thanks to the <tt class="docutils literal"><span class="pre">postgresql-client</span></tt> package (and the database itself with the <tt class="docutils literal">postgresql</tt> one), or <tt class="docutils literal">postgresql</tt> on Arch Linux.</p>
</div>
<div class="section" id="postgresql-binding">
<h5>PostgreSQL Binding</h5>
<p>This database system can be directly accessed (as a client) thanks to either the PostgreSQL command-line client (<tt class="docutils literal">psql</tt>; for a simpler, more limited approach) or to an Erlang binding, the one that we retained being <a class="reference external" href="https://github.com/epgsql/epgsql">epgsql</a> (for a more efficient, in-depth access).</p>
<p>By default we consider that this binding has been installed in <tt class="docutils literal">~/Software/epgsql</tt>. The <tt class="docutils literal">POSTGRESQL_BASE</tt> variable in <tt class="docutils literal">myriad/GNUmakevars.inc</tt> can be set to match any other install path.</p>
<p>Recommended installation process:</p>
<pre class="code bash literal-block">
$ mkdir -p ~/Software <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$_</span>
$ git clone https://github.com/epgsql/epgsql.git
$ <span class="nb">cd</span> epgsql <span class="o">&amp;&amp;</span> make all <span class="o">&amp;&amp;</span> ln -s ./_build/default/lib/epgsql/ebin
</pre>
</div>
</div>
</div>
<div class="section" id="myriad-sql-support">
<h3><a class="toc-backref" href="#id162">Myriad SQL Support</a></h3>
<p>To enable this support, once the corresponding backend and binding (see <a class="reference internal" href="#database-backends">Database Backends</a>) have been installed, the <tt class="docutils literal">USE_SQLITE</tt> variable should be set to <tt class="docutils literal">true</tt> in <tt class="docutils literal">myriad/GNUmakevars.inc</tt>, and <tt class="docutils literal">Myriad</tt> shall be rebuilt.</p>
<p>Then the corresponding implementation (<tt class="docutils literal">sql_support.erl</tt>) and test (<tt class="docutils literal">sql_support_test.erl</tt>), both in <tt class="docutils literal"><span class="pre">myriad/src/data-management</span></tt>, will be built (use <tt class="docutils literal">make clean all</tt> from the root of <tt class="docutils literal">Myriad</tt>) and able to be run (execute <tt class="docutils literal">make sql_support_run</tt> for that).</p>
<p>Testing it:</p>
<pre class="code bash literal-block">
$ <span class="nb">cd</span> myriad/src/data-management
$ make sql_support_run
       Compiling module sql_support.erl
       Compiling module sql_support_test.erl
       Running unitary <span class="nb">test</span> sql_support_run
 <span class="o">[</span>...<span class="o">]</span>
 --&gt; Testing module sql_support_test.
 Starting SQL support <span class="o">(</span>based on SQLite3<span class="o">)</span>.
 <span class="o">[</span>...<span class="o">]</span>
 Closing database.
 Stopping SQL support.
 --&gt; Successful end of test.
 <span class="o">(</span><span class="nb">test</span> finished, interpreter halted<span class="o">)</span>
</pre>
<p>Looks good.</p>
</div>
<div class="section" id="sql-related-troubleshooting">
<h3><a class="toc-backref" href="#id163">SQL-related Troubleshooting</a></h3>
<div class="section" id="compiling-module-sql-support-erl-can-t-find-include-file-sqlite3-hrl">
<h4>Compiling module sql_support.erl : can't find include file &quot;sqlite3.hrl&quot;</h4>
<ul class="simple">
<li><tt class="docutils literal">USE_SQLITE</tt> not set to <tt class="docutils literal">true</tt> in <tt class="docutils literal">myriad/GNUmakevars.inc</tt></li>
<li><tt class="docutils literal"><span class="pre">erlang-sqlite3</span></tt> backend not correctly installed (ex: <tt class="docutils literal">SQLITE3_BASE</tt> not pointing to a right path in <tt class="docutils literal">myriad/GNUmakevars.inc</tt>)</li>
</ul>
<p></p>
</div>
</div>
</div>
</div>
<div class="section" id="myriad-main-conventions">
<span id="main-conventions"></span><h1><a class="toc-backref" href="#id164"><tt class="docutils literal">Myriad</tt> Main Conventions</a></h1>
<p>We list here the conventions of all sorts that the Myriad code (base or contributed one) - and also code in the software stack based on it - shall obey.</p>
<div class="section" id="text-conventions">
<h2><a class="toc-backref" href="#id165">Text Conventions</a></h2>
<p>The purpose here is to ensure a sufficient <strong>code homogeneity</strong>; for example in all source files are in such a &quot;canonical form&quot;, analysing their differences (<tt class="docutils literal">diff</tt>) is made simpler.</p>
<p>Any text editor can be used, provided that it saves source files with the UNIX, not DOS, conventions (i.e. lines terminating by the LF character, not by the CRLF characters).</p>
<p>The use of syntax highlighting is encouraged.</p>
<p>Recommended text editors are:</p>
<ul class="simple">
<li><a class="reference external" href="#emacs-settings">Emacs</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Visual_Studio_Code">Visual Studio Code</a> (a.k.a. Vscode)</li>
<li><a class="reference external" href="https://erlide.org/">ErlIDE</a> (based on Eclipse)</li>
<li>Vim, IntelliJ, Gedit, Nedit, etc.</li>
</ul>
<p>The main editors integrate the <em>Language Server Protocol</em> (also known as LSP), refer to the <a class="reference internal" href="#lsp">LSP</a> section for more details (<a class="reference external" href="https://www.flycheck.org">Flycheck</a> can be another option).</p>
<p>Source files should be formatted for a 80-character width: no character should be present after the 79th column of a line.</p>
<p>Except in very specific cases, only ASCII code should be used (ex: no accentuated characters).</p>
<p>Tabulations should be preferred to series of spaces, and the text should be formatted according to 4-character tabulations.</p>
<p>All redundant whitespaces should be removed, preferably automatically (see the Emacs <tt class="docutils literal"><span class="pre">whitespace-cleanup</span></tt> command). This is why, with the <a class="reference internal" href="#emacs-settings">emacs settings</a> that we recommend, pressing the F8 key removes for example the yellow areas in the current buffer by replacing any series of four spaces by a corresponding tabulation.</p>
<p>We would prefer that all files (especially source ones; including the contributed ones) are &quot;whitespace-clean&quot; before being committed. As mentioned, such a transformation can be done directly from Emacs. If using another editor, please ensure that the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Hull/blob/master/fix-whitespaces.sh">fix-whitespaces.sh</a> script has been run on the target sources (possibly automatically thanks to a VCS hook) <em>before</em> committing them; the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Hull/blob/master/fix-whitespaces-in-tree.sh">fix-whitespaces-in-tree.sh</a> script may be also used, in order to perform a bulk transformation.</p>
<p>All elements of documentation should be written in English, possibly translated to other languages. Spell-checking is recommended.</p>
</div>
<div class="section" id="coding-practices">
<h2><a class="toc-backref" href="#id166">Coding Practices</a></h2>
<p>In terms of coding style, we would like that the sources remain as uniform as possible, regarding naming, spacing, code/comments/blank line ratios.</p>
<p>We would like that, roughly and on average, the same ratio applies for blank lines, comments and lines of code.</p>
<p>For that one may use the either directly <tt class="docutils literal">make stats</tt> from the root of the layer or the <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/scripts/make-code-stats.sh">make-code-stats.sh</a> script.</p>
<p>For example:</p>
<pre class="literal-block">
In the Erlang source code found from XXX/ceylan/myriad, we have:
+ 160 source files (*.erl), 54 header files (*.hrl)
+ a grand total of 89151 lines:
  - 27186 of which (30.4%) are blank lines
  - 28751 of which (32.2%) are comments
  - 33214 of which (37.2%) are code
</pre>
<p>The most obvious conventions are:</p>
<ul class="simple">
<li>the <strong>settings of the build chain</strong> should be used (ex: with regard to compiler flags) and adapted/completed if needed; the (possibly-specialised) <tt class="docutils literal">GNUmakesettings.inc</tt>,  <tt class="docutils literal">GNUmakerules.inc</tt> and <tt class="docutils literal">GNUmakevars.inc</tt> files should be relied upon</li>
<li><strong>no warning should be tolerated</strong>; anyway our build chain treats warnings as (blocking) errors</li>
<li><strong>test cases</strong> should be developed alongside most if not all modules; ex: if developing <tt class="docutils literal">src/class_X.erl</tt>, then probably the <tt class="docutils literal">test/class_X_test.erl</tt> testing code should be developed, after or, even preferably, before the implementation of the tested code; test success should be evaluated automatically, by the code (ex: thanks to pattern matching), not by the person running the test (ex: who would have to compare visually the actual results with the expected ones); in some cases, only <strong>integrated tests</strong> can be devised in practice; tests should be gathered in <strong>test suites</strong>, that should be runnable automatically (<tt class="docutils literal">make test</tt>, recursively through child directories) and fail loudly (and in a blocking manner) at the first error met</li>
<li><strong>multiple levels of quality documentation</strong> should be made available to the code user, and probably be written in parallel to the code; there are at least three documentation levels:<ul>
<li>lower-level documentation: code should always be <strong>densely commented</strong>, with documentation headers added to all functions, inlined comments (not paraphrasing the code) and self-describing symbols: function names, variable names (ex: <tt class="docutils literal">RegisteredState = ...</tt> to be preferred to <tt class="docutils literal">NewState = ...</tt>), etc.; more generally all names shall be long enough to be descriptive (clarity preferred over compactness); type specifications also pertain to this low-level documentation effort</li>
<li>higher-level <strong>design and/or implementation notes</strong>: they should be available as a set of paragraphs in each source file, before the function definitions, to describe the context and constraints, and help understanding how the features are implemented, and why</li>
<li>high-level <strong>developer and user documentation</strong> should be made available, targeting at least HTML and PDF outputs, possibly offering a wiki access as well</li>
</ul>
</li>
<li>more generally, <strong>comments</strong> should be clear and precise, numerous, rich and complete (overall, in terms of line counts, we target roughly 1/3 of code, 1/3 of blank lines and 1/3 of comments); all comments shall be written in UK English, start with a single <tt class="docutils literal">%</tt> and be properly word-wrapped (use <tt class="docutils literal"><span class="pre">meta-q</span></tt> with our Emacs settings to take care of that automatically)</li>
<li><strong>indentation</strong> should respect, as already explained, the 80-character width and 4-space tabulation; however the default built-in Erlang indentation mode of <tt class="docutils literal">emacs</tt> can hardly be used for that, as it leads to huge width offsets (we may in the future provide a variation of the <tt class="docutils literal">elisp</tt> code for the emacs indentation rules)</li>
<li><strong>spacing homogeneity</strong> across source files should be enforced; for example three blank lines should exist between two function definitions, one between the clauses of any given function (possibly two in case of longer clauses); for the sake of &quot;visual parsing&quot;, arguments should be separated by spaces (ex: <tt class="docutils literal">f( X ) <span class="pre">-&gt;</span> ...</tt>, not <tt class="docutils literal">f(X) <span class="pre">-&gt;</span> ...</tt>), especially if they are a bit complex (<tt class="docutils literal">f( <span class="pre">A={U,V},</span> B, _C ) <span class="pre">-&gt;</span> ...</tt>, not <tt class="docutils literal"><span class="pre">f(A={U,V},B,_C)</span> <span class="pre">-&gt;</span> ...</tt> or the usual <tt class="docutils literal"><span class="pre">f(A={U,V},</span> B, _C) <span class="pre">-&gt;</span> ...</tt>)</li>
<li>for <strong>type-related conventions</strong>, at least all exported functions shall have a <tt class="docutils literal"><span class="pre">-spec</span></tt> declaration; if an actual type is referenced more than once (notably in a given module), a specific user-defined type shall be defined; types shall be defined in &quot;semantic&quot; terms rather than on technical ones (ex: <tt class="docutils literal"><span class="pre">-type</span> temperature() :: ...</tt> than <tt class="docutils literal">float()</tt>; developers may refer to, or enrich, <tt class="docutils literal">myriad/src/utils/unit_utils.erl</tt> for that)</li>
<li>the <strong>latest stable version of Erlang</strong> should be used, preferably built thanks to our <tt class="docutils literal"><span class="pre">myriad/conf/install-erlang.sh</span></tt> script</li>
<li>the official <em>Programming Rules and Conventions</em> should be enforced, as defined <a class="reference external" href="http://www.erlang.se/doc/programming_rules.shtml">here</a></li>
<li>the function definitions shall follow <strong>the same order</strong> as the one of their exports</li>
<li>helper functions <strong>shall preferably be identified as such</strong>, with an <tt class="docutils literal">(helper)</tt> comment</li>
<li>if an helper function is specific to an exported function, it shall be defined just after this function; otherwise it should be defined in the <strong>helper section</strong>, placed just after the definition of the exported functions</li>
<li>defining distinct (non-overlapping), explicit (with a clear-enough name), numerous (statically-defined) <strong>atoms</strong> is cheap; each atom found in the sources is generally to be involved in at least one type definition</li>
<li>the use of <tt class="docutils literal">case ... of ... end</tt> should be preferred to the use of <tt class="docutils literal">if</tt> (never used in our code base)</li>
<li>we also prefer that the various patterns of a case are indented with exactly one tabulation, and that the closing <tt class="docutils literal">end</tt> lies as much as possible on the left (ex: if having specified <tt class="docutils literal">MyVar = case ... end</tt>, then <tt class="docutils literal">end</tt> should begin at the same column as <tt class="docutils literal">MyVar</tt>); the same applies to <tt class="docutils literal">try ... catch ... end</tt> clauses</li>
<li>when a term is ignored, instead of using simply <tt class="docutils literal">_</tt>, one should define a <strong>named mute variable</strong> in order to provide more information about this term (ex: <tt class="docutils literal">_TimeManagerPid</tt>); one should then to accidental matching of such names (now a warning is emitted)</li>
<li>some conventional variable names are, and may be, extensively used: <tt class="docutils literal">Res</tt> for result, <tt class="docutils literal">H</tt> and <tt class="docutils literal">T</tt> for respectively the head and tail of a list on which we recursively iterate</li>
</ul>
<ul class="simple" id="indices">
<li>indices shall, as much as possible, start at index <tt class="docutils literal">1</tt> (rather than 0); this is a general Erlang convention (<a class="reference external" href="https://erlang.org/doc/man/lists.html#description">for lists</a>, like with <tt class="docutils literal">lists:nth/2</tt>, for tuples, etc. - unlike <a class="reference external" href="https://erlang.org/doc/man/array.html#description">arrays</a>, though); see <tt class="docutils literal">basic_utils:positive_index/0</tt></li>
<li>when needing an <strong>associative table</strong>, use the <tt class="docutils literal">table</tt> pseudo-module; a key/value pair shall be designated as a table <em>entry</em> (ex: variable named as <tt class="docutils literal">RoadEntry</tt>)</li>
<li>regarding the in-code management of <strong>text</strong>:<ul>
<li>if a text is to be rather static (constant) and/or if it is to be exchanged between processes, then it should be a UTF8 <tt class="docutils literal">binary</tt>, and its type shall be declared as <tt class="docutils literal">text_utils:bin_string()</tt></li>
<li>other, a plain string (<tt class="docutils literal">text_utils:ustring()</tt>) shall be used</li>
</ul>
</li>
<li>when defining a non-trivial datastructure, a <strong>record</strong> shall be used (rather than, say, a mere ad-hoc tuple or a map of undocumented structure...), a corresponding <strong>type</strong> should be then defined (ex: a <tt class="docutils literal">foobar</tt> record leading to a <tt class="docutils literal">foobar()</tt> type), and a <strong>function to describe it</strong> as text shall be provided (ex: <tt class="docutils literal"><span class="pre">-spec</span> <span class="pre">foobar_to_string(foobar())</span> <span class="pre">-&gt;</span> text_utils:string()</tt>)<ul>
<li><strong>mute variables</strong> should be used as well to document actual parameters; for example <tt class="docutils literal">f(3,7,10)</tt> could preferably be written as a clearer <tt class="docutils literal">f(_Min=3,_Max=7,_Deviation=10)</tt></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Mute variables are however actually bound, thus if for example there is in the same scope <tt class="docutils literal">_Min=3</tt> and later <tt class="docutils literal">_Min=4</tt>, then a badmatch will be triggered at runtime; therefore names of mute variables should be generally kept unique in a given scope.</p>
<ul class="last simple">
<li>type shorthands may be defined; for example, if using repeatedly within a module <tt class="docutils literal">text_utils:ustring()</tt>, a local, non-exported type shorthand (<tt class="docutils literal"><span class="pre">-type</span> ustring() :: text_utils:ustring()</tt>) may be defined so that all other uses of this type become simply <tt class="docutils literal">ustring()</tt></li>
</ul>
</div>
<p>As not all typos may be detected at compilation-time (ex: wrong spelling for a module), we recommend, for source code, the use of additional static checkers, as discussed in the <a class="reference internal" href="#type-checking">type-checking</a> section.</p>
</div>
<div class="section" id="execution-targets">
<span id="execution-target"></span><h2><a class="toc-backref" href="#id167">Execution Targets</a></h2>
<p>Two execution target modes have been defined:</p>
<ul class="simple">
<li><tt class="docutils literal">development</tt> (the default): meant to simplify the task of developers and maintainers by reporting as much information and context as possible, even at the expense of some performances and reliability (ex: no retry in case of failure, shorter time-outs not to wait too long in case of errors, more checks, etc.)</li>
<li><tt class="docutils literal">production</tt>: mostly the reciprocal of the <tt class="docutils literal">development</tt> mode, whose purpose is to favor efficient, bullet-proof operations</li>
</ul>
<p>These execution targets are <em>compile-time</em> modes, i.e. they are set once for all when building the layer at hand (probably based, if using OTP, on the rebar corresponding modes - respectively <tt class="docutils literal">dev</tt> and <tt class="docutils literal">prod</tt>).</p>
<p>See the <tt class="docutils literal">EXECUTION_TARGET</tt> variable in <tt class="docutils literal">GNUmakevars.inc</tt> to read and/or set them.</p>
<p>The current execution target is of course available at runtime on a per-layer level, see <tt class="docutils literal">basic_utils:get_execution_target/0</tt> for more information.</p>
<p>This function shall be compiled once per layer to be accurate, in one of its modules. It is just a matter of adding the following include in such module:</p>
<pre class="literal-block">
-include_lib(&quot;myriad/utils/basic_utils.hrl&quot;).
</pre>
</div>
<div class="section" id="tooling-conventions">
<h2><a class="toc-backref" href="#id168">Tooling Conventions</a></h2>
<div class="section" id="erlang-ls">
<span id="lsp"></span><h3><a class="toc-backref" href="#id169">Erlang LS</a></h3>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Language_Server_Protocol">Language Server Protocol</a> (also known as LSP) may be used by one's editor of choice in order to provide various services facilitating the developments in various languages, including Erlang.</p>
<p>For that <a class="reference external" href="https://erlang-ls.github.io/">Erlang LS</a> should be used. We then recommend to rely on our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/erlang_ls.config">erlang_ls.config</a> configuration file, which may be installed that way:</p>
<pre class="code bash literal-block">
$ mkdir -p ~/.config/erlang_ls <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ~/.config/erlang_ls/
$ ln -sf <span class="si">${</span><span class="nv">CEYLAN_MYRIAD</span><span class="si">}</span>/conf/erlang_ls.config
</pre>
<p>As for the installation of <a class="reference external" href="https://erlang-ls.github.io/">Erlang LS</a> itself, we rely on:</p>
<pre class="code bash literal-block">
$ mkdir -p ~/Software <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ~/Software
$ git clone https://github.com/erlang-ls/erlang_ls
$ <span class="nb">cd</span> erlang_ls/
$ make
$ mkdir bin <span class="o">&amp;&amp;</span> <span class="nb">cd</span> bin
$ ln -s ../_build/default/bin/erlang_ls
</pre>
<p>Then one would just have to ensure that <tt class="docutils literal">~/Software/erlang_ls/bin</tt> is indeed in one's PATH.</p>
<p>Note that not all bells and whistles of LSP may be retained, knowing that at least some of them are confused by various elements, especially when applied to code that is parse-transformed; as a result we did find LS features much useful.</p>
<p>The Emacs configuration that we use (see the corresponding <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/conf/init.el">init.el</a>) attempts to find some sweet spot in this matter.</p>
<p>Another option is to use <tt class="docutils literal">ctags</tt> to generate Emacs' compliant <a class="reference external" href="https://www.emacswiki.org/emacs/EmacsTags">tags</a> (see the <tt class="docutils literal"><span class="pre">generate-tags</span></tt> make target); we did not find this solution very satisfactory either.</p>
</div>
<div class="section" id="for-documentation-generation">
<h3><a class="toc-backref" href="#id170">For Documentation Generation</a></h3>
<p>We rely on RST (<em>Restructured Text</em>, from Docutils) in order to generate both HTML targets (a set of static web pages) and PDF ones (for any of our layers), notably thanks to our <tt class="docutils literal"><span class="pre">generate-docutils.sh</span></tt> script.</p>
<p>In the context of our HTML target, in order to output beautiful mathematical symbols (equations, matrices, etc.), we rely on MathJax. It shall thus be installed once for all first. For example, on Arch Linux, as <tt class="docutils literal">root</tt>, it is sufficient to execute:</p>
<pre class="code bash literal-block">
$ pacman -Sy mathjax
</pre>
<p>Then, to enable the use of MathJax for a given website, run from its root (often a <tt class="docutils literal">doc</tt> directory):</p>
<pre class="code bash literal-block">
make create-mathjax-symlink
</pre>
<p>(this target is defined in <tt class="docutils literal"><span class="pre">myriad/doc/GNUmakerules-docutils.inc</span></tt>).</p>
</div>
</div>
<div class="section" id="other-conventions">
<h2><a class="toc-backref" href="#id171">Other Conventions</a></h2>
<ul class="simple">
<li>for clarity, we tend to use longer variable names, in CamelCase</li>
<li>we tend to use mute variables to clarify meanings and intents, as in <tt class="docutils literal"><span class="pre">_Acc=[]</span></tt> (beware, despite being muted, any variable in scope that bears the same name will be matched), <tt class="docutils literal">Acc</tt> designating accumulators</li>
<li>as there is much list-based recursion, a variable named <tt class="docutils literal">H</tt> means <tt class="docutils literal">Head</tt> and <tt class="docutils literal">T</tt> means <tt class="docutils literal">Tail</tt> (as in <tt class="docutils literal">[Head|Tail]</tt>)</li>
<li>the string format specifier <tt class="docutils literal">~s</tt> shall never be used; its Unicode-aware counterpart <tt class="docutils literal">~ts</tt> must be used instead; similarly, for string operations, <tt class="docutils literal">list_to_binary/1</tt> and <tt class="docutils literal">binary_to_list/1</tt> must no be used either; prefer anyway the primitives in <tt class="docutils literal">text_utils</tt></li>
</ul>
<p></p>
</div>
</div>
<div class="section" id="myriad-related-troubleshooting">
<h1><a class="toc-backref" href="#id172"><tt class="docutils literal">Myriad</tt>-related Troubleshooting</a></h1>
<div class="section" id="header-module-dependencies">
<h2><a class="toc-backref" href="#id173">Header/Module Dependencies</a></h2>
<p>Only a very basic dependency between header files (<tt class="docutils literal">*.hrl</tt>) and implementation files (<tt class="docutils literal">*.erl</tt>) is managed.</p>
<p>As expected, if <tt class="docutils literal">X.hrl</tt> changed, <tt class="docutils literal">X.beam</tt> will be recompiled whether or not <tt class="docutils literal">X.erl</tt> changed. However, any <tt class="docutils literal">Y.erl</tt> that would include <tt class="docutils literal">X.hrl</tt> would not be automatically recompiled.</p>
<p>Typically, when in doubt after having modified a record in a header file, just run <tt class="docutils literal">make rebuild</tt> from the root of that layer (build is fast anyway, as quite parallel).</p>
</div>
<div class="section" id="third-party-dependencies">
<h2><a class="toc-backref" href="#id174">Third-Party Dependencies</a></h2>
<p>Let's suppose we have an application named <tt class="docutils literal">Foo</tt> that relies on Myriad.</p>
<p><tt class="docutils literal">Foo</tt> may define additional dependencies, which may be:</p>
<ul class="simple">
<li>either mandatory or optional</li>
<li>needed starting from build-time (ex: if relying on their headers and/or modules - including parse-transforms), or only at runtime</li>
</ul>
<p>For a given <strong>optional</strong> dependency (ex: regarding JSON), a USE make variable is to be defined in the layer that introduced this dependency (ex: <tt class="docutils literal">USE_JSON</tt>, introduced by Myriad, therefore to be listed in its <tt class="docutils literal">GNUmakevars.inc</tt>). This variable allows to have our native build system register the associated additional include and ebin directories.</p>
<p>The first step to enable such a dependency (ex: the JSON support) is to set its USE variable to <tt class="docutils literal">true</tt> (ex: <tt class="docutils literal">USE_JSON = true</tt>), as it is expected to be disabled by default. Depending on the service at hand, a specific backend may have also to be selected (ex: either <tt class="docutils literal">USE_JSX = true</tt> or <tt class="docutils literal">USE_JIFFY = true</tt> to select a suitable JSON parser).</p>
<p>Finally, some supports may depend on others (ex: enabling <tt class="docutils literal">USE_REST</tt> will enable <tt class="docutils literal">USE_JSON</tt> in turn).</p>
<div class="section" id="runtime-only-third-party-dependencies">
<h3><a class="toc-backref" href="#id175">Runtime-only Third-Party Dependencies</a></h3>
<p>The dependencies discussed here have to be found only when <em>executing</em> one's application; they can be installed:</p>
<ul class="simple">
<li>either manually, in which case the location of their <tt class="docutils literal">ebin</tt> directory (typically an absolute path then) shall be specified in the code path (see, in <tt class="docutils literal">GNUmakevars.inc</tt>, the <tt class="docutils literal">JSX_SOFTWARE_BASE</tt> make variable for an example)</li>
<li>or thanks to rebar, in which case they shall obey the same rules as the <a class="reference internal" href="#build-time-third-party-dependencies">Build-time Third-Party Dependencies</a> discussed below</li>
</ul>
</div>
<div class="section" id="build-time-third-party-dependencies">
<h3><a class="toc-backref" href="#id176">Build-time Third-Party Dependencies</a></h3>
<p>Myriad does not have such dependencies, but layers above in the software stack (like a layer that would be named <tt class="docutils literal">Foo</tt>) may.</p>
<p>To have such dependencies (ex: let's suppose that the <tt class="docutils literal">jsx</tt> JSON parser defined header files that one wants to include) <em>installed</em> as well when building one's project (ex: <tt class="docutils literal">Foo</tt>), one may rely on rebar, and list them in the project's <tt class="docutils literal">foo/conf/rebar.config.template</tt> file (ex: <tt class="docutils literal">{deps, [bar, <span class="pre">jsx]}.</span></tt>) from which the actual <tt class="docutils literal">rebar.config</tt> is to be generated (use the <tt class="docutils literal">make <span class="pre">set-rebar-conf</span></tt> target for that).</p>
<p>The actual compilation will be done by our native build system in all cases, either directly (when running <tt class="docutils literal">make all</tt>) or when using <tt class="docutils literal">rebar compile</tt> (rebar hooks will then ensure that in practice the application is compiled with our native rules anyway). Therefore appropriate make variables (ex: <tt class="docutils literal">JSX_REBAR_BASE</tt>, in <tt class="docutils literal">myriad/GNUmakevars.inc</tt>) shall be defined so that the corresponding BEAM files installed through rebar can be found in this native context as well (through the <tt class="docutils literal">BEAM_DIRS</tt> make variable).</p>
<p>Finally, such dependencies may or may not be listed in the <tt class="docutils literal">deps</tt> entry of the  <tt class="docutils literal">conf/foo.app.src</tt> file <a class="footnote-reference" href="#id97" id="id96">[24]</a>, depending on whether they are optional or not.</p>
<table class="docutils footnote" frame="void" id="id97" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id96">[24]</a></td><td>After having edited this file, run <tt class="docutils literal">make <span class="pre">rebar3-create-app-file</span></tt> afterwards in order to have the three other versions of it properly generated (namely <tt class="docutils literal">./_build/lib/foo/ebin/foo.app</tt>, <tt class="docutils literal">ebin/foo.app</tt> and <tt class="docutils literal">src/foo.app.src</tt>).</td></tr>
</tbody>
</table>
</div>
<div class="section" id="myriad-level-third-party-dependencies">
<h3><a class="toc-backref" href="#id177">Myriad-level Third-Party Dependencies</a></h3>
<p>Myriad as such has no mandatory dependency (except Erlang itself of course), but <em>optional</em> ones may be enabled, for:</p>
<ul class="simple">
<li>a basic <a class="reference external" href="https://en.wikipedia.org/wiki/JSON">JSON</a> support (see our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/data-management/json_utils.erl">json_utils</a> module), thanks to a suitable actual JSON parser, either <a class="reference external" href="https://github.com/talentdeficit/jsx/">jsx</a> or <a class="reference external" href="https://github.com/davisp/jiffy">jiffy</a>; note that the detection and use of these parsers are done transparently at runtime, hence none of them is a declared dependency of Myriad, which will adapt to any choice made by the overall application that includes both Myriad and one of such parsers (provided, as mentioned above, that the proper <tt class="docutils literal">USE_*</tt> make variables are set)</li>
<li>a first-level support of the <a class="reference external" href="https://www.hdfgroup.org/HDF5/">HDF5</a> file format (see our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/data-management/hdf5_support.erl">hdf5_support</a> module), based on - and thus requiring - the <a class="reference external" href="https://github.com/Olivier-Boudeville-EDF/erlhdf5">enhanced fork</a> that we made of <a class="reference external" href="https://github.com/RomanShestakov/erlhdf5">erlhdf5</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a> (see our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/utils/python_utils.erl">python_utils</a> module), thanks to <a class="reference external" href="https://github.com/hdima/erlport">erlport</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/SQLite">SQLite</a> (see our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/blob/master/src/data-management/sql_support.erl">sql_support</a> module), thanks to the SQLite 3 Erlang binding that we retained, <a class="reference external" href="https://github.com/alexeyr/erlang-sqlite3.git">erlang-sqlite3</a></li>
</ul>
<p id="jsx-install">As an example, let's suppose that we need a JSON support and that we want to rely on the <tt class="docutils literal">jsx</tt> parser (our default choice) for that.</p>
<p>If applying our conventions, supposing that Erlang and Rebar3 are already installed (otherwise refer to the <a class="reference internal" href="#id9">getting Erlang</a> and <a class="reference internal" href="#id24">getting Rebar3</a> sections), <tt class="docutils literal">jsx</tt> may be installed with:</p>
<pre class="code bash literal-block">
$ mkdir -p ~/Software/jsx
$ <span class="nb">cd</span> ~/Software/jsx
$ git clone https://github.com/talentdeficit/jsx.git
$ ln -s jsx jsx-current-install
$ <span class="nb">cd</span> jsx/
$ rebar3 compile <span class="o">&amp;&amp;</span> rebar3 eunit
</pre>
</div>
</div>
<div class="section" id="about-the-table-module">
<h2><a class="toc-backref" href="#id178">About the <tt class="docutils literal">table</tt> module</a></h2>
<p>This is a pseudo module, which is not meant to exist as such (no <tt class="docutils literal">table.erl</tt>, no <tt class="docutils literal">table.beam</tt>).</p>
<p>The <tt class="docutils literal">Myriad</tt> parse transform replaces references to the <tt class="docutils literal">table</tt> module by (generally) references to the <tt class="docutils literal">map_hashtable</tt> module. See <a class="reference internal" href="#table-transformations">table transformations</a> for more information.</p>
</div>
<div class="section" id="enabling-the-interconnection-of-erlang-nodes">
<h2><a class="toc-backref" href="#id179">Enabling the Interconnection of Erlang nodes</a></h2>
<p>This is not a Myriad gotcha per se, but rather an Erlang one.</p>
<p>Way too often, for obscure reasons Erlang nodes fail to connect to each other (especially with long names), and little to no information is available to diagnose the issue.</p>
<div class="section" id="safety-measures">
<h3><a class="toc-backref" href="#id180">Safety Measures</a></h3>
<p>In order to maximise the chances that nodes are able to <tt class="docutils literal">net_adm:ping/1</tt> successfully each other:</p>
<ul class="simple">
<li>at least for testing, run VMs spawned with preferably the same <strong>version</strong> of Erlang</li>
<li>ensure that they rely on the same <strong>EPMD</strong> (TCP) port (default Erlang one is <tt class="docutils literal">4369</tt>, while Myriad default one is <tt class="docutils literal">4506</tt>); check for example that all launched nodes of interest can be seen with: <tt class="docutils literal">epmd <span class="pre">-port</span> 4506 <span class="pre">-names</span></tt></li>
<li>check that they use the same <strong>cookie</strong>, either from the start (use the <tt class="docutils literal"><span class="pre">-setcookie</span> MY_COOKIE</tt> command-line option) or after having changed it after the VM was launched</li>
<li>ensure that no <strong>firewall</strong> gets in the way; one may take inspiration for example from our <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Hull/blob/master/iptables.rules-FullDisabling.sh">iptables.rules-FullDisabling.sh</a> script</li>
<li>finally check that the local <strong>DNS resolution</strong> complies with the surprisingly picky constraints demanded by the Erlang VM</li>
</ul>
<p>For this last point, <tt class="docutils literal">/etc/hosts</tt> is often the scene of the disaster. If your hostname is <tt class="docutils literal">hurricane</tt> and your domain is <tt class="docutils literal">foobar.org</tt>, then a line like the following one is known to work (whereas many variations of it may be deemed &quot;incorrrect&quot;):</p>
<pre class="literal-block">
127.0.0.1  hurricane.foobar.org hurricane localhost.localdomain localhost
</pre>
<p>provided of course that, still in that file, you have not also a declaration such as:</p>
<pre class="literal-block">
192.168.0.5 hurricane.foobar.org hurricane
</pre>
<p>(setting one's IP shall better be done in one's profile in <tt class="docutils literal">/etc/netctl</tt>, right?)</p>
</div>
<div class="section" id="testing-troubleshooting">
<h3><a class="toc-backref" href="#id181">Testing &amp; Troubleshooting</a></h3>
<p>In order to <strong>quick-check</strong> whether long-name connectivity is available and to rule out the most obvious culprits, open two terminals.</p>
<p>In the first:</p>
<pre class="code bash literal-block">
<span class="c1"># Check (with root permissions) that the firewall rules are safe; for example:
</span>$ iptables -nL
Chain INPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target     prot opt <span class="nb">source</span>               destination

Chain FORWARD <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target     prot opt <span class="nb">source</span>               destination

Chain OUTPUT <span class="o">(</span>policy ACCEPT<span class="o">)</span>
target     prot opt <span class="nb">source</span>               destination

<span class="c1"># Just to be on the safer side for this test:
</span>$ killall beam.smp epmd

<span class="c1"># Then launch the target first node:
</span>$ <span class="nv">ERL_EPMD_PORT</span><span class="o">=</span><span class="m">4032</span> erl -name n1 -setcookie aa
Erlang/OTP <span class="m">23</span> <span class="o">[</span>erts-11.1.4<span class="o">]</span> <span class="o">[</span>source<span class="o">]</span> <span class="o">[</span><span class="m">64</span>-bit<span class="o">]</span> <span class="o">[</span>smp:4:4<span class="o">]</span> <span class="o">[</span>ds:4:4:10<span class="o">]</span> <span class="o">[</span>async-threads:1<span class="o">]</span> <span class="o">[</span>hipe<span class="o">]</span>

Eshell V11.1.4  <span class="o">(</span>abort with ^G<span class="o">)</span>
<span class="o">(</span>n1&#64;hurricane.foobar.org<span class="o">)</span><span class="m">1</span>&gt;
</pre>
<p>In the second terminal, try to find the previous node:</p>
<pre class="code bash literal-block">
$ <span class="nv">ERL_EPMD_PORT</span><span class="o">=</span><span class="m">4032</span> erl -name n2 -setcookie aa
Erlang/OTP <span class="m">23</span> <span class="o">[</span>erts-11.1.4<span class="o">]</span> <span class="o">[</span>source<span class="o">]</span> <span class="o">[</span><span class="m">64</span>-bit<span class="o">]</span> <span class="o">[</span>smp:4:4<span class="o">]</span> <span class="o">[</span>ds:4:4:10<span class="o">]</span> <span class="o">[</span>async-threads:1<span class="o">]</span> <span class="o">[</span>hipe<span class="o">]</span>

Eshell V11.1.4  <span class="o">(</span>abort with ^G<span class="o">)</span>
<span class="o">(</span>n2&#64;hurricane.foobar.org<span class="o">)</span><span class="m">1</span>&gt; net_adm:ping<span class="o">(</span><span class="s1">'n1&#64;hurricane.foobar.org'</span><span class="o">)</span>.
pong
</pre>
<p>If you see <tt class="docutils literal">pang</tt> here, run to the nearest altar and make a sacrifice to any Distribution God you may believe in (Norse ones being presumably the most effective here), and apply the hints listed in the <a class="reference internal" href="#enabling-the-interconnection-of-erlang-nodes">Enabling the Interconnection of Erlang nodes</a> section.</p>
</div>
</div>
<div class="section" id="using-the-erlang-shell-for-debugging">
<h2><a class="toc-backref" href="#id182">Using the Erlang Shell for Debugging</a></h2>
<p>It may be convenient to run an Erlang shell in order to investigate and fix issues.</p>
<p>One may execute <tt class="docutils literal">make shell</tt> to launch a shell that is parameterised so that all modules of all layers (hence having Myriad from Myriad) are in its code path.</p>
<p>The <a class="reference external" href="https://erlang.org/doc/man/shell.html#shell-commands">built-in shell commands</a> are then very convenient, notably:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">v(-1)</span></tt> to get the <em>result</em> of the last command</li>
<li>less relevant in a Myriad context: <tt class="docutils literal">c(my_module)</tt> to compile (if possible with default settings - thus notably with no parse transform involved)  and (re)load the specified module</li>
<li><tt class="docutils literal">l(my_module)</tt> to (re)load the specified module; useful when it has to be recompiled by Myriad (typically thanks to a <tt class="docutils literal">make</tt> issued in another terminal)</li>
</ul>
<p>Do not mix up this last command with <tt class="docutils literal">rl(XXX)</tt>, which does not perform a module reload but prints a record definition (and will not complain if given an unrelated module name, thus not reloading anything...).</p>
<p></p>
</div>
</div>
<div class="section" id="support-for-myriad">
<span id="support"></span><h1><a class="toc-backref" href="#id183">Support for <tt class="docutils literal">Myriad</tt></a></h1>
<p>So you respected the <a class="reference internal" href="#prerequisites">prerequisites</a> and <a class="reference internal" href="#build">build</a> sections, and something went wrong? Generally we made sure that any detected error is blocking and loudly reported, with as much context as possible.</p>
<p>The simpler solution is then to <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/issues">create a relevant issue</a>.</p>
<p>For all other needs, please drop an email to the address listed on top of document. We do our best to answer on a timely basis.</p>
<p>Finally, provided that they meet licensing terms, scope and quality standards, contributions of all sorts are vey welcome, be them porting efforts, increased test coverage, functional enrichments, documentation improvements, code enhancements, etc. See the next section for additional guidelines.</p>
<p></p>
</div>
<div class="section" id="please-react">
<h1><a class="toc-backref" href="#id184">Please React!</a></h1>
<p>If you have information more detailed or more recent than those presented in this document, if you noticed errors, neglects or points insufficiently discussed, drop us a line! (for that, follow the <a class="reference internal" href="#support">Support</a> guidelines).</p>
</div>
<div class="section" id="contributions-ending-word">
<h1><a class="toc-backref" href="#id185">Contributions &amp; Ending Word</a></h1>
<p>Each time that you need a basic service that:</p>
<ul class="simple">
<li>seems neither provided by the Erlang <a class="reference external" href="http://erlang.org/doc/man_index.html">built-in modules</a> nor by this <tt class="docutils literal">Myriad</tt> layer</li>
<li>is generic-enough, simple and requires no special prerequisite</li>
</ul>
<p>please either enrich our <tt class="docutils literal">*_utils.erl</tt> <a class="reference external" href="https://github.com/Olivier-Boudeville/Ceylan-Myriad/tree/master/src/utils">helpers</a>, or add new general services!</p>
<p id="contribution">In such a case, we would prefer that, in contributed code, the Myriad <a class="reference internal" href="#text-conventions">Text Conventions</a> and <a class="reference internal" href="#coding-practices">Coding Practices</a> are respected.</p>
<p>Thanks in advance, and have fun with Ceylan-Myriad!</p>
<p><span class="raw-html"><center><img src="myriad-title.png" id="responsive-image-small"></img></center></span>
</p>
<p><span class="raw-html"><a name="myriad_bottom"></a></span></p>
</div>
</div>
</body>
</html>
